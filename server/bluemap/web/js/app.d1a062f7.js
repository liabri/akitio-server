(function(t){function e(e){for(var n,r,o=e[0],l=e[1],c=e[2],h=0,d=[];h<o.length;h++)r=o[h],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&d.push(a[r][0]),a[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);u&&u(e);while(d.length)d.shift()();return s.push.apply(s,c||[]),i()}function i(){for(var t,e=0;e<s.length;e++){for(var i=s[e],n=!0,o=1;o<i.length;o++){var l=i[o];0!==a[l]&&(n=!1)}n&&(s.splice(e--,1),t=r(r.s=i[0]))}return t}var n={},a={app:0},s=[];function r(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=n,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var u=l;s.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"04be":function(t,e,i){},1213:function(t,e,i){"use strict";i("fdfd")},"12f6":function(t,e,i){"use strict";i("8568")},"15ce":function(t,e,i){"use strict";i("32b6")},"162e":function(t,e,i){"use strict";i("46e6")},1864:function(t,e,i){"use strict";i("8dd3")},"1ba7":function(t,e,i){"use strict";i("e998")},"1c73":function(t,e,i){"use strict";i("c2cb")},"2b31":function(t,e,i){"use strict";i("a126")},"2bbd":function(t,e,i){"use strict";i("7b65")},"32b6":function(t,e,i){},3452:function(t,e,i){},"38e3":function(t,e,i){"use strict";i("7c75")},"46e6":function(t,e,i){},"4b42":function(t,e,i){"use strict";i("76c6")},"56d7":function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d"),i("caad"),i("2532");var n=i("2b0e"),a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:{"theme-light":"light"===t.appState.theme,"theme-dark":"dark"===t.appState.theme,"theme-contrast":"contrast"===t.appState.theme},attrs:{id:"app"}},["free"===t.appState.controls.state?i("FreeFlightMobileControls"):t._e(),i("ControlBar"),i("MainMenu",{attrs:{menu:t.appState.menu}})],1)},s=[],r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"control-bar"},[i("MenuButton",{attrs:{close:t.appState.menu.isOpen,back:!1,title:t.$t("menu.tooltip")},on:{action:function(e){return t.appState.menu.reOpenPage()}}}),i("div",{staticClass:"space thin-hide"}),t.appState.maps.length>0?i("SvgButton",{staticClass:"thin-hide",attrs:{title:t.$t("maps.tooltip")},on:{action:function(e){t.appState.menu.openPage("maps",t.$t("maps.title"))}}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("polygon",{attrs:{points:"26.708,22.841 19.049,25.186 11.311,20.718 3.292,22.841 7.725,5.96 13.475,4.814 19.314,7.409 25.018,6.037 "}})])]):t._e(),t.markers.markerSets.length>0||t.markers.markers.length>0?i("SvgButton",{staticClass:"thin-hide",attrs:{title:t.$t("markers.tooltip")},on:{action:function(e){t.appState.menu.openPage("markers",t.$t("markers.title"),{markerSet:t.markers})}}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("path",{attrs:{d:"M15,3.563c-4.459,0-8.073,3.615-8.073,8.073c0,6.483,8.196,14.802,8.196,14.802s7.951-8.013,7.951-14.802\n\t\t\tC23.073,7.177,19.459,3.563,15,3.563z M15,15.734c-2.263,0-4.098-1.835-4.098-4.099c0-2.263,1.835-4.098,4.098-4.098\n\t\t\tc2.263,0,4.098,1.835,4.098,4.098C19.098,13.899,17.263,15.734,15,15.734z"}})])]):t._e(),t.playerMarkerSet.fake?t._e():i("SvgButton",{staticClass:"thin-hide",attrs:{title:t.$t("players.tooltip")},on:{action:t.openPlayerList}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("g",[i("path",{attrs:{d:"M8.95,14.477c0.409-0.77,1.298-1.307,2.164-1.309h0.026c-0.053-0.234-0.087-0.488-0.087-0.755\n\t\t\tc0-1.381,0.715-2.595,1.791-3.301c-0.01,0-0.021-0.006-0.03-0.006h-1.427c-0.39,0-0.514-0.251-0.276-0.563\n\t\t\tc0,0,0.497-0.645,0.497-1.452c0-1.48-1.2-2.681-2.679-2.681c-1.481,0-2.679,1.2-2.679,2.681c0,0.807,0.496,1.452,0.496,1.452\n\t\t\tc0.24,0.311,0.114,0.565-0.275,0.565L5.042,9.118C4.649,9.119,4.182,9.405,3.998,9.75l-2.601,4.927\n\t\t\tc-0.184,0.347-0.062,0.802,0.265,1.015l1.297,0.83c0.332,0.213,0.794,0.135,1.034-0.18l0.598-0.775\n\t\t\tc0.238-0.31,0.471-0.245,0.516,0.141l0.454,3.854c0.035,0.311,0.272,0.566,0.564,0.66c0.018-0.279,0.087-0.561,0.225-0.82\n\t\t\tL8.95,14.477z"}}),i("path",{attrs:{d:"M28.604,14.677l-2.597-4.94c-0.185-0.346-0.65-0.631-1.042-0.631h-1.428c-0.39,0-0.514-0.251-0.274-0.563\n\t\t\tc0,0,0.496-0.645,0.496-1.452c0-1.48-1.2-2.681-2.68-2.681c-1.481,0-2.679,1.2-2.679,2.681c0,0.807,0.496,1.452,0.496,1.452\n\t\t\tc0.239,0.311,0.114,0.565-0.275,0.565l-1.428,0.009c-0.005,0-0.009,0.002-0.015,0.002c1.067,0.708,1.774,1.917,1.774,3.292\n\t\t\tc0,0.263-0.031,0.513-0.084,0.744h0.02c0.868,0,1.758,0.537,2.166,1.305l2.598,4.944c0.137,0.262,0.205,0.539,0.222,0.818\n\t\t\tc0.296-0.092,0.538-0.35,0.574-0.664l0.451-3.842c0.044-0.389,0.28-0.452,0.519-0.143l0.588,0.768\n\t\t\tc0.239,0.313,0.702,0.391,1.033,0.182l1.297-0.833C28.667,15.479,28.787,15.026,28.604,14.677z"}})]),i("path",{attrs:{d:"M19.932,15.058c-0.184-0.346-0.651-0.63-1.043-0.63h-1.427c-0.39,0-0.515-0.252-0.275-0.564c0,0,0.496-0.645,0.496-1.451\n\t\tc0-1.479-1.199-2.68-2.679-2.68c-1.482,0-2.679,1.201-2.679,2.68c0,0.806,0.496,1.451,0.496,1.451\n\t\tc0.24,0.312,0.114,0.566-0.275,0.566l-1.427,0.009c-0.393,0.001-0.861,0.287-1.045,0.632l-2.602,4.925\n\t\tc-0.185,0.348-0.062,0.803,0.266,1.016l1.297,0.832c0.332,0.213,0.794,0.133,1.034-0.18l0.598-0.775\n\t\tc0.239-0.311,0.472-0.246,0.517,0.141l0.454,3.854c0.043,0.389,0.403,0.705,0.794,0.705h5.148c0.392,0,0.749-0.316,0.794-0.705\n\t\tl0.45-3.844c0.045-0.389,0.282-0.451,0.52-0.143l0.587,0.768c0.239,0.313,0.703,0.393,1.033,0.182l1.297-0.832\n\t\tc0.331-0.213,0.451-0.666,0.269-1.016L19.932,15.058z"}})])]),i("div",{staticClass:"space thin-hide greedy"}),i("DayNightSwitch",{staticClass:"thin-hide",attrs:{title:t.$t("lighting.dayNightSwitch.tooltip")}}),i("div",{staticClass:"space thin-hide"}),i("ControlsSwitch",{staticClass:"thin-hide"}),i("div",{staticClass:"space thin-hide"}),i("SvgButton",{staticClass:"thin-hide",attrs:{title:t.$t("resetCamera.tooltip")},on:{action:function(e){return t.$bluemap.resetCamera()}}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("rect",{attrs:{x:"7.085",y:"4.341",transform:"matrix(0.9774 0.2116 -0.2116 0.9774 3.2046 -1.394)",width:"2.063",height:"19.875"}}),i("path",{attrs:{d:"M12.528,5.088c0,0,3.416-0.382,4.479-0.031c1.005,0.332,2.375,2.219,3.382,2.545c1.096,0.354,4.607-0.089,4.607-0.089\n      l-2.738,8.488c0,0-3.285,0.641-4.344,0.381c-1.049-0.257-2.607-2.015-3.642-2.324c-0.881-0.264-3.678-0.052-3.678-0.052\n      L12.528,5.088z"}})])]),i("PositionInput",{staticClass:"pos-input"}),i("Compass",{attrs:{title:t.$t("compass.tooltip")}})],1)},o=[],l=i("b85c"),c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"position-input"},[i("NumberInput",{attrs:{label:"x",value:t.controls.position.x},on:{input:function(e){t.controls.position.x=parseFloat(e.target.value)}}}),"free"===t.appState.controls.state?i("NumberInput",{attrs:{label:"y",value:t.controls.position.y},on:{input:function(e){t.controls.position.y=parseFloat(e.target.value)}}}):t._e(),i("NumberInput",{attrs:{label:"z",value:t.controls.position.z},on:{input:function(e){t.controls.position.z=parseFloat(e.target.value)}}})],1)},u=[],h=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"number-input"},[i("label",[i("span",{staticClass:"label"},[t._v(t._s(t.label)+":")]),i("input",{attrs:{type:"number"},domProps:{value:t._f("format")(t.value)},on:{input:function(e){return t.$emit("input",e)},keydown:function(t){return t.stopPropagation()}}})])])},d=[],p=(i("a9e3"),{name:"NumberInput",props:{label:String,value:Number},filters:{format:function(t){return Math.floor(t)}}}),m=p,f=(i("1ba7"),i("2877")),v=Object(f["a"])(m,h,d,!1,null,null,null),g=v.exports,y={name:"PositionInput",components:{NumberInput:g},data:function(){return{controls:this.$bluemap.mapViewer.controlsManager.data,appState:this.$bluemap.appState}}},b=y,w=(i("982f"),Object(f["a"])(b,c,u,!1,null,null,null)),M=w.exports,k=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("SvgButton",{staticClass:"compass",on:{action:t.action}},[i("svg",{style:t.style,attrs:{viewBox:"0 0 30 30"}},[i("path",{staticClass:"north",attrs:{d:"M14.792,1.04c0.114-0.354,0.299-0.354,0.412,0l4.089,12.729c0.114,0.353-0.097,0.642-0.468,0.642\n      l-7.651,0.001c-0.371,0-0.581-0.288-0.468-0.642L14.792,1.04z"}}),i("path",{staticClass:"south",attrs:{d:"M10.707,16.23c-0.114-0.353,0.097-0.642,0.468-0.642l7.651-0.001c0.371,0,0.581,0.289,0.468,0.642\n      l-4.086,12.73c-0.113,0.353-0.299,0.353-0.412,0L10.707,16.23z"}})])])},S=[],x=i("53ca"),O=(i("d3b7"),i("25f0"),i("99af"),i("498a"),i("2b19"),i("ac1f"),i("1276"),i("159b"),i("5a89")),T=new O["N"](0,0),j=(new O["O"](0,0,0),new O["O"](1,0,0),new O["O"](0,1,0),new O["O"](0,0,1),function(t){var e=document.createElementNS("http://www.w3.org/1999/xhtml","img");return e.src=t,e}),P=function(t,e){var i="x";return i+=D(t),i+="z",i+=D(e),i=i.substring(0,i.length-1),i},D=function(t){var e="";t<0&&(t=-t,e+="-");for(var i=t.toString(),n=0;n<i.length;n++)e+=i.charAt(n)+"/";return e},L=function(t,e){return"x".concat(t,"z").concat(e)},E=function(){return Math.round(1e6*Math.random())},C=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t&&t.dispatchEvent)return t.dispatchEvent(new CustomEvent(e,{detail:i}))},_=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info",n=C(t,"bluemapAlert",{message:e,level:i});!1!==n&&("info"===i?console.log("[BlueMap/".concat(i,"]"),e):"warning"===i?console.warn("[BlueMap/".concat(i,"]"),e):"error"===i?console.error("[BlueMap/".concat(i,"]"),e):console.debug("[BlueMap/".concat(i,"]"),e))},z=function(t){var e=document.createElement("template");return e.innerHTML=t.trim(),e.content.firstChild},A=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n={animationStart:-1,lastFrame:-1,cancelled:!1,frame:function(n){var a=this;if(!this.cancelled){-1===this.animationStart&&(this.animationStart=n,this.lastFrame=n);var s=0===e?1:O["r"].clamp((n-this.animationStart)/e,0,1),r=n-this.lastFrame;t(s,r),s<1?window.requestAnimationFrame((function(t){return a.frame(t)})):i&&i(!0),this.lastFrame=n}},cancel:function(){this.cancelled=!0,i&&i(!1)}};return window.requestAnimationFrame((function(t){return n.frame(t)})),n},U={linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return t<.5?2*t*t:(4-2*t)*t-1},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return--t*t*t+1},easeInOutCubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return 1- --t*t*t*t},easeInOutQuart:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeOutQuint:function(t){return 1+--t*t*t*t*t},easeInOutQuint:function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t}},F=function(t){var e=t.getBoundingClientRect(),i=window.pageXOffset||document.documentElement.scrollLeft,n=window.pageYOffset||document.documentElement.scrollTop;return{top:e.top+n,left:e.left+i}},R=function t(e,i){if(Object.is(e,i))return!0;var n=Object(x["a"])(e);if(n!==Object(x["a"])(i))return!1;if("number"===n||"boolean"===n||"string"===n)return!1;if(Array.isArray(e)){var a=e.length;if(a!==i.length)return!1;for(var s=0;s<a;s++)if(!t(e[s],i[s]))return!1;return!0}for(var r in e)if(e.hasOwnProperty(r)&&!t(e[r],i[r]))return!1;return!0},V=function(t,e,i){if(t>=e)return t;var n=e-t;return n<1e-4?e:t+n*i},H=function(t,e,i){if(t<=e)return t;var n=t-e;return n<1e-4?e:t-n*i},B=function(t,e,i,n){return H(V(t,e,n),i,n)},$=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t&&t.length>=2?e?{x:t[0],z:t[1]}:{x:t[0],y:t[1]}:{}},N=document.createElement("canvas");N.width=1,N.height=1;var I,Y,K=N.getContext("2d",{willReadFrequently:!0}),W=function(t,e,i){return K.drawImage(t,Math.floor(e),Math.floor(i),1,1,0,0,1,1),K.getImageData(0,0,1,1).data},G=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"svg-button",class:{active:t.active},on:{click:function(e){return t.$emit("action",e)}}},[t._t("default")],2)},X=[],Z={name:"SvgButton",props:{active:Boolean}},q=Z,Q=(i("162e"),Object(f["a"])(q,G,X,!1,null,null,null)),J=Q.exports,tt={name:"Compass",components:{SvgButton:J},data:function(){return{controls:this.$bluemap.mapViewer.controlsManager.data}},computed:{style:function(){return{transform:"translate(-50%, -50%) rotate("+-this.controls.rotation+"rad)"}}},methods:{action:function(t){var e=this;t.preventDefault(),I&&I.cancel();var i=this.controls.rotation;I=A((function(t){e.controls.rotation=i*(1-U.easeOutQuad(t))}),300)}}},et=tt,it=(i("38e3"),Object(f["a"])(et,k,S,!1,null,null,null)),nt=it.exports,at=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("SvgButton",{staticClass:"day-night-switch",attrs:{active:!t.isDay},on:{action:t.action}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("path",{attrs:{d:"M17.011,19.722c-3.778-1.613-5.533-5.982-3.921-9.76c0.576-1.348,1.505-2.432,2.631-3.204\n      c-3.418-0.243-6.765,1.664-8.186,4.992c-1.792,4.197,0.159,9.053,4.356,10.844c3.504,1.496,7.462,0.377,9.717-2.476\n      C20.123,20.465,18.521,20.365,17.011,19.722z"}}),i("circle",{attrs:{cx:"5.123",cy:"7.64",r:"1.196"}}),i("circle",{attrs:{cx:"23.178",cy:"5.249",r:"1.195"}}),i("circle",{attrs:{cx:"20.412",cy:"13.805",r:"1.195"}}),i("circle",{attrs:{cx:"25.878",cy:"23.654",r:"1.195"}})])])},st=[],rt={name:"DayNightSwitch",components:{SvgButton:J},data:function(){return{mapViewer:this.$bluemap.mapViewer.data}},computed:{isDay:function(){return this.mapViewer.uniforms.sunlightStrength.value>.6}},methods:{action:function(t){var e=this;t.preventDefault(),Y&&Y.cancel();var i=this.mapViewer.uniforms.sunlightStrength.value,n=this.isDay?.25:1;Y=A((function(t){var a=U.easeOutQuad(t);e.mapViewer.uniforms.sunlightStrength.value=i*(1-a)+n*a}),300)}}},ot=rt,lt=(i("1c73"),Object(f["a"])(ot,at,st,!1,null,null,null)),ct=lt.exports,ut=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"controls-switch"},[i("SvgButton",{attrs:{active:t.isPerspectiveView,title:t.$t("controls.perspective.tooltip")},on:{action:t.setPerspectiveView}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("path",{attrs:{d:"M19.475,10.574c-0.166-0.021-0.337-0.036-0.51-0.045c-0.174-0.009-0.35-0.013-0.525-0.011\n        c-0.176,0.002-0.353,0.01-0.526,0.024c-0.175,0.015-0.347,0.036-0.515,0.063l-13.39,2.189\n        c-0.372,0.061-0.7,0.146-0.975,0.247c-0.276,0.102-0.5,0.221-0.66,0.349c-0.161,0.129-0.259,0.268-0.282,0.408\n        c-0.024,0.141,0.028,0.285,0.165,0.421l5.431,5.511c0.086,0.087,0.191,0.167,0.314,0.241s0.263,0.142,0.417,0.202\n        c0.155,0.062,0.323,0.115,0.502,0.162c0.18,0.046,0.371,0.085,0.569,0.116s0.405,0.054,0.616,0.068\n        c0.211,0.015,0.427,0.021,0.645,0.017c0.217-0.003,0.436-0.016,0.652-0.037c0.217-0.022,0.431-0.054,0.641-0.095L27.12,17.43\n        c0.371-0.073,0.679-0.175,0.917-0.296c0.236-0.12,0.404-0.259,0.497-0.407c0.093-0.147,0.111-0.305,0.052-0.461\n        c-0.059-0.156-0.195-0.313-0.415-0.46l-7.089-4.742c-0.089-0.06-0.192-0.115-0.308-0.166\n        c-0.116-0.051-0.243-0.097-0.381-0.138c-0.137-0.041-0.283-0.078-0.438-0.108C19.803,10.621,19.641,10.595,19.475,10.574"}})])]),i("SvgButton",{attrs:{active:t.isFlatView,title:t.$t("controls.flatView.tooltip")},on:{action:t.setFlatView}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("path",{attrs:{d:"M22.371,4.158c1.65,0,3,1.35,3,3v15.684c0,1.65-1.35,3-3,3H7.629c-1.65,0-3-1.35-3-3V7.158c0-1.65,1.35-3,3-3H22.371z"}})])]),t.controls.enableFreeFlight?i("SvgButton",{attrs:{active:t.isFreeFlight,title:t.$t("controls.freeFlight.tooltip")},on:{action:t.setFreeFlight}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("path",{attrs:{d:"M21.927,11.253c-0.256-0.487-0.915-0.885-1.465-0.885h-2.004c-0.55,0-0.726-0.356-0.39-0.792c0,0,0.698-0.905,0.698-2.041\n        c0-2.08-1.687-3.767-3.767-3.767s-3.767,1.687-3.767,3.767c0,1.136,0.698,2.041,0.698,2.041c0.336,0.436,0.161,0.794-0.389,0.797\n        l-2.005,0.01c-0.55,0.002-1.21,0.403-1.467,0.889l-3.656,6.924c-0.257,0.487-0.088,1.128,0.375,1.425l1.824,1.171\n        c0.462,0.297,1.116,0.184,1.451-0.253l0.839-1.092c0.335-0.437,0.662-0.346,0.726,0.2l0.637,5.415\n        c0.064,0.546,0.567,0.993,1.117,0.993h7.234c0.55,0,1.053-0.447,1.117-0.993l0.635-5.401c0.064-0.546,0.392-0.637,0.727-0.2\n        l0.828,1.078c0.335,0.437,0.988,0.55,1.451,0.253l1.823-1.171c0.463-0.297,0.633-0.938,0.377-1.425L21.927,11.253z"}})])]):t._e()],1)},ht=[],dt={name:"ControlsSwitch",components:{SvgButton:J},data:function(){return{controls:this.$bluemap.appState.controls}},computed:{isPerspectiveView:function(){return"perspective"===this.controls.state},isFlatView:function(){return"flat"===this.controls.state},isFreeFlight:function(){return"free"===this.controls.state}},methods:{setPerspectiveView:function(){this.$bluemap.setPerspectiveView(500,this.isFreeFlight?100:0)},setFlatView:function(){this.$bluemap.setFlatView(500,this.isFreeFlight?100:0)},setFreeFlight:function(){this.$bluemap.setFreeFlight(500)}}},pt=dt,mt=(i("15ce"),Object(f["a"])(pt,ut,ht,!1,null,null,null)),ft=mt.exports,vt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("SvgButton",{staticClass:"menu-button",class:{close:t.close,back:t.back},on:{action:function(e){return t.$emit("action",e)}}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("g",[i("path",{attrs:{d:"M25.004,9.294c0,0.806-0.75,1.46-1.676,1.46H6.671c-0.925,0-1.674-0.654-1.674-1.46l0,0\n  c0-0.807,0.749-1.461,1.674-1.461h16.657C24.254,7.833,25.004,8.487,25.004,9.294L25.004,9.294z"}}),i("path",{attrs:{d:"M25.004,15c0,0.807-0.75,1.461-1.676,1.461H6.671c-0.925,0-1.674-0.654-1.674-1.461l0,0\n  c0-0.807,0.749-1.461,1.674-1.461h16.657C24.254,13.539,25.004,14.193,25.004,15L25.004,15z"}}),i("path",{attrs:{d:"M25.004,20.706c0,0.807-0.75,1.461-1.676,1.461H6.671c-0.925,0-1.674-0.654-1.674-1.461l0,0\n  c0-0.807,0.749-1.461,1.674-1.461h16.657C24.254,19.245,25.004,19.899,25.004,20.706L25.004,20.706z"}})])])])},gt=[],yt={name:"MenuButton",components:{SvgButton:J},props:{close:Boolean,back:Boolean}},bt=yt,wt=(i("1864"),Object(f["a"])(bt,vt,gt,!1,null,null,null)),Mt=wt.exports,kt={name:"ControlBar",components:{SvgButton:J,MenuButton:Mt,ControlsSwitch:ft,DayNightSwitch:ct,PositionInput:M,Compass:nt},data:function(){return{appState:this.$bluemap.appState,markers:this.$bluemap.mapViewer.markers.data}},computed:{playerMarkerSet:function(){var t,e=Object(l["a"])(this.markers.markerSets);try{for(e.s();!(t=e.n()).done;){var i=t.value;if("bm-players"===i.id)return i}}catch(n){e.e(n)}finally{e.f()}return{id:"bm-players",label:"Players",markerSets:[],markers:[],fake:!0}}},methods:{openPlayerList:function(){var t=this.playerMarkerSet;this.appState.menu.openPage("markers",this.$t("players.title"),{markerSet:t})}}},St=kt,xt=(i("6865"),Object(f["a"])(St,r,o,!1,null,null,null)),Ot=xt.exports,Tt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("SideMenu",{attrs:{open:t.menu.isOpen,title:t.menu.currentPage().title,back:t.menu.pageStack.length>1},on:{back:function(e){return t.menu.closePage()},close:function(e){return t.menu.closeAll()}}},["root"===t.menu.currentPage().id?i("div",[i("SimpleButton",{attrs:{submenu:!0},on:{action:function(e){t.menu.openPage("maps",(function(){return t.$t("maps.title")}))}}},[t._v(t._s(t.$t("maps.button")))]),i("SimpleButton",{attrs:{submenu:!0},on:{action:function(e){t.menu.openPage("markers",(function(){return t.$t("markers.title")}),{markerSet:t.markers})}}},[t._v(t._s(t.$t("markers.button")))]),i("SimpleButton",{attrs:{submenu:!0},on:{action:function(e){t.menu.openPage("settings",(function(){return t.$t("settings.title")}))}}},[t._v(t._s(t.$t("settings.button")))]),i("SimpleButton",{attrs:{submenu:!0},on:{action:function(e){t.menu.openPage("info",(function(){return t.$t("info.title")}))}}},[t._v(t._s(t.$t("info.button")))]),i("hr"),i("SimpleButton",{on:{action:t.goFullscreen}},[t._v(t._s(t.$t("goFullscreen.button")))]),i("SimpleButton",{on:{action:function(e){return t.$bluemap.resetCamera()}}},[t._v(t._s(t.$t("resetCamera.button")))]),i("SimpleButton",{on:{action:function(e){return t.$bluemap.takeScreenshot()}}},[t._v(t._s(t.$t("screenshot.button")))]),i("SimpleButton",{attrs:{title:t.$t("updateMap.tooltip")},on:{action:function(e){return t.$bluemap.updateMap()}}},[t._v(t._s(t.$t("updateMap.button")))])],1):t._e(),"maps"===t.menu.currentPage().id?i("div",t._l(t.appState.maps,(function(t){return i("MapButton",{key:t.id,attrs:{map:t}})})),1):t._e(),"markers"===t.menu.currentPage().id?i("MarkerSetMenu",{attrs:{menu:t.menu}}):t._e(),"settings"===t.menu.currentPage().id?i("SettingsMenu"):t._e(),"info"===t.menu.currentPage().id?i("div",{staticClass:"info-content",domProps:{innerHTML:t._s(t.$t("info.content",{version:t.$bluemap.settings.version}))}}):t._e()],1)},jt=[],Pt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Transition",{attrs:{name:"side-menu"},on:{enter:function(e){t.buttonEnterAnimation(),t.$emit("enter",e)}}},[t.open?i("div",{staticClass:"side-menu"},[i("MenuButton",{attrs:{close:t.open&&t.rendered,back:t.back},on:{action:function(e){return t.$emit("back",e)}}}),t.open&&t.back?i("MenuButton",{staticClass:"full-close",attrs:{close:!0},on:{action:function(e){return t.$emit("close",e)}}}):t._e(),i("div",{staticClass:"title"},[t._v(t._s(t.title))]),i("div",{staticClass:"content"},[t._t("default")],2)],1):t._e()])},Dt=[],Lt=i("1da1"),Et=(i("96cf"),{name:"SideMenu",components:{MenuButton:Mt},props:{title:{type:String,default:"Menu"},open:{type:Boolean,default:!0},back:Boolean},data:function(){return{rendered:!1}},methods:{buttonEnterAnimation:function(){var t=this;return Object(Lt["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.rendered=!1,e.next=3,t.$nextTick();case 3:return e.next=5,t.$nextTick();case 5:t.rendered=!0;case 6:case"end":return e.stop()}}),e)})))()}}}),Ct=Et,_t=(i("4b42"),Object(f["a"])(Ct,Pt,Dt,!1,null,null,null)),zt=_t.exports,At=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"simple-button",class:{active:t.active},on:{click:function(e){return t.$emit("action")}}},[i("div",{staticClass:"label"},[t._t("default")],2),t.submenu?i("div",{staticClass:"submenu-icon"},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("path",{attrs:{d:"M25.004,9.294c0,0.806-0.75,1.46-1.676,1.46H6.671c-0.925,0-1.674-0.654-1.674-1.46l0,0\r\n\tc0-0.807,0.749-1.461,1.674-1.461h16.657C24.254,7.833,25.004,8.487,25.004,9.294L25.004,9.294z"}}),i("path",{attrs:{d:"M25.004,20.706c0,0.807-0.75,1.461-1.676,1.461H6.671c-0.925,0-1.674-0.654-1.674-1.461l0,0\r\n\tc0-0.807,0.749-1.461,1.674-1.461h16.657C24.254,19.245,25.004,19.899,25.004,20.706L25.004,20.706z"}})])]):t._e()])},Ut=[],Ft={name:"SimpleButton",props:{submenu:Boolean,active:{type:Boolean,default:!1}}},Rt=Ft,Vt=(i("9eb8"),Object(f["a"])(Rt,At,Ut,!1,null,null,null)),Ht=Vt.exports,Bt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("Group",{attrs:{title:t.$t("controls.title")}},[i("SimpleButton",{attrs:{active:"perspective"===t.appState.controls.state},on:{action:function(e){return t.$bluemap.setPerspectiveView(500,"free"===t.appState.controls.state?100:0)}}},[t._v(t._s(t.$t("controls.perspective.button")))]),i("SimpleButton",{attrs:{active:"flat"===t.appState.controls.state},on:{action:function(e){return t.$bluemap.setFlatView(500,"free"===t.appState.controls.state?100:0)}}},[t._v(t._s(t.$t("controls.flatView.button")))]),i("SimpleButton",{attrs:{active:"free"===t.appState.controls.state},on:{action:function(e){return t.$bluemap.setFreeFlight(500)}}},[t._v(t._s(t.$t("controls.freeFlight.button")))])],1),i("Group",{attrs:{title:t.$t("lighting.title")}},[i("Slider",{attrs:{value:t.mapViewer.uniforms.sunlightStrength.value,min:0,max:1,step:.01},on:{update:function(e){t.mapViewer.uniforms.sunlightStrength.value=e}}},[t._v(t._s(t.$t("lighting.sunlight")))]),i("Slider",{attrs:{value:t.mapViewer.uniforms.ambientLight.value,min:0,max:1,step:.01},on:{update:function(e){t.mapViewer.uniforms.ambientLight.value=e}}},[t._v(t._s(t.$t("lighting.ambientLight")))])],1),i("Group",{attrs:{title:t.$t("resolution.title")}},t._l(t.qualityStages,(function(e){return i("SimpleButton",{key:e.name,attrs:{active:t.mapViewer.superSampling===e.value},on:{action:function(i){t.$bluemap.mapViewer.superSampling=e.value,t.$bluemap.saveUserSettings()}}},[t._v(t._s(e.name))])})),1),i("Group",{attrs:{title:t.$t("renderDistance.title")}},[i("Slider",{attrs:{value:t.mapViewer.loadedHiresViewDistance,min:t.settings.hiresSliderMin,max:t.settings.hiresSliderMax,step:10,formatter:t.renderDistanceFormatter},on:{update:function(e){t.mapViewer.loadedHiresViewDistance=e,t.$bluemap.mapViewer.updateLoadedMapArea()},lazy:function(e){return t.$bluemap.saveUserSettings()}}},[t._v(t._s(t.$t("renderDistance.hiresLayer")))]),i("Slider",{attrs:{value:t.mapViewer.loadedLowresViewDistance,min:t.settings.lowresSliderMin,max:t.settings.lowresSliderMax,step:100},on:{update:function(e){t.mapViewer.loadedLowresViewDistance=e,t.$bluemap.mapViewer.updateLoadedMapArea()},lazy:function(e){return t.$bluemap.saveUserSettings()}}},[t._v(t._s(t.$t("renderDistance.lowersLayer")))]),i("SwitchButton",{attrs:{on:!t.appState.controls.pauseTileLoading},on:{action:function(e){t.appState.controls.pauseTileLoading=!t.appState.controls.pauseTileLoading,t.$bluemap.saveUserSettings()}}},[t._v(t._s(t.$t("renderDistance.loadHiresWhileMoving")))])],1),i("Group",{attrs:{title:t.$t("freeFlightControls.title")}},[i("Slider",{attrs:{value:t.appState.controls.mouseSensitivity,min:.1,max:5,step:.05},on:{update:function(e){t.appState.controls.mouseSensitivity=e,t.$bluemap.updateControlsSettings()},lazy:function(e){return t.$bluemap.saveUserSettings()}}},[t._v(t._s(t.$t("freeFlightControls.mouseSensitivity")))]),i("SwitchButton",{attrs:{on:t.appState.controls.invertMouse},on:{action:function(e){t.appState.controls.invertMouse=!t.appState.controls.invertMouse,t.$bluemap.updateControlsSettings(),t.$bluemap.saveUserSettings()}}},[t._v(t._s(t.$t("freeFlightControls.invertMouseY")))])],1),i("Group",{attrs:{title:t.$t("theme.title")}},t._l(t.themes,(function(e){return i("SimpleButton",{key:e.name,attrs:{active:t.appState.theme===e.value},on:{action:function(i){t.$bluemap.setTheme(e.value),t.$bluemap.saveUserSettings()}}},[t._v(t._s(e.name))])})),1),i("Group",{attrs:{title:t.$t("screenshot.title")}},[i("SwitchButton",{attrs:{on:t.appState.screenshot.clipboard},on:{action:function(e){t.appState.screenshot.clipboard=!t.appState.screenshot.clipboard,t.$bluemap.saveUserSettings()}}},[t._v(t._s(t.$t("screenshot.clipboard")))])],1),t.$i18n.languages.length>1?i("Group",{attrs:{title:t.$t("language.title")}},t._l(t.$i18n.languages,(function(e){return i("SimpleButton",{key:e.locale,attrs:{active:e.locale===t.$i18n.locale},on:{action:function(i){t.$i18n.setLanguage(e.locale),t.$bluemap.saveUserSettings()}}},[t._v(t._s(e.name))])})),1):t._e(),i("SwitchButton",{attrs:{on:t.appState.debug},on:{action:function(e){t.switchDebug(),t.$bluemap.saveUserSettings()}}},[t._v(t._s(t.$t("debug.button")))]),i("SimpleButton",{on:{action:function(e){return t.$bluemap.resetSettings()}}},[t._v(t._s(t.$t("resetAllSettings.button")))])],1)},$t=[],Nt=i("5530"),It=(i("b680"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"group"},[i("span",{staticClass:"title"},[t._v(t._s(t.title))]),i("div",{staticClass:"content"},[t._t("default")],2)])}),Yt=[],Kt={name:"Group",props:{title:String}},Wt=Kt,Gt=(i("fd67"),Object(f["a"])(Wt,It,Yt,!1,null,null,null)),Xt=Gt.exports,Zt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"slider"},[i("div",{staticClass:"label"},[t._t("default"),t._v(": "),i("span",{staticClass:"value"},[t._v(t._s(t.formatter(t.value)))])],2),i("label",[i("input",{attrs:{type:"range",min:t.min,max:t.max,step:t.step},domProps:{value:t.value},on:{input:function(e){t.$emit("update",parseFloat(e.target.value))},change:function(e){t.$emit("lazy",parseFloat(e.target.value))}}})])])},qt=[];function Qt(t){return Math.floor(t)===t?0:t.toString().split(".")[1].length||0}var Jt={name:"Slider",props:{value:Number,min:Number,max:Number,step:Number,formatter:{type:Function,default:function(t){return parseFloat(t).toFixed(Qt(this.step))}}}},te=Jt,ee=(i("c70c"),Object(f["a"])(te,Zt,qt,!1,null,null,null)),ie=ee.exports,ne=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"switch-button",on:{click:function(e){return t.$emit("action")}}},[i("div",{staticClass:"label"},[t._t("default")],2),i("SwitchHandle",{attrs:{on:t.on}})],1)},ae=[],se=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"switch",class:{on:t.on}})},re=[],oe={name:"SwitchHandle",props:{on:Boolean}},le=oe,ce=(i("ef8f"),Object(f["a"])(le,se,re,!1,null,null,null)),ue=ce.exports,he={name:"SwitchButton",components:{SwitchHandle:ue},props:{on:Boolean}},de=he,pe=(i("635d"),Object(f["a"])(de,ne,ae,!1,null,null,null)),me=pe.exports,fe=(i("3ca3"),i("ddb0"),i("a925")),ve={pageTitle:"BlueMap - {map}",menu:{title:"Menu",tooltip:"Menu"},maps:{title:"Maps",button:"Maps",tooltip:"Map-List"},markers:{title:"Markers",button:"Markers",tooltip:"Marker-List",marker:"marker | markers",markerSet:"marker-set | marker-sets",searchPlaceholder:"Search...",followPlayerTitle:"Follow Player"},settings:{title:"Settings",button:"Settings"},goFullscreen:{button:"Go Fullscreen"},resetCamera:{button:"Reset Camera",tooltip:"Reset Camera & Position"},updateMap:{button:"Update Map",tooltip:"Clear Tile Cache"},lighting:{title:"Lighting",dayNightSwitch:{tooltip:"Day/Night"},sunlight:"Sunlight",ambientLight:"Ambient-Light"},resolution:{title:"Resolution",high:"High (SSAA, x2)",normal:"Normal (Native, x1)",low:"Low (Upscaling, x0.5)"},freeFlightControls:{title:"Free-Flight Controls",mouseSensitivity:"Mouse-Sensitivity",invertMouseY:"Invert Mouse Y"},renderDistance:{title:"Render Distance",hiresLayer:"Hires layer",lowersLayer:"Lowres layer",loadHiresWhileMoving:"Load hires-tiles while moving",off:"Off"},theme:{title:"Theme",default:"Default (System/Browser)",dark:"Dark",light:"Light",contrast:"Contrast"},debug:{button:"Debug"},resetAllSettings:{button:"Reset All Settings"},players:{title:"Players",tooltip:"Player-List"},compass:{tooltip:"Compass / Face North"},screenshot:{title:"Screenshot",button:"Take Screenshot",clipboard:"Copy to Clipboard"},controls:{title:"View / Controls",perspective:{button:"Perspective",tooltip:"Perspective-View"},flatView:{button:"Flat",tooltip:"Orthographic / Flat-View"},freeFlight:{button:"Free-Flight",tooltip:"Free-Flight / Spectator Mode"}},language:{title:"Language"},blockTooltip:{block:"Block",position:"Position",chunk:"Chunk",region:{region:"Region",file:"File"},light:{light:"Light",sun:"Sun",block:"Block"}},info:{title:"Info",button:"Info",content:'\n<img src="assets/logo.png" style="display: block; width: 40%; margin: 3em auto; border-radius: 50%">\n<p>\n\t<h2>Mouse-Controls:</h2>\n\t<table>\n\t\t<tr><th>move</th><td><kbd>left-click</kbd> + drag</td></tr>\n\t\t<tr><th>zoom</th><td><kbd>mousewheel</kbd> (scroll)</td></tr>\n\t\t<tr><th>rotate / tilt</th><td><kbd>right-click</kbd> + drag</td></tr>\n\t</table>\n</p>\n<p>\n\t<h2>Keyboard-Controls:</h2>\n\t<table>\n\t\t<tr><th>move</th><td><kbd>wasd</kbd> / <kbd>arrow-keys</kbd></td></tr>\n\t\t<tr><th>zoom</th><td>Numpad: <kbd>+</kbd>/<kbd>-</kbd> or <kbd>Ins</kbd>/<kbd>Home</kbd></td></tr>\n\t\t<tr><th>rotate / tilt</th><td><kbd>Left-Alt</kbd> + <kbd>wasd</kbd> / <kbd>arrow-keys</kbd> or <kbd>Delete</kbd>/<kbd>End</kbd>/<kbd>Page Up</kbd>/<kbd>Page Down</kbd></td></tr>\n\t</table>\n</p>\n<p>\n\t<h2>Touch-Controls:</h2>\n\t<table>\n\t\t<tr><th>move</th><td>touch + drag</td></tr>\n\t\t<tr><th>zoom</th><td>touch with two fingers + pinch</td></tr>\n\t\t<tr><th>rotate / tilt</th><td>touch with two fingers + rotate / move up/down</td></tr>\n\t</table>\n</p>\n<br><hr>\n<p class="info-footer">\n\tThis map has been generated with &#9829; using <a href="https://bluecolo.red/bluemap">BlueMap</a> {version}\n</p>\n\t\t'}};fe["a"].prototype.setLanguage=function(){var t=Object(Lt["a"])(regeneratorRuntime.mark((function t(e){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,this.messages[e]){t.next=7;break}return i={},t.next=5,import("../lang/".concat(e,".js"));case 5:i=t.sent.default,this.setLocaleMessage(e,i);case 7:this.locale=e,document.querySelector("html").setAttribute("lang",e),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](0),console.error("Failed to load language '".concat(e,"'!"),t.t0);case 14:case"end":return t.stop()}}),t,this,[[0,11]])})));return function(e){return t.apply(this,arguments)}}(),fe["a"].prototype.loadLanguageSettings=Object(Lt["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,import("../lang/settings.js");case 2:e=t.sent.default,this.languages=e.languages,this.setLanguage(e.default);case 5:case"end":return t.stop()}}),t,this)}))),n["a"].use(fe["a"]);var ge=new fe["a"]({locale:"fallback",fallbackLocale:"fallback",silentFallbackWarn:!0,messages:{fallback:ve}}),ye=ge,be=[{get name(){return ye.t("theme.default")},value:null},{get name(){return ye.t("theme.dark")},value:"dark"},{get name(){return ye.t("theme.light")},value:"light"},{get name(){return ye.t("theme.contrast")},value:"contrast"}],we=[{get name(){return ye.t("resolution.high")},value:2},{get name(){return ye.t("resolution.normal")},value:1},{get name(){return ye.t("resolution.low")},value:.5}],Me={name:"SettingsMenu",components:{SwitchButton:me,Slider:ie,SimpleButton:Ht,Group:Xt},data:function(){return{appState:this.$bluemap.appState,mapViewer:this.$bluemap.mapViewer.data,settings:Object(Nt["a"])(Object(Nt["a"])({},{hiresSliderMax:500,hiresSliderMin:50,lowresSliderMax:1e4,lowresSliderMin:500}),this.$bluemap.settings),qualityStages:we,themes:be}},methods:{switchDebug:function(){this.$bluemap.setDebug(!this.appState.debug)},renderDistanceFormatter:function(t){var e=parseFloat(t);return 0===e?this.$t("renderDistance.off"):e.toFixed(0)}}},ke=Me,Se=Object(f["a"])(ke,Bt,$t,!1,null,null,null),xe=Se.exports,Oe=i("d4ec"),Te=i("bee2"),je=i("ade3"),Pe=(i("a434"),function(){function t(){Object(Oe["a"])(this,t),this.isOpen=!1,this.pageStack=[]}return Object(Te["a"])(t,[{key:"currentPage",value:function(){return 0===this.pageStack.length?t.NULL_PAGE:this.pageStack[this.pageStack.length-1]}},{key:"openPage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"root",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return ye.t("menu.title")},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.isOpen||(this.pageStack.splice(0,this.pageStack.length),this.isOpen=!0),"function"===typeof e?this.pageStack.push(Object(Nt["a"])({id:t,get title(){return e()}},i)):this.pageStack.push(Object(Nt["a"])({id:t,title:e},i))}},{key:"closePage",value:function(){this.pageStack.splice(this.pageStack.length-1,1),this.pageStack.length<1&&(this.isOpen=!1)}},{key:"reOpenPage",value:function(){0===this.pageStack.length?this.openPage():"root"!==this.pageStack[0].id?(this.pageStack.splice(0,this.pageStack.length),this.openPage()):this.isOpen=!0}},{key:"closeAll",value:function(){this.isOpen=!1}}]),t}());Object(je["a"])(Pe,"NULL_PAGE",{id:"-",title:"-"});var De=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"marker-sets"},t._l(t.filteredMarkerSets,(function(e){return i("MarkerSet",{key:e.id,attrs:{"marker-set":e},on:{more:function(i){return t.openMore(e)}}})})),1),t.filteredMarkerSets.length>0&t.thisMarkerSet.markers.length>0?i("hr"):t._e(),t.thisMarkerSet.markers.length>0?i("div",{staticClass:"markers"},[i("TextInput",{attrs:{value:t.filter.search,placeholder:t.$t("markers.searchPlaceholder")},on:{input:function(e){t.filter.search=e.target.value}}}),t._l(t.filteredMarkers,(function(t){return i("MarkerItem",{key:t.id,attrs:{marker:t}})}))],2):t._e()])},Le=[],Ee=i("2909"),Ce=(i("4de4"),i("4e82"),i("841c"),i("b0c0"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"marker-item",class:{"marker-hidden":!t.marker.visible}},[i("div",{staticClass:"marker-button",attrs:{title:t.marker.id},on:{click:function(e){return t.click(!1)}}},["player"===t.marker.type?i("div",{staticClass:"icon"},[i("img",{attrs:{src:"assets/playerheads/"+t.marker.playerUuid+".png",alt:"playerhead"},on:{error:t.steve}})]):t._e(),i("div",{staticClass:"info"},[i("div",{staticClass:"label"},[t._v(t._s(t.markerLabel))]),i("div",{staticClass:"stats"},[t.appState.debug?i("div",[t._v(" "+t._s(t.marker.type)+"-marker ")]):t._e(),i("div",[t._v(" ("+t._s(t._f("position")(t.marker.position.x))+" | "+t._s(t._f("position")(t.marker.position.y))+" | "+t._s(t._f("position")(t.marker.position.z))+") ")])])])]),"player"===t.marker.type?i("div",{staticClass:"follow-player-button",class:{active:t.controls.controls.followingPlayer&&t.controls.controls.followingPlayer.id===t.marker.id},attrs:{title:t.$t("markers.followPlayerTitle")},on:{click:function(e){return t.click(!0)}}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("circle",{attrs:{fill:"none","stroke-width":"3","stroke-miterlimit":"10",cx:"15",cy:"15",r:"10.375"}}),i("line",{attrs:{fill:"none","stroke-width":"3","stroke-miterlimit":"10",x1:"3.25",y1:"15",x2:"1.063",y2:"15"}}),i("line",{attrs:{fill:"none","stroke-width":"3","stroke-miterlimit":"10",x1:"15",y1:"26.75",x2:"15",y2:"28.938"}}),i("line",{attrs:{fill:"none","stroke-width":"3","stroke-miterlimit":"10",x1:"26.75",y1:"15",x2:"28.938",y2:"15"}}),i("line",{attrs:{fill:"none","stroke-width":"3","stroke-miterlimit":"10",x1:"15",y1:"3.25",x2:"15",y2:"1.063"}}),i("circle",{attrs:{stroke:"none",cx:"15",cy:"15",r:"6.042"}})])]):t._e()])}),_e=[],ze={name:"MarkerItem",props:{marker:Object},data:function(){return{appState:this.$bluemap.appState,controls:this.$bluemap.mapViewer.controlsManager.data}},computed:{markerLabel:function(){switch(this.marker.type){case"player":return this.marker.name;default:break}if(this.marker.label){var t=/^(?:<[^>]*>\s*)*([^<>]*\S[^<>]*)(?:<|$)/gi.exec(this.marker.label);if(t&&t.length>1)return t[1]}return this.marker.id}},filters:{position:function(t){return Math.floor(t)}},methods:{click:function(t){var e=this;return Object(Lt["a"])(regeneratorRuntime.mark((function i(){var n,a;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=e.$bluemap.mapViewer.controlsManager,n.controls&&n.controls.stopFollowingPlayerMarker&&n.controls.stopFollowingPlayerMarker(),"player"!==e.marker.type){i.next=14;break}if(!e.marker.foreign){i.next=11;break}return i.next=6,e.$bluemap.findPlayerMap(e.marker.playerUuid);case 6:if(a=i.sent,a){i.next=9;break}return i.abrupt("return");case 9:return i.next=11,e.$bluemap.switchMap(a.data.id);case 11:t&&n.controls&&n.controls.followPlayerMarker&&e.marker.visible&&n.controls.followPlayerMarker(e.marker),i.next=16;break;case 14:if(e.marker.visible){i.next=16;break}return i.abrupt("return");case 16:n.position.copy(e.marker.position);case 17:case"end":return i.stop()}}),i)})))()},steve:function(t){t.target.src="assets/steve.png"}}},Ae=ze,Ue=(i("12f6"),Object(f["a"])(Ae,Ce,_e,!1,null,null,null)),Fe=Ue.exports,Re=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("input",{staticClass:"text-input",attrs:{type:"text"},domProps:{value:t.value},on:{input:function(e){return t.$emit("input",e)},keydown:function(t){return t.stopPropagation()}}})},Ve=[],He={name:"TextInput",props:{value:String}},Be=He,$e=(i("1213"),Object(f["a"])(Be,Re,Ve,!1,null,null,null)),Ne=$e.exports,Ie=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"marker-set",attrs:{title:t.markerSet.id}},[i("div",{staticClass:"info",on:{click:t.toggle}},[i("div",{staticClass:"marker-set-switch"},[i("div",{staticClass:"label"},[t._v(t._s(t.label))]),t.markerSet.toggleable?i("SwitchHandle",{attrs:{on:t.markerSet.visible}}):t._e()],1),i("div",{staticClass:"stats"},[i("div",[t._v(" "+t._s(t.markerSet.markers.length)+" "+t._s(t.$tc("markers.marker",t.markerSet.markers.length))+" ")]),t.filteredMarkerSets.length>0?i("div",[t._v(" "+t._s(t.filteredMarkerSets.length)+" "+t._s(t.$tc("markers.markerSet",t.filteredMarkerSets.length))+" ")]):t._e()])]),i("div",{staticClass:"open-menu-button",on:{click:function(e){return t.$emit("more",e)}}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("path",{attrs:{d:"M25.004,9.294c0,0.806-0.75,1.46-1.676,1.46H6.671c-0.925,0-1.674-0.654-1.674-1.46l0,0\n\tc0-0.807,0.749-1.461,1.674-1.461h16.657C24.254,7.833,25.004,8.487,25.004,9.294L25.004,9.294z"}}),i("path",{attrs:{d:"M25.004,20.706c0,0.807-0.75,1.461-1.676,1.461H6.671c-0.925,0-1.674-0.654-1.674-1.461l0,0\n\tc0-0.807,0.749-1.461,1.674-1.461h16.657C24.254,19.245,25.004,19.899,25.004,20.706L25.004,20.706z"}})])])])},Ye=[],Ke={name:"MarkerSet",components:{SwitchHandle:ue},props:{markerSet:Object},computed:{filteredMarkerSets:function(){return this.markerSet.markerSets.filter((function(t){return"bm-popup-set"!==t.id}))},label:function(){return"bm-players"===this.markerSet.id?this.$t("players.title"):this.markerSet.label}},methods:{toggle:function(){this.markerSet.toggleable&&(this.markerSet.visible=!this.markerSet.visible)}}},We=Ke,Ge=(i("bfc9"),Object(f["a"])(We,Ie,Ye,!1,null,null,null)),Xe=Ge.exports,Ze={name:"MarkerSetMenu",components:{MarkerSet:Xe,TextInput:Ne,MarkerItem:Fe},props:{menu:Pe},data:function(){return{filter:{search:""}}},computed:{thisMarkerSet:function(){return this.menu.currentPage().markerSet},filteredMarkers:function(){var t=this;return Object(Ee["a"])(this.thisMarkerSet.markers).sort((function(t,e){return t.id<e.id?-1:t.id>e.id?1:0})).filter((function(e){return!t.filter.search||(!!e.id.includesCI(t.filter.search)||(!(!e.label||!e.label.includesCI(t.filter.search))||!("player"!==e.type||!e.name.includesCI(t.filter.search)&&!e.playerUuid.includesCI(t.filter.search))))}))},filteredMarkerSets:function(){return this.thisMarkerSet.markerSets.filter((function(t){return"bm-popup-set"!==t.id}))}},methods:{openMore:function(t){this.menu.openPage(this.menu.currentPage().id,this.menu.currentPage().title+" > "+t.label,{markerSet:t})}}},qe=Ze,Qe=Object(f["a"])(qe,De,Le,!1,null,null,null),Je=Qe.exports,ti=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"map-button",class:{selected:t.map.id===t.selectedMapId},attrs:{title:t.map.id},on:{click:function(e){return t.switchMap(t.map.id)}}},[i("span",{staticClass:"sky",style:{color:"rgb("+255*t.map.skyColor.r+","+255*t.map.skyColor.g+","+255*t.map.skyColor.b+")"}},[t._v("•")]),i("span",{staticClass:"name"},[t._v(t._s(t.map.name))])])},ei=[],ii=(i("d81d"),{name:"MapButton",props:{map:Object},data:function(){return{mapViewer:this.$bluemap.mapViewer.data,appState:this.$bluemap.appState}},computed:{selectedMapId:function(){return this.mapViewer.map?this.mapViewer.map.id:null}},methods:{switchMap:function(t){this.$bluemap.switchMap(t)}}}),ni=ii,ai=(i("2b31"),Object(f["a"])(ni,ti,ei,!1,null,null,null)),si=ai.exports,ri={name:"MainMenu",components:{MapButton:si,MarkerSetMenu:Je,SettingsMenu:xe,SimpleButton:Ht,SideMenu:zt},props:{menu:Pe},data:function(){return{appState:this.$bluemap.appState,markers:this.$bluemap.mapViewer.markers.data}},methods:{goFullscreen:function(){document.body.requestFullscreen()}}},oi=ri,li=(i("ce79"),Object(f["a"])(oi,Tt,jt,!1,null,null,null)),ci=li.exports,ui=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:{disabled:!t.enabled},attrs:{id:"ff-mobile-controls"}},[i("div",{staticClass:"move-fields"},[i("div",{staticClass:"button up-button",on:{touchstart:function(e){t.forward=1,t.forwardPointer=e.changedTouches[0].identifier,e.preventDefault()}}},[i("svg",{attrs:{viewBox:"0 0 100 50"}},[i("path",{attrs:{d:"M6.75,48.375c-2.75,0-3.384-1.565-1.409-3.479L46.41,5.104c1.975-1.914,5.207-1.913,7.182,0l41.067,39.792\n          c1.975,1.914,1.341,3.479-1.409,3.479H6.75z"}})])]),i("div",{staticClass:"button down-button",on:{touchstart:function(e){t.forward=-1,t.forwardPointer=e.changedTouches[0].identifier,e.preventDefault()}}},[i("svg",{staticClass:"down",attrs:{viewBox:"0 0 100 50"}},[i("path",{attrs:{d:"M6.75,48.375c-2.75,0-3.384-1.565-1.409-3.479L46.41,5.104c1.975-1.914,5.207-1.913,7.182,0l41.067,39.792\n          c1.975,1.914,1.341,3.479-1.409,3.479H6.75z"}})])])]),i("div",{staticClass:"height-fields"},[i("div",{staticClass:"button up-button",on:{touchstart:function(e){t.up=1,t.upPointer=e.changedTouches[0].identifier,e.preventDefault()}}},[i("svg",{attrs:{viewBox:"0 0 100 50"}},[i("path",{attrs:{d:"M6.75,48.375c-2.75,0-3.384-1.565-1.409-3.479L46.41,5.104c1.975-1.914,5.207-1.913,7.182,0l41.067,39.792\n          c1.975,1.914,1.341,3.479-1.409,3.479H6.75z"}})])]),i("div",{staticClass:"button down-button",on:{touchstart:function(e){t.up=-1,t.upPointer=e.changedTouches[0].identifier,e.preventDefault()}}},[i("svg",{staticClass:"down",attrs:{viewBox:"0 0 100 50"}},[i("path",{attrs:{d:"M6.75,48.375c-2.75,0-3.384-1.565-1.409-3.479L46.41,5.104c1.975-1.914,5.207-1.913,7.182,0l41.067,39.792\n          c1.975,1.914,1.341,3.479-1.409,3.479H6.75z"}})])])])])},hi=[],di={name:"FreeFlightMobileControls",data:function(){return{enabled:!1,forward:0,forwardPointer:-1,up:0,upPointer:-1}},methods:{onTouchStop:function(t){console.log("Stop: ",t),t.changedTouches[0].identifier===this.forwardPointer&&(this.forward=0),t.changedTouches[0].identifier===this.upPointer&&(this.up=0)},onFrame:function(t){var e=this.$bluemap.mapViewer.controlsManager;e.position.x+=this.forward*Math.sin(e.rotation)*t.detail.delta*.02,e.position.z+=this.forward*-Math.cos(e.rotation)*t.detail.delta*.02,e.position.y+=this.up*t.detail.delta*.01},enable:function(t){this.enabled=!0}},mounted:function(){window.addEventListener("touchstart",this.enable),window.addEventListener("touchend",this.onTouchStop),window.addEventListener("touchcancel",this.onTouchStop),this.$bluemap.events.addEventListener("bluemapRenderFrame",this.onFrame)},beforeDestroy:function(){window.removeEventListener("touchstart",this.enable),window.removeEventListener("touchend",this.onTouchStop),window.removeEventListener("touchcancel",this.onTouchStop),this.$bluemap.events.removeEventListener("bluemapRenderFrame",this.onFrame)}},pi=di,mi=(i("2bbd"),Object(f["a"])(pi,ui,hi,!1,null,null,null)),fi=mi.exports,vi={name:"App",components:{FreeFlightMobileControls:fi,MainMenu:ci,ControlBar:Ot},data:function(){return{appState:this.$bluemap.appState}}},gi=vi,yi=(i("5c0b"),Object(f["a"])(gi,a,s,!1,null,null,null)),bi=yi.exports,wi=(i("4ec9"),function(){function t(e,i,n,a){Object(Oe["a"])(this,t),Object.defineProperty(this,"isTile",{value:!0}),this.model=null,this.onLoad=n,this.onUnload=a,this.x=e,this.z=i,this.unloaded=!0,this.loading=!1}return Object(Te["a"])(t,[{key:"load",value:function(e){var i=this;return this.loading?Promise.reject("tile is already loading!"):(this.loading=!0,this.unload(),this.unloaded=!1,e.load(this.x,this.z,(function(){return i.unloaded})).then((function(e){i.unloaded?t.disposeModel(e):(i.model=e,i.onLoad(i))})).finally((function(){i.loading=!1})))}},{key:"unload",value:function(){this.unloaded=!0,this.model&&(this.onUnload(this),t.disposeModel(this.model),this.model=null)}},{key:"loaded",get:function(){return!!this.model}}],[{key:"disposeModel",value:function(t){var e,i;"hires"===(null===(e=t.userData)||void 0===e?void 0:e.tileType)?t.geometry.dispose():"lowres"===(null===(i=t.userData)||void 0===i?void 0:i.tileType)&&(t.material.uniforms.textureImage.value.dispose(),t.material.dispose())}}]),t}()),Mi=function(){function t(e,i){Object(Oe["a"])(this,t),this.canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.canvas.width=e,this.canvas.height=i,this.tileMapContext=this.canvas.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.texture=new O["J"](this.canvas),this.texture.generateMipmaps=!1,this.texture.magFilter=O["q"],this.texture.minFilter=O["q"],this.texture.wrapS=O["e"],this.texture.wrapT=O["e"],this.texture.flipY=!1,this.texture.needsUpdate=!0}return Object(Te["a"])(t,[{key:"setAll",value:function(t){this.tileMapContext.fillStyle=t,this.tileMapContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.texture.needsUpdate=!0}},{key:"setTile",value:function(t,e,i){this.tileMapContext.fillStyle=i,this.tileMapContext.fillRect(t,e,1,1),this.texture.needsUpdate=!0}}]),t}();Object(je["a"])(Mi,"EMPTY","#000"),Object(je["a"])(Mi,"LOADED","#fff");var ki=function(){function t(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Object(Oe["a"])(this,t),Object(je["a"])(this,"loadCloseTiles",(function(){i.unloaded||i.loadNextTile()&&(i.loadTimeout&&clearTimeout(i.loadTimeout),i.currentlyLoading<8?i.loadTimeout=setTimeout(i.loadCloseTiles,0):i.loadTimeout=setTimeout(i.loadCloseTiles,1e3))})),Object(je["a"])(this,"handleLoadedTile",(function(e){i.tileMap.setTile(e.x-i.centerTile.x+t.tileMapHalfSize,e.z-i.centerTile.y+t.tileMapHalfSize,Mi.LOADED),i.scene.add(e.model),i.onTileLoad(e)})),Object(je["a"])(this,"handleUnloadedTile",(function(e){i.tileMap.setTile(e.x-i.centerTile.x+t.tileMapHalfSize,e.z-i.centerTile.y+t.tileMapHalfSize,Mi.EMPTY),i.scene.remove(e.model),i.onTileUnload(e)})),Object.defineProperty(this,"isTileManager",{value:!0}),this.sceneParent=new O["B"],this.scene=new O["l"],this.sceneParent.add(this.scene),this.events=s,this.tileLoader=e,this.onTileLoad=n||function(){},this.onTileUnload=a||function(){},this.viewDistanceX=1,this.viewDistanceZ=1,this.centerTile=new O["N"](0,0),this.currentlyLoading=0,this.loadTimeout=null,this.tiles=new Map,this.tileMap=new Mi(t.tileMapSize,t.tileMapSize),this.unloaded=!0}return Object(Te["a"])(t,[{key:"loadAroundTile",value:function(e,i,n,a){var s=this;this.unloaded=!1;var r=!1;(this.viewDistanceX>n||this.viewDistanceZ>a)&&(r=!0),this.viewDistanceX=n,this.viewDistanceZ=a,n<=0||a<=0?this.removeAllTiles():((r||this.centerTile.x!==e||this.centerTile.y!==i)&&(this.centerTile.set(e,i),this.removeFarTiles(),this.tileMap.setAll(Mi.EMPTY),this.tiles.forEach((function(e){e.loading||e.unloaded||s.tileMap.setTile(e.x-s.centerTile.x+t.tileMapHalfSize,e.z-s.centerTile.y+t.tileMapHalfSize,Mi.LOADED)}))),this.loadCloseTiles())}},{key:"unload",value:function(){this.unloaded=!0,this.removeAllTiles()}},{key:"removeFarTiles",value:function(){var t=this;this.tiles.forEach((function(e,i,n){(e.x+t.viewDistanceX<t.centerTile.x||e.x-t.viewDistanceX>t.centerTile.x||e.z+t.viewDistanceZ<t.centerTile.y||e.z-t.viewDistanceZ>t.centerTile.y)&&(e.unload(),n.delete(i))}))}},{key:"removeAllTiles",value:function(){this.tileMap.setAll(Mi.EMPTY),this.tiles.forEach((function(t){t.unload()})),this.tiles.clear()}},{key:"loadNextTile",value:function(){if(this.unloaded)return!1;var t=0,e=0,i=1,n=1;while(n<2*Math.max(this.viewDistanceX,this.viewDistanceZ)+1){while(2*t*i<n){if(this.tryLoadTile(this.centerTile.x+t,this.centerTile.y+e))return!0;t+=i}while(2*e*i<n){if(this.tryLoadTile(this.centerTile.x+t,this.centerTile.y+e))return!0;e+=i}i*=-1,n+=1}return!1}},{key:"tryLoadTile",value:function(t,e){var i=this;if(this.unloaded)return!1;if(Math.abs(t-this.centerTile.x)>this.viewDistanceX)return!1;if(Math.abs(e-this.centerTile.y)>this.viewDistanceZ)return!1;var n=L(t,e),a=this.tiles.get(n);return void 0===a&&(this.currentlyLoading++,a=new wi(t,e,this.handleLoadedTile,this.handleUnloadedTile),this.tiles.set(n,a),a.load(this.tileLoader).then((function(){i.loadTimeout&&clearTimeout(i.loadTimeout),i.loadTimeout=setTimeout(i.loadCloseTiles,0)})).catch((function(t){})).finally((function(){i.currentlyLoading--})),!0)}}]),t}();Object(je["a"])(ki,"tileMapSize",100),Object(je["a"])(ki,"tileMapHalfSize",ki.tileMapSize/2);var Si=Object(Te["a"])((function t(e,i,n){var a=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return Promise.resolve()},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;Object(Oe["a"])(this,t),Object(je["a"])(this,"load",(function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!1},n=a.tilePath+P(t,e)+".json";return new Promise((function(s,r){a.fileLoader.load(n+"?"+a.tileCacheHash,function(){var o=Object(Lt["a"])(regeneratorRuntime.mark((function o(l){var c,u,h,d,p,m;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(c=l.tileGeometry||{},c.type&&"BufferGeometry"===c.type){o.next=4;break}return r({status:"empty"}),o.abrupt("return");case 4:return o.next=6,a.loadBlocker();case 6:if(!i()){o.next=9;break}return r({status:"cancelled"}),o.abrupt("return");case 9:u=a.bufferGeometryLoader.parse(c),h=new O["t"](u,a.material),d=a.tileSettings.tileSize,p=a.tileSettings.translate,m=a.tileSettings.scale,h.position.set(t*d.x+p.x,0,e*d.z+p.z),h.scale.set(m.x,1,m.z),h.userData.tileUrl=n,h.userData.tileType="hires",h.updateMatrixWorld(!0),s(h);case 20:case"end":return o.stop()}}),o)})));return function(t){return o.apply(this,arguments)}}(),(function(){}),r)}))})),Object.defineProperty(this,"isTileLoader",{value:!0}),this.tilePath=e,this.material=i,this.tileSettings=n,this.tileCacheHash=r,this.loadBlocker=s,this.fileLoader=new O["i"],this.fileLoader.setResponseType("json"),this.bufferGeometryLoader=new O["d"]})),xi=Object(Te["a"])((function t(e,i,n,a,s,r){var o=this,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:function(){return Promise.resolve()},c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;Object(Oe["a"])(this,t),Object(je["a"])(this,"load",(function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!1},n=o.tilePath+o.lod+"/"+P(t,e)+".png";return new Promise((function(a,s){o.textureLoader.load(n+"?"+o.tileCacheHash,function(){var r=Object(Lt["a"])(regeneratorRuntime.mark((function r(l){var c,u,h;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return l.anisotropy=1,l.generateMipmaps=!1,l.magFilter=O["v"],l.minFilter=l.generateMipmaps?O["w"]:O["v"],l.wrapS=O["e"],l.wrapT=O["e"],l.flipY=!1,l.flatShading=!0,r.next=10,o.loadBlocker();case 10:if(!i()){r.next=14;break}return l.dispose(),s({status:"cancelled"}),r.abrupt("return");case 14:c=new O["E"]({uniforms:Object(Nt["a"])(Object(Nt["a"])({},o.uniforms),{},{tileSize:{value:new O["N"](o.tileSettings.tileSize.x,o.tileSettings.tileSize.z)},textureSize:{value:new O["N"](l.image.width,l.image.height)},textureImage:{type:"t",value:l}}),vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,transparent:!1,depthWrite:!0,depthTest:!0,vertexColors:O["Q"],side:O["k"],wireframe:!1}),u=new O["t"](o.geometry,c),h=Math.pow(o.tileSettings.lodFactor,o.lod-1),u.position.set(t*o.tileSettings.tileSize.x*h,0,e*o.tileSettings.tileSize.z*h),u.scale.set(h,1,h),u.userData.tileUrl=n,u.userData.tileType="lowres",u.updateMatrixWorld(!0),a(u);case 23:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}(),void 0,s)}))})),Object.defineProperty(this,"isLowresTileLoader",{value:!0}),this.tilePath=e,this.tileSettings=i,this.lod=n,this.loadBlocker=l,this.tileCacheHash=c,this.vertexShader=a,this.fragmentShader=s,this.uniforms=r,this.textureLoader=new O["K"],this.geometry=new O["z"](i.tileSize.x+1,i.tileSize.z+1,Math.ceil(100/(2*n)),Math.ceil(100/(2*n))),this.geometry.deleteAttribute("normal"),this.geometry.deleteAttribute("uv"),this.geometry.rotateX(-Math.PI/2),this.geometry.translate(i.tileSize.x/2+1,0,i.tileSize.x/2+1)})),Oi=function(){function t(e,i,n){var a=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Object(Oe["a"])(this,t),Object(je["a"])(this,"onTileLoad",(function(t){return function(e){C(a.events,"bluemapMapTileLoaded",{tile:e,layer:t})}})),Object(je["a"])(this,"onTileUnload",(function(t){return function(e){C(a.events,"bluemapMapTileUnloaded",{tile:e,layer:t})}})),Object.defineProperty(this,"isMap",{value:!0}),this.loadBlocker=n,this.events=s,this.data={id:e,sorting:0,dataUrl:i,settingsUrl:i+"settings.json",texturesUrl:i+"textures.json",name:e,startPos:{x:0,z:0},skyColor:new O["f"],ambientLight:0,hires:{tileSize:{x:32,z:32},scale:{x:1,z:1},translate:{x:2,z:2}},lowres:{tileSize:{x:32,z:32},lodFactor:5,lodCount:3}},this.raycaster=new O["A"],this.hiresMaterial=null,this.lowresMaterial=null,this.loadedTextures=[],this.hiresTileManager=null,this.lowresTileManager=null}return Object(Te["a"])(t,[{key:"load",value:function(t,e,i,n,a){var s=this,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.unload();var o=this.loadSettings(),l=this.loadTexturesFile();return this.lowresMaterial=this.createLowresMaterial(i,n,a),Promise.all([o,l]).then((function(o){var l=o[1];if(null===l)throw new Error("Failed to parse textures.json!");s.hiresMaterial=s.createHiresMaterial(t,e,a,l),s.hiresTileManager=new ki(new Si("".concat(s.data.dataUrl,"tiles/0/"),s.hiresMaterial,s.data.hires,s.loadBlocker,r),s.onTileLoad("hires"),s.onTileUnload("hires"),s.events),s.hiresTileManager.scene.autoUpdate=!1,s.lowresTileManager=[];for(var c=0;c<s.data.lowres.lodCount;c++)s.lowresTileManager[c]=new ki(new xi("".concat(s.data.dataUrl,"tiles/"),s.data.lowres,c+1,i,n,a,Object(Lt["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))),r),s.onTileLoad("lowres"),s.onTileUnload("lowres"),s.events),s.lowresTileManager[c].scene.autoUpdate=!1;_(s.events,"Map '".concat(s.data.id,"' is loaded."),"fine")}))}},{key:"loadSettings",value:function(){var t=this;return this.loadSettingsFile().then((function(e){t.data.name=e.name?e.name:t.data.name,t.data.sorting=e.sorting?e.sorting:t.data.sorting,t.data.startPos=Object(Nt["a"])(Object(Nt["a"])({},t.data.startPos),$(e.startPos,!0)),e.skyColor&&e.skyColor.length>=3&&t.data.skyColor.setRGB(e.skyColor[0],e.skyColor[1],e.skyColor[2]),t.data.ambientLight=e.ambientLight?e.ambientLight:t.data.ambientLight,void 0===e.hires&&(e.hires={}),void 0===e.lowres&&(e.lowres={}),t.data.hires={tileSize:Object(Nt["a"])(Object(Nt["a"])({},t.data.hires.tileSize),$(e.hires.tileSize,!0)),scale:Object(Nt["a"])(Object(Nt["a"])({},t.data.hires.scale),$(e.hires.scale,!0)),translate:Object(Nt["a"])(Object(Nt["a"])({},t.data.hires.translate),$(e.hires.translate,!0))},t.data.lowres={tileSize:Object(Nt["a"])(Object(Nt["a"])({},t.data.lowres.tileSize),$(e.lowres.tileSize,!0)),lodFactor:void 0!==e.lowres.lodFactor?e.lowres.lodFactor:t.data.lowres.lodFactor,lodCount:void 0!==e.lowres.lodCount?e.lowres.lodCount:t.data.lowres.lodCount},_(t.events,"Settings for map '".concat(t.data.id,"' loaded."),"fine")}))}},{key:"loadMapArea",value:function(t,e,i,n){if(this.isLoaded){var a=Math.floor((t-this.data.hires.translate.x)/this.data.hires.tileSize.x),s=Math.floor((e-this.data.hires.translate.z)/this.data.hires.tileSize.z),r=Math.floor(i/this.data.hires.tileSize.x),o=Math.floor(i/this.data.hires.tileSize.z);this.hiresTileManager.loadAroundTile(a,s,r,o);for(var l=0;l<this.lowresTileManager.length;l++){var c=l+1,u=Math.pow(this.data.lowres.lodFactor,c-1),h=Math.floor(t/(this.data.lowres.tileSize.x*u)),d=Math.floor(e/(this.data.lowres.tileSize.z*u)),p=Math.floor(n/this.data.lowres.tileSize.x),m=Math.floor(n/this.data.lowres.tileSize.z);this.lowresTileManager[l].loadAroundTile(h,d,p,m)}}}},{key:"loadSettingsFile",value:function(){var t=this;return new Promise((function(e,i){_(t.events,"Loading settings for map '".concat(t.data.id,"'..."),"fine");var n=new O["i"];n.setResponseType("json"),n.load(t.data.settingsUrl+"?"+E(),e,(function(){}),(function(){return i("Failed to load the settings.json for map: ".concat(t.data.id))}))}))}},{key:"loadTexturesFile",value:function(){var t=this;return new Promise((function(e,i){_(t.events,"Loading textures for map '".concat(t.data.id,"'..."),"fine");var n=new O["i"];n.setResponseType("json"),n.load(t.data.texturesUrl+"?"+E(),e,(function(){}),(function(){return i("Failed to load the textures.json for map: ".concat(t.data.id))}))}))}},{key:"createHiresMaterial",value:function(t,e,i,n){var a=this,s=[];if(!Array.isArray(n))throw new Error("Invalid texture.json: 'textures' is not an array!");for(var r=function(r){var o=n[r],l=o.color;(!Array.isArray(l)||l.length<4)&&(l=[0,0,0,0]);var c=1===l[3],u=!!o.halfTransparent,h=new O["J"];h.image=j(o.texture),h.anisotropy=1,h.generateMipmaps=c||u,h.magFilter=O["v"],h.minFilter=h.generateMipmaps?O["w"]:O["v"],h.wrapS=O["e"],h.wrapT=O["e"],h.flipY=!1,h.flatShading=!0,h.image.addEventListener("load",(function(){return h.needsUpdate=!0})),a.loadedTextures.push(h);var d=new O["E"]({uniforms:Object(Nt["a"])(Object(Nt["a"])({},i),{},{textureImage:{type:"t",value:h},transparent:{value:u}}),vertexShader:t,fragmentShader:e,transparent:u,depthWrite:!0,depthTest:!0,vertexColors:O["Q"],side:O["k"],wireframe:!1});d.needsUpdate=!0,s[r]=d},o=0;o<n.length;o++)r(o);return s}},{key:"createLowresMaterial",value:function(t,e,i){return new O["E"]({uniforms:i,vertexShader:t,fragmentShader:e,transparent:!1,depthWrite:!0,depthTest:!0,vertexColors:O["Q"],side:O["k"],wireframe:!1})}},{key:"unload",value:function(){if(this.hiresTileManager&&this.hiresTileManager.unload(),this.hiresTileManager=null,this.lowresTileManager){for(var t=0;t<this.lowresTileManager.length;t++)this.lowresTileManager[t].unload();this.lowresTileManager=null}this.hiresMaterial&&this.hiresMaterial.forEach((function(t){return t.dispose()})),this.hiresMaterial=null,this.lowresMaterial&&this.lowresMaterial.dispose(),this.lowresMaterial=null,this.loadedTextures.forEach((function(t){return t.dispose()})),this.loadedTextures=[]}},{key:"terrainHeightAt",value:function(t,e){var i;if(!this.isLoaded)return!1;this.raycaster.set(new O["O"](t,300,e),new O["O"](0,-1,0)),this.raycaster.near=1,this.raycaster.far=300,this.raycaster.layers.enableAll();var n=L(Math.floor((t-this.data.hires.translate.x)/this.data.hires.tileSize.x),Math.floor((e-this.data.hires.translate.z)/this.data.hires.tileSize.z)),a=this.hiresTileManager.tiles.get(n);if(null!==(i=a)&&void 0!==i&&i.model)try{var s=this.raycaster.intersectObjects([a.model]);if(s.length>0)return s[0].point.y}catch(b){}for(var r=0;r<this.lowresTileManager.length;r++){var o,l,c,u=r+1,h=Math.pow(this.data.lowres.lodFactor,u-1),d={x:this.data.lowres.tileSize.x*h,z:this.data.lowres.tileSize.z*h},p=Math.floor(t/d.x),m=Math.floor(e/d.z),f=L(p,m);if(a=this.lowresTileManager[r].tiles.get(f),a&&a.model){var v=null===(o=a.model.material.uniforms)||void 0===o||null===(l=o.textureImage)||void 0===l||null===(c=l.value)||void 0===c?void 0:c.image;if(null!=v){var g=W(v,t-p*d.x,e-m*d.z+this.data.lowres.tileSize.z+1),y=256*g[1]+g[2];return y>=32768?-(65535-y):y}}}return!1}},{key:"dispose",value:function(){this.unload()}},{key:"isLoaded",get:function(){return!(!this.hiresMaterial||!this.lowresMaterial)}}]),t}(),Ti=i("257e"),ji=i("262e"),Pi=i("2caf"),Di="\nuniform float sunlightStrength;\nuniform float ambientLight;\nuniform vec3 skyColor;\n\nvarying vec3 vPosition;\n\nvoid main() {\n\tfloat horizonWidth = 0.005;\n\tfloat horizonHeight = 0.0;\n\t\n\tvec4 color = vec4(skyColor * max(sunlightStrength * sunlightStrength, ambientLight), 1.0);\n\tfloat voidMultiplier = (clamp(vPosition.y - horizonHeight, -horizonWidth, horizonWidth) + horizonWidth) / (horizonWidth * 2.0);\n\tcolor.rgb *= voidMultiplier;\n\n\tgl_FragColor = color;\n}\n",Li="\nvarying vec3 vPosition;\nvoid main() {\n\tvPosition = position;\n\t\n\tgl_Position = \n\t\tprojectionMatrix *\n\t\tmodelViewMatrix *\n\t\tvec4(position, 1);\n}\n",Ei=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t){var n;Object(Oe["a"])(this,i),n=e.call(this),n.autoUpdate=!1,Object.defineProperty(Object(Ti["a"])(n),"isSkyboxScene",{value:!0});var a=new O["I"](1,40,5),s=new O["E"]({uniforms:t,vertexShader:Li,fragmentShader:Di,side:O["a"]}),r=new O["t"](a,s);return n.add(r),n}return Object(Te["a"])(i)}(O["B"]),Ci=(i("4c53"),function(){function t(e,i){Object(Oe["a"])(this,t),Object.defineProperty(this,"isControlsManager",{value:!0}),this.data={mapViewer:null,camera:null,controls:null,position:new O["O"](0,0,0),rotation:0,angle:0,tilt:0},this.mapViewer=e,this.camera=i,this.lastPosition=this.position.clone(),this.lastRotation=this.rotation,this.lastAngle=this.angle,this.lastDistance=this.distance,this.lastOrtho=this.ortho,this.lastTilt=this.tilt,this.lastMapUpdatePosition=this.position.clone(),this.lastMapUpdateDistance=this.distance,this.averageDeltaTime=16,this._controls=null,this.distance=300,this.position.set(0,0,0),this.rotation=0,this.angle=0,this.tilt=0,this.ortho=0,this.updateCamera()}return Object(Te["a"])(t,[{key:"update",value:function(t,e){t>50&&(t=50),this.averageDeltaTime=.9*this.averageDeltaTime+.1*t,this._controls&&this._controls.update(this.averageDeltaTime,e),this.updateCamera()}},{key:"updateCamera",value:function(){var t=this.isValueChanged();if(t){this.resetValueChanged();while(this.rotation>=Math.PI)this.rotation-=2*Math.PI;while(this.rotation<=-Math.PI)this.rotation+=2*Math.PI;var e=this.angle;Math.abs(e)<=1e-4?e=1e-4:Math.abs(e)-Math.PI<=1e-4&&(e-=1e-4);var i=this.distance;Math.abs(i)<=1e-4&&(i=1e-4),this.ortho>0&&(i=O["r"].lerp(i,Math.max(i,300),Math.pow(this.ortho,8)));var n=new O["O"](Math.sin(this.rotation),0,-Math.cos(this.rotation)),a=new O["O"](0,1,0).cross(n);if(n.applyAxisAngle(a,Math.PI/2-e),n.multiplyScalar(i),this.camera.rotation.set(0,0,0),this.camera.position.copy(this.position).sub(n),this.camera.lookAt(this.position),this.camera.rotateZ(this.tilt+e<0?Math.PI:0),this.ortho<=0){var s=O["r"].clamp(i/1e3,.01,1),r=O["r"].clamp(2*i,Math.max(s+1,2e3),i+5e3);r-s>1e4&&(s=r-1e4),this.camera.near=s,this.camera.far=r}else 0===this.angle?(this.camera.near=1,this.camera.far=i+300):(this.camera.near=1,this.camera.far=1e5);C(this.mapViewer.events,"bluemapCameraMoved",{controlsManager:this,camera:this.camera})}if(this.mapViewer.map){var o=1;t&&(o=this.distance>300?.5*this.mapViewer.data.loadedLowresViewDistance:.5*this.mapViewer.data.loadedHiresViewDistance),(Math.abs(this.lastMapUpdatePosition.x-this.position.x)>=o||Math.abs(this.lastMapUpdatePosition.z-this.position.z)>=o||this.distance<1e3&&this.lastMapUpdateDistance>1e3)&&(this.lastMapUpdatePosition=this.position.clone(),this.lastMapUpdateDistance=this.distance,this.mapViewer.loadMapArea(this.position.x,this.position.z))}}},{key:"handleMapInteraction",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.mapViewer.handleMapInteraction(t,e)}},{key:"isValueChanged",value:function(){return!(this.data.position.equals(this.lastPosition)&&this.data.rotation===this.lastRotation&&this.data.angle===this.lastAngle&&this.distance===this.lastDistance&&this.ortho===this.lastOrtho&&this.data.tilt===this.lastTilt)}},{key:"resetValueChanged",value:function(){this.lastPosition.copy(this.data.position),this.lastRotation=this.data.rotation,this.lastAngle=this.data.angle,this.lastDistance=this.distance,this.lastOrtho=this.ortho,this.lastTilt=this.data.tilt}},{key:"ortho",get:function(){return this.camera.ortho},set:function(t){this.camera.ortho=t}},{key:"distance",get:function(){return this.camera.distance},set:function(t){this.camera.distance=t}},{key:"controls",get:function(){return this._controls},set:function(t){this._controls&&this._controls.stop&&this._controls.stop(),this._controls=t,t&&(this.data.controls=t.data||null),this._controls&&this._controls.start&&this._controls.start(this)}},{key:"mapViewer",get:function(){return this._mapViewer},set:function(t){this._mapViewer=t,this.data.mapViewer=t.data}},{key:"camera",get:function(){return this._camera},set:function(t){this._camera=t,this.data.camera=t.data}},{key:"position",get:function(){return this.data.position},set:function(t){this.data.position=t}},{key:"rotation",get:function(){return this.data.rotation},set:function(t){this.data.rotation=t}},{key:"angle",get:function(){return this.data.angle},set:function(t){this.data.angle=t}},{key:"tilt",get:function(){return this.data.tilt},set:function(t){this.data.tilt=t}}]),t}()),_i=function t(){var e=0,i=document.createElement("div");function n(t){return i.appendChild(t.dom),t}function a(t){for(var n=0;n<i.children.length;n++)i.children[n].style.display=n===t?"block":"none";e=t}function s(){a(-1)}i.style.cssText="position:absolute;bottom:5px;right:5px;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(t){t.preventDefault(),a(++e%i.children.length)}),!1);var r=(performance||Date).now(),o=r,l=0,c=r,u=n(new t.Panel("FPS","#0ff","#002")),h=n(new t.Panel("MS (render)","#0f0","#020")),d=n(new t.Panel("MS (all)","#f80","#210")),p=null;return self.performance&&self.performance.memory&&(p=n(new t.Panel("MB","#f08","#201"))),a(0),{REVISION:16,dom:i,addPanel:n,showPanel:a,hide:s,begin:function(){r=(performance||Date).now()},end:function(){l++;var t=(performance||Date).now();if(h.update(t-r,200),d.update(t-c,200),t>=o+1e3&&(u.update(1e3*l/(t-o),100),o=t,l=0,p)){var e=performance.memory;p.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){r=this.end(),c=r},domElement:i,setMode:a}};_i.Panel=function(t,e,i){var n=1/0,a=0,s=Math.round,r=s(window.devicePixelRatio||1),o=160*r,l=96*r,c=3*r,u=3*r,h=3*r,d=15*r,p=154*r,m=77*r,f=document.createElement("canvas");f.width=o,f.height=l,f.style.cssText="width:160px;height:96px";var v=f.getContext("2d");return v.font="bold "+9*r+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=i,v.fillRect(0,0,o,l),v.fillStyle=e,v.fillText(t,c,u),v.fillRect(h,d,p,m),v.fillStyle=i,v.globalAlpha=.9,v.fillRect(h,d,p,m),{dom:f,update:function(l,g){n=Math.min(n,l),a=Math.max(a,l),v.fillStyle=i,v.globalAlpha=1,v.fillRect(0,0,o,d),v.fillStyle=e,v.fillText(s(l)+" "+t+" ("+s(n)+"-"+s(a)+")",c,u),v.drawImage(f,h+r,d,p-r,m,h,d,p-r,m),v.fillRect(h+p-r,d,r,m),v.fillStyle=i,v.globalAlpha=.9,v.fillRect(h+p-r,d,r,s((1-l/g)*m))}}};var zi=_i,Ai="\n#include <common>\n".concat(O["C"].logdepthbuf_pars_vertex,"\n\nattribute float ao;\nattribute float sunlight;\nattribute float blocklight;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vColor;\nvarying float vAo;\nvarying float vSunlight;\nvarying float vBlocklight;\n\nvoid main() {\n\tvPosition = position;\n\tvNormal = normal;\n\tvUv = uv;\n\tvColor = color;\n\tvAo = ao;\n\tvSunlight = sunlight;\n\tvBlocklight = blocklight;\n\t\n\tgl_Position = projectionMatrix * (viewMatrix * modelMatrix * vec4(position, 1));\n\t\n\t").concat(O["C"].logdepthbuf_vertex," \n}\n"),Ui="\n".concat(O["C"].logdepthbuf_pars_fragment,"\n\n#ifndef texture\n\t#define texture texture2D\n#endif\n\nuniform sampler2D textureImage;\nuniform float sunlightStrength;\nuniform float ambientLight;\n\nvarying vec3 vPosition;\n//varying vec3 vWorldPosition;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vColor;\nvarying float vAo;\nvarying float vSunlight;\nvarying float vBlocklight;\n//varying float vDistance;\n\nvoid main() {\n\tvec4 color = texture(textureImage, vUv);\n\tif (color.a <= 0.01) discard;\n\t\n\t//apply vertex-color\n\tcolor.rgb *= vColor.rgb;\n\n\t//apply ao\n\tcolor.rgb *= vAo;\n\t\n\t//apply light\n\tfloat light = mix(vBlocklight, max(vSunlight, vBlocklight), sunlightStrength);\n\tcolor.rgb *= mix(ambientLight, 1.0, light / 15.0);\n\t\n\tgl_FragColor = color;\n\t\n\t").concat(O["C"].logdepthbuf_fragment,"\n}\n"),Fi="\n#include <common>\n".concat(O["C"].logdepthbuf_pars_vertex,"\n\nuniform sampler2D textureImage;\nuniform vec2 tileSize;\nuniform vec2 textureSize;\n\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying float vDistance;\n\nfloat metaToHeight(vec4 meta) {\n\tfloat heightUnsigned = meta.g * 65280.0 + meta.b * 255.0;\n\tif (heightUnsigned >= 32768.0) {\n\t\treturn -(65535.0 - heightUnsigned);\n\t} else {\n\t\treturn heightUnsigned;\t\n\t}\n}\n\nvec2 posToMetaUV(vec2 pos) {\n\treturn vec2(pos.x / textureSize.x, pos.y / textureSize.y + 0.5);\n}\n\nvoid main() {\n\tvPosition = position;\n\t\n\tvec4 meta = texture(textureImage, posToMetaUV(position.xz));\n\tvPosition.y = metaToHeight(meta) + 1.0 - position.x * 0.0001 - position.z * 0.0002; //including small offset-tilt to prevent z-fighting\n\t\n\tvec4 worldPos = modelMatrix * vec4(vPosition, 1);\n\tvec4 viewPos = viewMatrix * worldPos;\n\t\n\tvWorldPosition = worldPos.xyz;\n\tvDistance = -viewPos.z;\n\t\n\tgl_Position = projectionMatrix * viewPos;\n\t\t\n\t").concat(O["C"].logdepthbuf_vertex,"\n}\n\n"),Ri="\n".concat(O["C"].logdepthbuf_pars_fragment,"\n\n#ifndef texture\n\t#define texture texture2D\n#endif\n\nstruct TileMap {\n\tsampler2D map;\n\tfloat size;\n\tvec2 scale;\n\tvec2 translate;\n\tvec2 pos; \n};\n\nuniform float sunlightStrength;\nuniform float ambientLight;\nuniform TileMap hiresTileMap;\nuniform sampler2D textureImage;\nuniform vec2 tileSize;\nuniform vec2 textureSize;\n\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying float vDistance;\n\nfloat metaToHeight(vec4 meta) {\n\tfloat heightUnsigned = meta.g * 65280.0 + meta.b * 255.0;\n\tif (heightUnsigned >= 32768.0) {\n\t\treturn -(65535.0 - heightUnsigned);\n\t} else {\n\t\treturn heightUnsigned;\t\n\t}\n}\n\nfloat metaToLight(vec4 meta) {\n\treturn meta.r * 255.0;\n}\n\nvec2 posToColorUV(vec2 pos) {\n\treturn vec2(pos.x / textureSize.x, min(pos.y, tileSize.y) / textureSize.y);\n}\n\nvec2 posToMetaUV(vec2 pos) {\n\treturn vec2(pos.x / textureSize.x, pos.y / textureSize.y + 0.5);\n}\n\nvoid main() {\n\t//discard if hires tile is loaded at that position\n\tif (vDistance < 900.0 && texture(hiresTileMap.map, ((vWorldPosition.xz - hiresTileMap.translate) / hiresTileMap.scale - hiresTileMap.pos) / hiresTileMap.size + 0.5).r > 0.75) discard;\n\t\n\tvec4 color = texture(textureImage, posToColorUV(vPosition.xz));\n\tvec4 meta = texture(textureImage, posToMetaUV(vPosition.xz));\n\t\n\tfloat height = metaToHeight(meta);\n\t\n\tfloat heightX = metaToHeight(texture(textureImage, posToMetaUV(vPosition.xz + vec2(1.0, 0.0))));\n\tfloat heightZ = metaToHeight(texture(textureImage, posToMetaUV(vPosition.xz + vec2(0.0, 1.0))));\n\tfloat diff = (height - heightX) + (height - heightZ);\n\tcolor.rgb += clamp(diff * 0.04, -0.2, 0.04);\n\t\n\tfloat blockLight = metaToLight(meta);\n\tfloat light = mix(blockLight, 15.0, sunlightStrength);\n\tcolor.rgb *= mix(ambientLight, 1.0, light / 15.0);\n\t\n\tgl_FragColor = color;\n\t\n\t").concat(O["C"].logdepthbuf_fragment,"\n}\n\n"),Vi=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t,n,a,s,r){var o;return Object(Oe["a"])(this,i),o=e.call(this,t,n,a,s),o.needsUpdate=!0,o.data={fov:o.fov,aspect:o.aspect,near:o.near,far:o.far,zoom:o.zoom,ortho:r,distance:1},Object.defineProperty(Object(Ti["a"])(o),"fov",{get:function(){return this.data.fov},set:function(t){t!==this.data.fov&&(this.data.fov=t,this.needsUpdate=!0)}}),Object.defineProperty(Object(Ti["a"])(o),"aspect",{get:function(){return this.data.aspect},set:function(t){t!==this.data.aspect&&(this.data.aspect=t,this.needsUpdate=!0)}}),Object.defineProperty(Object(Ti["a"])(o),"near",{get:function(){return this.data.near},set:function(t){t!==this.data.near&&(this.data.near=t,this.needsUpdate=!0)}}),Object.defineProperty(Object(Ti["a"])(o),"far",{get:function(){return this.data.far},set:function(t){t!==this.data.far&&(this.data.far=t,this.needsUpdate=!0)}}),Object.defineProperty(Object(Ti["a"])(o),"zoom",{get:function(){return this.data.zoom},set:function(t){t!==this.data.zoom&&(this.data.zoom=t,this.needsUpdate=!0)}}),o.updateProjectionMatrix(),o}return Object(Te["a"])(i,[{key:"updateProjectionMatrix",value:function(){if(this.needsUpdate){this.ortographicProjection||(this.ortographicProjection=new O["s"]),this.perspectiveProjection||(this.perspectiveProjection=new O["s"]),this.data||(this.data={});var t=this.near,e=t*Math.tan(.5*O["r"].DEG2RAD*this.fov)/this.zoom,i=2*e,n=this.aspect*i,a=-.5*n,s=this.view;if(null!==this.view&&this.view.enabled){var r=s.fullWidth,o=s.fullHeight;a+=s.offsetX*n/r,e-=s.offsetY*i/o,n*=s.width/r,i*=s.height/o}var l=this.filmOffset;0!==l&&(a+=t*l/this.getFilmWidth());var c=1-Math.pow(this.ortho-1,6),u=Math.max(this.distance,1e-4)*Math.tan(.5*O["r"].DEG2RAD*this.fov)/this.zoom,h=2*u,d=this.aspect*h,p=-.5*d;this.perspectiveProjection.makePerspective(a,a+n,e,e-i,t,this.far),this.ortographicProjection.makeOrthographic(p,p+d,u,u-h,t,this.far);for(var m=0;m<16;m++)this.projectionMatrix.elements[m]=this.perspectiveProjection.elements[m]*(1-c)+this.ortographicProjection.elements[m]*c;this.projectionMatrixInverse.copy(this.projectionMatrix).invert(),this.needsUpdate=!1}}},{key:"isPerspectiveCamera",get:function(){return this.ortho<1}},{key:"isOrthographicCamera",get:function(){return!this.isPerspectiveCamera}},{key:"type",get:function(){return this.isPerspectiveCamera?"PerspectiveCamera":"OrthographicCamera"},set:function(t){}},{key:"ortho",get:function(){return this.data.ortho},set:function(t){t!==this.data.ortho&&(this.data.ortho=t,this.needsUpdate=!0)}},{key:"distance",get:function(){return this.data.distance},set:function(t){t!==this.data.distance&&(this.data.distance=t,this.needsUpdate=!0)}}]),i}(O["y"]),Hi=(i("18a5"),i("10d1"),function(t){var e=this;O["x"].call(this),this.element=document.createElement("div");var i=t.parentNode;i.replaceChild(this.element,t),this.element.appendChild(t),this.element.style.position="absolute",this.anchor=new O["N"],this.events=null,this.addEventListener("removed",(function(){this.traverse((function(t){t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}));var n=-1,a=function(t){var i=!1,a=Date.now();a-n<500&&(i=!0),n=a;var s={doubleTap:i};e.onClick({event:t,data:s})?(t.preventDefault(),t.stopPropagation()):C(e.events,"bluemapMapInteraction",{data:s,object:e})};this.element.addEventListener("click",a),this.element.addEventListener("touch",a)});Hi.prototype=Object.create(O["x"].prototype),Hi.prototype.constructor=Hi;var Bi=function(){var t,e,i,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=this,r=new O["O"],o=new O["s"],l=new O["s"],c={objects:new WeakMap},u=document.createElement("div");u.style.overflow="hidden",this.domElement=u,this.events=a,this.getSize=function(){return{width:t,height:e}},this.setSize=function(a,s){t=a,e=s,i=t/2,n=e/2,u.style.width=a+"px",u.style.height=s+"px"};var h=function t(e,a,o,h){if(e instanceof Hi){e.events=s.events,e.onBeforeRender(s,a,o),r.setFromMatrixPosition(e.matrixWorld),r.applyMatrix4(l);var p=e.element,m="translate("+(r.x*i+i-e.anchor.x)+"px,"+(-r.y*n+n-e.anchor.y)+"px)";p.style.WebkitTransform=m,p.style.MozTransform=m,p.style.oTransform=m,p.style.transform=m,p.style.display=h&&e.visible&&r.z>=-1&&r.z<=1&&"0"!==p.style.opacity?"":"none";var f={distanceToCameraSquared:d(o,e)};c.objects.set(e,f),p.parentNode!==u&&u.appendChild(p),e.onAfterRender(s,a,o)}for(var v=0,g=e.children.length;v<g;v++)t(e.children[v],a,o,h&&e.visible)},d=function(){var t=new O["O"],e=new O["O"];return function(i,n){return t.setFromMatrixPosition(i.matrixWorld),e.setFromMatrixPosition(n.matrixWorld),t.distanceToSquared(e)}}(),p=function(t){var e=[];return t.traverse((function(t){t instanceof Hi&&e.push(t)})),e},m=function(t){for(var e=p(t).sort((function(t,e){var i=c.objects.get(t).distanceToCameraSquared,n=c.objects.get(e).distanceToCameraSquared;return i-n})),i=e.length,n=0,a=e.length;n<a;n++)e[n].element.style.zIndex=i-n};this.render=function(t,e){!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),o.copy(e.matrixWorldInverse),l.multiplyMatrices(e.projectionMatrix,o),h(t,t,e,!0),m(t)}},$i=i("45eb"),Ni=i("7e84");i("6062"),i("b64b"),i("cb29");O["L"].line={linewidth:{value:1},resolution:{value:new O["N"](1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1},opacity:{value:1}},O["D"]["line"]={uniforms:O["M"].merge([O["L"].common,O["L"].fog,O["L"].line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\t\t\n\t\tvarying float vDistance;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\t\t\t\n\t\t\tvDistance = -mvPosition.z;\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\t#define FLT_MAX 3.402823466e+38\n\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\t\t\n\t\tuniform float fadeDistanceMax;\n\t\tuniform float fadeDistanceMin;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\t\t\n\t\tvarying float vDistance;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\tfloat a = vUv.x;\n\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t}\n\n\t\t\t// distance fading\n\t\t\tfloat fdMax = FLT_MAX;\n\t\t\tif ( fadeDistanceMax > 0.0 ) fdMax = fadeDistanceMax;\n\t\t\t\n\t\t\tfloat minDelta = (vDistance - fadeDistanceMin) / fadeDistanceMin;\n\t\t\tfloat maxDelta = (vDistance - fadeDistanceMax) / (fadeDistanceMax * 0.5);\n\t\t\tfloat distanceOpacity = min(\n\t\t\t\tclamp(minDelta, 0.0, 1.0),\n\t\t\t\t1.0 - clamp(maxDelta + 1.0, 0.0, 1.0)\n\t\t\t);\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity * distanceOpacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};var Ii=function(t){O["E"].call(this,{type:"LineMaterial",uniforms:O["M"].clone(O["D"]["line"].uniforms),vertexShader:O["D"]["line"].vertexShader,fragmentShader:O["D"]["line"].fragmentShader,clipping:!0}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}}}),this.setValues(t)};Ii.prototype=Object.create(O["E"].prototype),Ii.prototype.constructor=Ii,Ii.prototype.isLineMaterial=!0;var Yi="\n#include <common>\n".concat(O["C"].logdepthbuf_pars_vertex,"\n\nvarying vec3 vPosition;\n//varying vec3 vWorldPosition;\n//varying vec3 vNormal;\n//varying vec2 vUv;\n//varying vec3 vColor;\nvarying float vDistance;\n\nvoid main() {\n\tvec4 worldPos = modelMatrix * vec4(position, 1);\n\tvec4 viewPos = viewMatrix * worldPos;\n\t\n\tvPosition = position;\n\t//vWorldPosition = worldPos.xyz;\n\t//vNormal = normal;\n\t//vUv = uv;\n\t//vColor = vec3(1.0);\n\tvDistance = -viewPos.z;\n\t\n\tgl_Position = projectionMatrix * viewPos;\n\t\n\t").concat(O["C"].logdepthbuf_vertex," \n}\n"),Ki="\n".concat(O["C"].logdepthbuf_pars_fragment,"\n\n#define FLT_MAX 3.402823466e+38\n\nvarying vec3 vPosition;\n//varying vec3 vWorldPosition;\n//varying vec3 vNormal;\n//varying vec2 vUv;\n//varying vec3 vColor;\nvarying float vDistance;\n\nuniform vec3 markerColor;\nuniform float markerOpacity;\n\nuniform float fadeDistanceMax;\nuniform float fadeDistanceMin;\n\nvoid main() {\n\tvec4 color = vec4(markerColor, markerOpacity);\n\t\n\t// distance fading\n\tfloat fdMax = FLT_MAX;\n\tif ( fadeDistanceMax > 0.0 ) fdMax = fadeDistanceMax;\n\t\n\tfloat minDelta = (vDistance - fadeDistanceMin) / fadeDistanceMin;\n\tfloat maxDelta = (vDistance - fadeDistanceMax) / (fadeDistanceMax * 0.5);\n\tfloat distanceOpacity = min(\n\t\tclamp(minDelta, 0.0, 1.0),\n\t\t1.0 - clamp(maxDelta + 1.0, 0.0, 1.0)\n\t);\n\t\n\tcolor.a *= distanceOpacity;\n\t\n\t// apply vertex-color\n\t//color.rgb *= vColor.rgb;\n\t\n\tgl_FragColor = color;\n\t\n\t").concat(O["C"].logdepthbuf_fragment,"\n}\n"),Wi=(i("cfc3"),i("acef"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),function(){O["m"].call(this),this.type="LineSegmentsGeometry";var t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i),this.setAttribute("position",new O["j"](t,3)),this.setAttribute("uv",new O["j"](e,2))});Wi.prototype=Object.assign(Object.create(O["m"].prototype),{constructor:Wi,isLineSegmentsGeometry:!0,applyMatrix4:function(t){var e=this.attributes.instanceStart,i=this.attributes.instanceEnd;return void 0!==e&&(e.applyMatrix4(t),i.applyMatrix4(t),e.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var i=new O["n"](e,6,1);return this.setAttribute("instanceStart",new O["o"](i,3,0)),this.setAttribute("instanceEnd",new O["o"](i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var i=new O["n"](e,6,1);return this.setAttribute("instanceColorStart",new O["o"](i,3,0)),this.setAttribute("instanceColorEnd",new O["o"](i,3,3)),this},fromWireframeGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromEdgesGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromMesh:function(t){return this.fromWireframeGeometry(new O["S"](t.geometry)),this},fromLineSegments:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.attributes.position.array),this},computeBoundingBox:function(){var t=new O["b"];return function(){null===this.boundingBox&&(this.boundingBox=new O["b"]);var e=this.attributes.instanceStart,i=this.attributes.instanceEnd;void 0!==e&&void 0!==i&&(this.boundingBox.setFromBufferAttribute(e),t.setFromBufferAttribute(i),this.boundingBox.union(t))}}(),computeBoundingSphere:function(){var t=new O["O"];return function(){null===this.boundingSphere&&(this.boundingSphere=new O["H"]),null===this.boundingBox&&this.computeBoundingBox();var e=this.attributes.instanceStart,i=this.attributes.instanceEnd;if(void 0!==e&&void 0!==i){var n=this.boundingSphere.center;this.boundingBox.getCenter(n);for(var a=0,s=0,r=e.count;s<r;s++)t.fromBufferAttribute(e,s),a=Math.max(a,n.distanceToSquared(t)),t.fromBufferAttribute(i,s),a=Math.max(a,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}(),toJSON:function(){},applyMatrix:function(t){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}});var Gi=function(){Wi.call(this),this.type="LineGeometry"};Gi.prototype=Object.assign(Object.create(Wi.prototype),{constructor:Gi,isLineGeometry:!0,setPositions:function(t){for(var e=t.length-3,i=new Float32Array(2*e),n=0;n<e;n+=3)i[2*n]=t[n],i[2*n+1]=t[n+1],i[2*n+2]=t[n+2],i[2*n+3]=t[n+3],i[2*n+4]=t[n+4],i[2*n+5]=t[n+5];return Wi.prototype.setPositions.call(this,i),this},setColors:function(t){for(var e=t.length-3,i=new Float32Array(2*e),n=0;n<e;n+=3)i[2*n]=t[n],i[2*n+1]=t[n+1],i[2*n+2]=t[n+2],i[2*n+3]=t[n+3],i[2*n+4]=t[n+4],i[2*n+5]=t[n+5];return Wi.prototype.setColors.call(this,i),this},fromLine:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.attributes.position.array),this},copy:function(){return this}});i("8f40");var Xi=function(t,e){void 0===t&&(t=new Wi),void 0===e&&(e=new Ii({color:16777215*Math.random()})),O["t"].call(this,t,e),this.type="LineSegments2"};Xi.prototype=Object.assign(Object.create(O["t"].prototype),{constructor:Xi,isLineSegments2:!0,computeLineDistances:function(){var t=new O["O"],e=new O["O"];return function(){for(var i=this.geometry,n=i.attributes.instanceStart,a=i.attributes.instanceEnd,s=new Float32Array(2*n.data.count),r=0,o=0,l=n.data.count;r<l;r++,o+=2)t.fromBufferAttribute(n,r),e.fromBufferAttribute(a,r),s[o]=0===o?0:s[o-1],s[o+1]=s[o]+t.distanceTo(e);var c=new O["n"](s,2,1);return i.setAttribute("instanceDistanceStart",new O["o"](c,1,0)),i.setAttribute("instanceDistanceEnd",new O["o"](c,1,1)),this}}(),raycast:function(){var t=new O["P"],e=new O["P"],i=new O["P"],n=new O["O"],a=new O["s"],s=new O["p"],r=new O["O"];return function(o,l){null===o.camera&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');var c=void 0!==o.params.Line2&&o.params.Line2.threshold||0,u=o.ray,h=o.camera,d=h.projectionMatrix,p=this.geometry,m=this.material,f=m.resolution,v=m.linewidth+c,g=p.attributes.instanceStart,y=p.attributes.instanceEnd;u.at(1,i),i.w=1,i.applyMatrix4(h.matrixWorldInverse),i.applyMatrix4(d),i.multiplyScalar(1/i.w),i.x*=f.x/2,i.y*=f.y/2,i.z=0,n.copy(i);var b=this.matrixWorld;a.multiplyMatrices(h.matrixWorldInverse,b);for(var w=0,M=g.count;w<M;w++){t.fromBufferAttribute(g,w),e.fromBufferAttribute(y,w),t.w=1,e.w=1,t.applyMatrix4(a),e.applyMatrix4(a),t.applyMatrix4(d),e.applyMatrix4(d),t.multiplyScalar(1/t.w),e.multiplyScalar(1/e.w);var k=t.z<-1&&e.z<-1,S=t.z>1&&e.z>1;if(!k&&!S){t.x*=f.x/2,t.y*=f.y/2,e.x*=f.x/2,e.y*=f.y/2,s.start.copy(t),s.start.z=0,s.end.copy(e),s.end.z=0;var x=s.closestPointToPointParameter(n,!0);s.at(x,r);var T=O["r"].lerp(t.z,e.z,x),j=T>=-1&&T<=1,P=n.distanceTo(r)<.5*v;if(j&&P){s.start.fromBufferAttribute(g,w),s.end.fromBufferAttribute(y,w),s.start.applyMatrix4(b),s.end.applyMatrix4(b);var D=new O["O"],L=new O["O"];u.distanceSqToSegment(s.start,s.end,L,D),l.push({point:L,pointOnLine:D,distance:u.origin.distanceTo(L),object:this,face:null,faceIndex:w,uv:null,uv2:null})}}}}}()});var Zi=function(t,e){void 0===t&&(t=new Gi),void 0===e&&(e=new Ii({color:16777215*Math.random()})),Xi.call(this,t,e),this.type="Line2"};Zi.prototype=Object.assign(Object.create(Xi.prototype),{constructor:Zi,isLine2:!0});i("9911");var qi=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t){var n;return Object(Oe["a"])(this,i),n=e.call(this),Object.defineProperty(Object(Ti["a"])(n),"isMarker",{value:!0}),n.data={id:t,type:"marker",position:n.position,visible:n.visible},Object.defineProperty(Object(Ti["a"])(n),"position",{get:function(){return this.data.position},set:function(t){this.data.position=t}}),Object.defineProperty(Object(Ti["a"])(n),"visible",{get:function(){return this.data.visible},set:function(t){this.data.visible=t}}),n}return Object(Te["a"])(i,[{key:"dispose",value:function(){}},{key:"updateFromData",value:function(t){}}],[{key:"calculateDistanceOpacity",value:function(t,e,n,a){var s=i.calculateDistanceToCameraPlane(t,e),r=(s-n)/n,o=(s-a)/(.5*a);return Math.min(O["r"].clamp(r,0,1),1-O["r"].clamp(o+1,0,1))}},{key:"calculateDistanceToCameraPlane",value:function(t,e){return i._posRelativeToCamera.subVectors(t,e.position),e.getWorldDirection(i._cameraDirection),i._posRelativeToCamera.dot(i._cameraDirection)}}]),i}(O["x"]);Object(je["a"])(qi,"_posRelativeToCamera",new O["O"]),Object(je["a"])(qi,"_cameraDirection",new O["O"]);var Qi=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t){var n;return Object(Oe["a"])(this,i),n=e.call(this,t),Object.defineProperty(Object(Ti["a"])(n),"isObjectMarker",{value:!0}),n.data.type="object",n.data.label=null,n.data.detail=null,n.data.link=null,n.data.newTab=!0,n.lastClick=-1,n}return Object(Te["a"])(i,[{key:"onClick",value:function(t){var e=new O["O"];if(t.intersection&&(e.copy(t.intersection.pointOnLine||t.intersection.point),e.sub(this.position)),t.data.doubleTap)return!1;if(this.data.detail||this.data.label){var i=new Ji(this.data.detail||this.data.label);i.position.copy(e),this.add(i),i.open()}return this.data.link&&window.open(this.data.link,this.data.newTab?"_blank":"_self"),!0}},{key:"updateFromData",value:function(t){var e=t.position||{};this.position.setX(e.x||0),this.position.setY(e.y||0),this.position.setZ(e.z||0),this.data.label=t.label||null,this.data.detail=t.detail||null,this.data.link=t.link||null,this.data.newTab=!!t.newTab}}]),i}(qi),Ji=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t){return Object(Oe["a"])(this,i),e.call(this,z('<div class="bm-marker-labelpopup">'.concat(t,"</div>")))}return Object(Te["a"])(i,[{key:"open",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=this.element.style.opacity||1;this.element.style.opacity=0;var n=A((function(e){t.element.style.opacity=(e*i).toString()}),300);if(e){var a=function e(i){i.composedPath().includes(t.element)||(n.cancel(),t.close(),window.removeEventListener("mousedown",e),window.removeEventListener("touchstart",e),window.removeEventListener("keydown",e),window.removeEventListener("mousewheel",e))};window.addEventListener("mousedown",a),window.addEventListener("touchstart",a),window.addEventListener("keydown",a),window.addEventListener("mousewheel",a)}}},{key:"close",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=parseFloat(this.element.style.opacity);A((function(e){t.element.style.opacity=(i-e*i).toString()}),300,(function(i){e&&i&&t.parent&&t.parent.remove(t)}))}}]),i}(Hi),tn=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t){var n;Object(Oe["a"])(this,i),n=e.call(this,t),Object.defineProperty(Object(Ti["a"])(n),"isShapeMarker",{value:!0}),n.data.type="shape";var a=new O["N"],s=new O["F"]([a,a,a]);return n.fill=new en(s),n.border=new nn(s),n.border.renderOrder=-1,n.add(n.border,n.fill),n._markerData={},n}return Object(Te["a"])(i,[{key:"setShapeY",value:function(t){var e=t-this.position.y;this.fill.position.y=e,this.border.position.y=e}},{key:"setShape",value:function(t){this.fill.updateGeometry(t),this.border.updateGeometry(t)}},{key:"updateFromData",value:function(t){Object($i["a"])(Object(Ni["a"])(i.prototype),"updateFromData",this).call(this,t),this._markerData.shape&&R(t.shape,this._markerData.shape)&&this._markerData.position&&R(t.position,this._markerData.position)||this.setShape(this.createShapeFromData(t.shape)),this.setShapeY((t.shapeY||t.height||0)+.01),this.border.depthTest=!!t.depthTest,this.fill.depthTest=!!t.depthTest,this.border.linewidth=void 0!==t.lineWidth?t.lineWidth:2;var e=t.lineColor||t.borderColor||{};this.border.color.setRGB((e.r||0)/255,(e.g||0)/255,(e.b||0)/255),this.border.opacity=e.a||0;var n=t.fillColor||{};this.fill.color.setRGB((n.r||0)/255,(n.g||0)/255,(n.b||0)/255),this.fill.opacity=n.a||0;var a=t.minDistance||0,s=void 0!==t.maxDistance?t.maxDistance:Number.MAX_VALUE;this.border.fadeDistanceMin=a,this.border.fadeDistanceMax=s,this.fill.fadeDistanceMin=a,this.fill.fadeDistanceMax=s,this._markerData=t}},{key:"dispose",value:function(){Object($i["a"])(Object(Ni["a"])(i.prototype),"dispose",this).call(this),this.fill.dispose(),this.border.dispose()}},{key:"createShapeFromData",value:function(t){var e=this,i=[];return Array.isArray(t)&&t.forEach((function(t){var n=(t.x||0)-e.position.x,a=(t.z||0)-e.position.z;i.push(new O["N"](n,a))})),new O["F"](i)}}]),i}(Qi),en=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t){Object(Oe["a"])(this,i);var n=i.createGeometry(t),a=new O["E"]({vertexShader:Yi,fragmentShader:Ki,side:O["g"],depthTest:!0,transparent:!0,uniforms:{markerColor:{value:new O["f"]},markerOpacity:{value:0},fadeDistanceMin:{value:0},fadeDistanceMax:{value:Number.MAX_VALUE}}});return e.call(this,n,a)}return Object(Te["a"])(i,[{key:"color",get:function(){return this.material.uniforms.markerColor.value}},{key:"opacity",get:function(){return this.material.uniforms.markerOpacity.value},set:function(t){this.material.uniforms.markerOpacity.value=t,this.visible=t>0}},{key:"depthTest",get:function(){return this.material.depthTest},set:function(t){this.material.depthTest=t}},{key:"fadeDistanceMin",get:function(){return this.material.uniforms.fadeDistanceMin.value},set:function(t){this.material.uniforms.fadeDistanceMin.value=t}},{key:"fadeDistanceMax",get:function(){return this.material.uniforms.fadeDistanceMax.value},set:function(t){this.material.uniforms.fadeDistanceMax.value=t}},{key:"onClick",value:function(t){if(t.intersection){if(t.intersection.distance>this.fadeDistanceMax)return!1;if(t.intersection.distance<this.fadeDistanceMin)return!1}return Object($i["a"])(Object(Ni["a"])(i.prototype),"onClick",this).call(this,t)}},{key:"updateGeometry",value:function(t){this.geometry.dispose(),this.geometry=i.createGeometry(t)}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}],[{key:"createGeometry",value:function(t){var e=new O["G"](t,5);return e.rotateX(Math.PI/2),e}}]),i}(O["t"]),nn=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t){var n;Object(Oe["a"])(this,i);var a=new Gi;a.setPositions(i.createLinePoints(t));var s=new Ii({color:new O["f"],opacity:0,transparent:!0,linewidth:1,depthTest:!0,vertexColors:!1,dashed:!1});return s.uniforms.fadeDistanceMin={value:0},s.uniforms.fadeDistanceMax={value:Number.MAX_VALUE},s.resolution.set(window.innerWidth,window.innerHeight),n=e.call(this,a,s),n.computeLineDistances(),n}return Object(Te["a"])(i,[{key:"color",get:function(){return this.material.color}},{key:"opacity",get:function(){return this.material.opacity},set:function(t){this.material.opacity=t,this.visible=t>0}},{key:"linewidth",get:function(){return this.material.linewidth},set:function(t){this.material.linewidth=t}},{key:"depthTest",get:function(){return this.material.depthTest},set:function(t){this.material.depthTest=t}},{key:"fadeDistanceMin",get:function(){return this.material.uniforms.fadeDistanceMin.value},set:function(t){this.material.uniforms.fadeDistanceMin.value=t}},{key:"fadeDistanceMax",get:function(){return this.material.uniforms.fadeDistanceMax.value},set:function(t){this.material.uniforms.fadeDistanceMax.value=t}},{key:"onClick",value:function(t){if(t.intersection){if(t.intersection.distance>this.fadeDistanceMax)return!1;if(t.intersection.distance<this.fadeDistanceMin)return!1}return Object($i["a"])(Object(Ni["a"])(i.prototype),"onClick",this).call(this,t)}},{key:"updateGeometry",value:function(t){this.geometry=new Gi,this.geometry.setPositions(i.createLinePoints(t)),this.computeLineDistances()}},{key:"onBeforeRender",value:function(t){t.getSize(this.material.resolution)}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}],[{key:"createLinePoints",value:function(t){var e=[],i=t.getPoints(5);return i.forEach((function(t){return e.push(t.x,0,t.y)})),e.push(i[0].x,0,i[0].y),e}}]),i}(Zi),an=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t){var n;Object(Oe["a"])(this,i),n=e.call(this,t),Object.defineProperty(Object(Ti["a"])(n),"isExtrudeMarker",{value:!0}),n.data.type="extrude";var a=new O["N"],s=new O["F"]([a,a,a]);return n.fill=new sn(s),n.border=new rn(s),n.border.renderOrder=-1,n.add(n.border,n.fill),n._markerData={},n}return Object(Te["a"])(i,[{key:"setShapeY",value:function(t,e){var i=e-this.position.y,n=e-t;this.fill.position.y=i,this.border.position.y=i,this.fill.scale.y=n,this.border.scale.y=n}},{key:"setShape",value:function(t){this.fill.updateGeometry(t),this.border.updateGeometry(t)}},{key:"updateFromData",value:function(t){Object($i["a"])(Object(Ni["a"])(i.prototype),"updateFromData",this).call(this,t),this._markerData.shape&&R(t.shape,this._markerData.shape)&&this._markerData.position&&R(t.position,this._markerData.position)||this.setShape(this.createShapeFromData(t.shape)),this.setShapeY((t.shapeMinY||0)-.01,(t.shapeMaxY||0)+.01),this.border.depthTest=!!t.depthTest,this.fill.depthTest=!!t.depthTest,this.border.linewidth=void 0!==t.lineWidth?t.lineWidth:2;var e=t.lineColor||{};this.border.color.setRGB((e.r||0)/255,(e.g||0)/255,(e.b||0)/255),this.border.opacity=e.a||0;var n=t.fillColor||{};this.fill.color.setRGB((n.r||0)/255,(n.g||0)/255,(n.b||0)/255),this.fill.opacity=n.a||0;var a=t.minDistance||0,s=void 0!==t.maxDistance?t.maxDistance:Number.MAX_VALUE;this.border.fadeDistanceMin=a,this.border.fadeDistanceMax=s,this.fill.fadeDistanceMin=a,this.fill.fadeDistanceMax=s,this._markerData=t}},{key:"dispose",value:function(){Object($i["a"])(Object(Ni["a"])(i.prototype),"dispose",this).call(this),this.fill.dispose(),this.border.dispose()}},{key:"createShapeFromData",value:function(t){var e=this,i=[];return Array.isArray(t)&&t.forEach((function(t){var n=(t.x||0)-e.position.x+.01,a=(t.z||0)-e.position.z+.01;i.push(new O["N"](n,a))})),new O["F"](i)}}]),i}(Qi),sn=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t){Object(Oe["a"])(this,i);var n=i.createGeometry(t),a=new O["E"]({vertexShader:Yi,fragmentShader:Ki,side:O["g"],depthTest:!0,transparent:!0,uniforms:{markerColor:{value:new O["f"]},markerOpacity:{value:0},fadeDistanceMin:{value:0},fadeDistanceMax:{value:Number.MAX_VALUE}}});return e.call(this,n,a)}return Object(Te["a"])(i,[{key:"color",get:function(){return this.material.uniforms.markerColor.value}},{key:"opacity",get:function(){return this.material.uniforms.markerOpacity.value},set:function(t){this.material.uniforms.markerOpacity.value=t,this.visible=t>0}},{key:"depthTest",get:function(){return this.material.depthTest},set:function(t){this.material.depthTest=t}},{key:"fadeDistanceMin",get:function(){return this.material.uniforms.fadeDistanceMin.value},set:function(t){this.material.uniforms.fadeDistanceMin.value=t}},{key:"fadeDistanceMax",get:function(){return this.material.uniforms.fadeDistanceMax.value},set:function(t){this.material.uniforms.fadeDistanceMax.value=t}},{key:"onClick",value:function(t){if(t.intersection){if(t.intersection.distance>this.fadeDistanceMax)return!1;if(t.intersection.distance<this.fadeDistanceMin)return!1}return Object($i["a"])(Object(Ni["a"])(i.prototype),"onClick",this).call(this,t)}},{key:"updateGeometry",value:function(t){this.geometry.dispose(),this.geometry=i.createGeometry(t)}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}],[{key:"createGeometry",value:function(t){var e=new O["h"](t,{depth:1,steps:5,bevelEnabled:!1});return e.rotateX(Math.PI/2),e}}]),i}(O["t"]),rn=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t){var n;Object(Oe["a"])(this,i);var a=new Wi;a.setPositions(i.createLinePoints(t));var s=new Ii({color:new O["f"],opacity:0,transparent:!0,linewidth:1,depthTest:!0,vertexColors:!1,dashed:!1});return s.uniforms.fadeDistanceMin={value:0},s.uniforms.fadeDistanceMax={value:Number.MAX_VALUE},s.resolution.set(window.innerWidth,window.innerHeight),n=e.call(this,a,s),n.computeLineDistances(),n}return Object(Te["a"])(i,[{key:"color",get:function(){return this.material.color}},{key:"opacity",get:function(){return this.material.opacity},set:function(t){this.material.opacity=t,this.visible=t>0}},{key:"linewidth",get:function(){return this.material.linewidth},set:function(t){this.material.linewidth=t}},{key:"depthTest",get:function(){return this.material.depthTest},set:function(t){this.material.depthTest=t}},{key:"fadeDistanceMin",get:function(){return this.material.uniforms.fadeDistanceMin.value},set:function(t){this.material.uniforms.fadeDistanceMin.value=t}},{key:"fadeDistanceMax",get:function(){return this.material.uniforms.fadeDistanceMax.value},set:function(t){this.material.uniforms.fadeDistanceMax.value=t}},{key:"onClick",value:function(t){if(t.intersection){if(t.intersection.distance>this.fadeDistanceMax)return!1;if(t.intersection.distance<this.fadeDistanceMin)return!1}return Object($i["a"])(Object(Ni["a"])(i.prototype),"onClick",this).call(this,t)}},{key:"updateGeometry",value:function(t){this.geometry=new Wi,this.geometry.setPositions(i.createLinePoints(t)),this.computeLineDistances()}},{key:"onBeforeRender",value:function(t){t.getSize(this.material.resolution)}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}],[{key:"createLinePoints",value:function(t){var e=[],i=t.getPoints(5);i.push(i[0]);var n=null;return i.forEach((function(t){e.push(t.x,0,t.y),e.push(t.x,-1,t.y),n&&(e.push(n.x,0,n.y),e.push(t.x,0,t.y),e.push(n.x,-1,n.y),e.push(t.x,-1,t.y)),n=t})),e}}]),i}(Zi),on=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t){var n;return Object(Oe["a"])(this,i),n=e.call(this,t),Object.defineProperty(Object(Ti["a"])(n),"isLineMarker",{value:!0}),n.data.type="line",n.line=new ln([0,0,0]),n.add(n.line),n._markerData={},n}return Object(Te["a"])(i,[{key:"setLine",value:function(t){var e;if("Curve"!==t.type&&"CurvePath"!==t.type||(t=t.getPoints(5)),!Array.isArray(t))throw new Error("Invalid argument type!");0===t.length?e=[]:t[0].isVector3?(e=[],t.forEach((function(t){e.push(t.x,t.y,t.z)}))):e=t,this.line.updateGeometry(e)}},{key:"updateFromData",value:function(t){Object($i["a"])(Object(Ni["a"])(i.prototype),"updateFromData",this).call(this,t),this._markerData.line&&R(t.line,this._markerData.line)&&this._markerData.position&&R(t.position,this._markerData.position)||this.setLine(this.createPointsFromData(t.line)),this.line.depthTest=!!t.depthTest,this.line.linewidth=void 0!==t.lineWidth?t.lineWidth:2;var e=t.lineColor||{};this.line.color.setRGB((e.r||0)/255,(e.g||0)/255,(e.b||0)/255),this.line.opacity=e.a||0;var n=t.minDistance||0,a=void 0!==t.maxDistance?t.maxDistance:Number.MAX_VALUE;this.line.fadeDistanceMin=n,this.line.fadeDistanceMax=a,this._markerData=t}},{key:"dispose",value:function(){Object($i["a"])(Object(Ni["a"])(i.prototype),"dispose",this).call(this),this.line.dispose()}},{key:"createPointsFromData",value:function(t){var e=this,i=[];return Array.isArray(t)&&t.forEach((function(t){var n=(t.x||0)-e.position.x,a=(t.y||0)-e.position.y,s=(t.z||0)-e.position.z;i.push(n,a,s)})),i}}]),i}(Qi),ln=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t){var n;Object(Oe["a"])(this,i);var a=new Gi;a.setPositions(t);var s=new Ii({color:new O["f"],opacity:0,transparent:!0,linewidth:1,depthTest:!0,vertexColors:!1,dashed:!1});return s.uniforms.fadeDistanceMin={value:0},s.uniforms.fadeDistanceMax={value:Number.MAX_VALUE},s.resolution.set(window.innerWidth,window.innerHeight),n=e.call(this,a,s),n.computeLineDistances(),n}return Object(Te["a"])(i,[{key:"color",get:function(){return this.material.color}},{key:"opacity",get:function(){return this.material.opacity},set:function(t){this.material.opacity=t,this.visible=t>0}},{key:"linewidth",get:function(){return this.material.linewidth},set:function(t){this.material.linewidth=t}},{key:"depthTest",get:function(){return this.material.depthTest},set:function(t){this.material.depthTest=t}},{key:"fadeDistanceMin",get:function(){return this.material.uniforms.fadeDistanceMin.value},set:function(t){this.material.uniforms.fadeDistanceMin.value=t}},{key:"fadeDistanceMax",get:function(){return this.material.uniforms.fadeDistanceMax.value},set:function(t){this.material.uniforms.fadeDistanceMax.value=t}},{key:"onClick",value:function(t){if(t.intersection){if(t.intersection.distance>this.fadeDistanceMax)return!1;if(t.intersection.distance<this.fadeDistanceMin)return!1}return Object($i["a"])(Object(Ni["a"])(i.prototype),"onClick",this).call(this,t)}},{key:"updateGeometry",value:function(t){this.geometry=new Gi,this.geometry.setPositions(t),this.computeLineDistances()}},{key:"onBeforeRender",value:function(t){t.getSize(this.material.resolution)}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),i}(Zi),cn=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t){var n;return Object(Oe["a"])(this,i),n=e.call(this,t),Object.defineProperty(Object(Ti["a"])(n),"isHtmlMarker",{value:!0}),n.data.type="html",n.data.label=null,n.elementObject=new Hi(z('<div id="bm-marker-'.concat(n.data.id,'" class="bm-marker-').concat(n.data.type,'"></div>'))),n.elementObject.onBeforeRender=function(t,e,i){return n.onBeforeRender(t,e,i)},n.fadeDistanceMin=0,n.fadeDistanceMax=Number.MAX_VALUE,n.addEventListener("removed",(function(){var t;null!==(t=n.element)&&void 0!==t&&t.parentNode&&n.element.parentNode.removeChild(n.element)})),n.add(n.elementObject),n}return Object(Te["a"])(i,[{key:"onBeforeRender",value:function(t,e,i){this.fadeDistanceMax===Number.MAX_VALUE&&this.fadeDistanceMin<=0?this.element.style.opacity=void 0:this.element.style.opacity=qi.calculateDistanceOpacity(this.position,i,this.fadeDistanceMin,this.fadeDistanceMax).toString()}},{key:"html",get:function(){return this.element.innerHTML},set:function(t){this.element.innerHTML=t}},{key:"anchor",get:function(){return this.elementObject.anchor}},{key:"element",get:function(){return this.elementObject.element.getElementsByTagName("div")[0]}},{key:"updateFromData",value:function(t){var e=t.position||{};this.position.setX(e.x||0),this.position.setY(e.y||0),this.position.setZ(e.z||0),this.data.label=t.label||null;var i=t.anchor||{};this.anchor.setX(i.x||0),this.anchor.setY(i.y||0),this.element.innerHTML!==t.html&&(this.element.innerHTML=t.html),this.fadeDistanceMin=t.minDistance||0,this.fadeDistanceMax=void 0!==t.maxDistance?t.maxDistance:Number.MAX_VALUE}},{key:"dispose",value:function(){Object($i["a"])(Object(Ni["a"])(i.prototype),"dispose",this).call(this),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}]),i}(qi),un=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t){var n;return Object(Oe["a"])(this,i),n=e.call(this,t),Object.defineProperty(Object(Ti["a"])(n),"isPoiMarker",{value:!0}),n.data.type="poi",n.html='<img src="" alt="POI Icon ('.concat(n.data.id,')" class="bm-marker-poi-icon" draggable="false" style="pointer-events: auto"><div class="bm-marker-poi-label"></div>'),n.iconElement=n.element.getElementsByTagName("img").item(0),n.labelElement=n.element.getElementsByTagName("div").item(0),n._lastIcon=null,n}return Object(Te["a"])(i,[{key:"onClick",value:function(t){var e=this;if(t.data.doubleTap)return!1;if(this.highlight||!this.data.label)return!0;this.highlight=!0;var i=function t(i){i.composedPath().includes(e.element)||(e.highlight=!1,window.removeEventListener("mousedown",t),window.removeEventListener("touchstart",t),window.removeEventListener("keydown",t),window.removeEventListener("mousewheel",t))};return setTimeout((function(){window.addEventListener("mousedown",i),window.addEventListener("touchstart",i),window.addEventListener("keydown",i),window.addEventListener("mousewheel",i)}),0),!0}},{key:"highlight",get:function(){return this.element.classList.contains("bm-marker-highlight")},set:function(t){t?this.element.classList.add("bm-marker-highlight"):this.element.classList.remove("bm-marker-highlight")}},{key:"updateFromData",value:function(t){var e=t.position||{};this.position.setX(e.x||0),this.position.setY(e.y||0),this.position.setZ(e.z||0);var i=t.anchor||t.iconAnchor||{};this.iconElement.style.transform="translate(".concat(-i.x,"px, ").concat(-i.y,"px)"),this.data.label!==t.label&&(this.data.label=t.label||"",this.labelElement.innerHTML=this.data.label||""),this._lastIcon!==t.icon&&(this.iconElement.src=t.icon||"assets/poi.svg",this._lastIcon=t.icon),this.fadeDistanceMin=t.minDistance||0,this.fadeDistanceMax=void 0!==t.maxDistance?t.maxDistance:Number.MAX_VALUE}}]),i}(cn),hn=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t){var n;return Object(Oe["a"])(this,i),n=e.call(this),Object.defineProperty(Object(Ti["a"])(n),"isMarkerSet",{value:!0}),n.markerSets=new Map,n.markers=new Map,n.data={id:t,label:t,toggleable:!0,defaultHide:!1,markerSets:[],markers:[],visible:n.visible},Object.defineProperty(Object(Ti["a"])(n),"visible",{get:function(){return this.data.visible},set:function(t){this.data.visible=t}}),n}return Object(Te["a"])(i,[{key:"updateFromData",value:function(t){this.data.label=t.label||this.data.id,this.data.toggleable=!!t.toggleable,this.data.defaultHide=!!t.defaultHidden,this.updateMarkerSetsFromData(t.markerSets),this.updateMarkersFromData(t.markers)}},{key:"updateMarkerSetsFromData",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=new Set(i);Object.keys(e).forEach((function(i){if(!n.has(i)){n.add(i);var a=e[i];try{t.updateMarkerSetFromData(i,a)}catch(s){_(t.events,s,"fine")}}})),this.markerSets.forEach((function(e,i){n.has(i)||t.remove(e)}))}},{key:"updateMarkerSetFromData",value:function(t,e){var n=this.markerSets.get(t);n||(n=new i(t),this.add(n),e.defaultHidden&&(n.visible=!1)),n.updateFromData(e)}},{key:"updateMarkersFromData",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=new Set(i);Object.keys(e).forEach((function(i){if(!n.has(i)){var a=e[i];try{t.updateMarkerFromData(i,a),n.add(i)}catch(s){_(t.events,s,"fine"),console.debug(s)}}})),this.markers.forEach((function(e,i){n.has(i)||t.remove(e)}))}},{key:"updateMarkerFromData",value:function(t,e){if(!e.type)throw new Error("marker-data has no type!");var i=this.markers.get(t);if(!i||i.data.type!==e.type){switch(i&&this.remove(i),e.type){case"shape":i=new tn(t);break;case"extrude":i=new an(t);break;case"line":i=new on(t);break;case"html":i=new cn(t);break;case"poi":i=new un(t);break;default:throw new Error("Unknown marker-type: '".concat(e.type,"'"))}this.add(i)}i.updateFromData(e)}},{key:"clear",value:function(){var t=this;Object(Ee["a"])(this.data.markerSets).forEach((function(e){return t.remove(e)})),Object(Ee["a"])(this.data.markers).forEach((function(e){return t.remove(e)}))}},{key:"add",value:function(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];if(1===n.length){var s=n[0];s.isMarkerSet&&!this.markerSets.has(s.data.id)&&(this.markerSets.set(s.data.id,s),this.data.markerSets.push(s.data)),s.isMarker&&!this.markers.has(s.data.id)&&(this.markers.set(s.data.id,s),this.data.markers.push(s.data))}return(t=Object($i["a"])(Object(Ni["a"])(i.prototype),"add",this)).call.apply(t,[this].concat(n))}},{key:"remove",value:function(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];if(1===n.length){var s=n[0];if(s.isMarkerSet){var r=this.data.markerSets.indexOf(s.data);r>-1&&this.data.markerSets.splice(r,1),this.markerSets.delete(s.data.id),s.dispose()}if(s.isMarker){var o=this.data.markers.indexOf(s.data);o>-1&&this.data.markers.splice(o,1),this.markers.delete(s.data.id),s.dispose()}}return(t=Object($i["a"])(Object(Ni["a"])(i.prototype),"remove",this)).call.apply(t,[this].concat(n))}},{key:"dispose",value:function(){this.children.forEach((function(t){t.dispose&&t.dispose()}))}}]),i}(O["B"]),dn=function(){function t(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;Object(Oe["a"])(this,t),Object(je["a"])(this,"handleContainerResize",(function(){i.renderer.setSize(i.rootElement.clientWidth,i.rootElement.clientHeight),i.renderer.setPixelRatio(window.devicePixelRatio*i.superSampling),i.css2dRenderer.setSize(i.rootElement.clientWidth,i.rootElement.clientHeight),i.camera.aspect=i.rootElement.clientWidth/i.rootElement.clientHeight,i.camera.updateProjectionMatrix()})),Object(je["a"])(this,"renderLoop",(function(t){requestAnimationFrame(i.renderLoop),i.lastFrame<=0&&(i.lastFrame=t);var e=t-i.lastFrame;i.lastFrame=t,i.stats.begin(),null!=i.map&&i.controlsManager.update(e,i.map),i.render(e),i.stats.update()})),Object(je["a"])(this,"updateLoadedMapArea",(function(){i.map&&(i.controlsManager.distance<1e3?i.map.loadMapArea(i.data.loadedCenter.x,i.data.loadedCenter.y,i.data.loadedHiresViewDistance,i.data.loadedLowresViewDistance):i.map.loadMapArea(i.data.loadedCenter.x,i.data.loadedCenter.y,0,i.data.loadedLowresViewDistance))})),Object.defineProperty(this,"isMapViewer",{value:!0}),this.rootElement=e,this.events=n,this.data={map:null,camera:null,controlsManager:null,uniforms:{sunlightStrength:{value:1},ambientLight:{value:0},skyColor:{value:new O["f"](.5,.5,1)},hiresTileMap:{value:{map:null,size:ki.tileMapSize,scale:new O["N"](1,1),translate:new O["N"],pos:new O["N"]}}},superSampling:1,loadedCenter:new O["N"](0,0),loadedHiresViewDistance:200,loadedLowresViewDistance:2e3},this.tileCacheHash=E(),this.stats=new zi,this.stats.hide(),this.renderer=new O["R"]({antialias:!0,sortObjects:!0,preserveDrawingBuffer:!0,logarithmicDepthBuffer:!0}),this.renderer.autoClear=!1,this.renderer.uniforms=this.data.uniforms,this.css2dRenderer=new Bi(this.events),this.skyboxScene=new Ei(this.data.uniforms),this.camera=new Vi(75,1,.1,1e4,0),this.skyboxCamera=new O["y"](75,1,.1,1e4),this.skyboxCamera.updateProjectionMatrix(),this.controlsManager=new Ci(this,this.camera),this.raycaster=new O["A"],this.raycaster.layers.enableAll(),this.raycaster.params.Line2={threshold:20},this.map=null,this.markers=new hn("bm-root"),this.lastFrame=0,this.initializeRootElement(),window.addEventListener("resize",this.handleContainerResize),requestAnimationFrame(this.renderLoop)}return Object(Te["a"])(t,[{key:"initializeRootElement",value:function(){this.rootElement.innerHTML="";var t=z('<div style="position: relative; width: 100%; height: 100%; overflow: hidden;"></div>');this.rootElement.appendChild(t),t.appendChild(this.renderer.domElement),this.css2dRenderer.domElement.style.position="absolute",this.css2dRenderer.domElement.style.top="0",this.css2dRenderer.domElement.style.left="0",this.css2dRenderer.domElement.style.pointerEvents="none",t.appendChild(this.css2dRenderer.domElement),t.appendChild(this.stats.dom),this.handleContainerResize()}},{key:"handleMapInteraction",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=F(this.rootElement),n=new O["N"]((t.x-i.top)/this.rootElement.clientWidth*2-1,-(t.y-i.left)/this.rootElement.clientHeight*2+1);if(this.map&&this.map.isLoaded){this.raycaster.setFromCamera(n,this.camera);for(var a=[this.map.hiresTileManager.scene,this.markers],s=0;s<this.map.lowresTileManager.length;s++)a.push(this.map.lowresTileManager[s].scene);for(var r=this.raycaster.intersectObjects(a,!0),o=null,l=[],c=null,u=!1,h=0;h<r.length;h++)if(r[h].object){var d=r[h].object,p=d,m=p.visible;while(m&&p.parent)p=p.parent,m=p.visible;if(m){o||(o=r[h]);var f=d;while(f.parent)f=f.parent;for(var v=0;v<this.map.lowresTileManager.length;v++)f===this.map.lowresTileManager[v].sceneParent&&(l[v]||(l[v]=r[h]));if(f===this.map.hiresTileManager.sceneParent&&(c||(c=r[h])),(!u||d.material&&!d.material.depthTest)&&d.onClick&&d.onClick({data:e,intersection:r[h]}))return;f!==this.map.lowresTileManager[0].sceneParent&&(u=!0)}}C(this.events,"bluemapMapInteraction",{data:e,hit:o,hiresHit:c,lowresHits:l,intersections:r,ray:this.raycaster.ray})}}},{key:"render",value:function(t){if(C(this.events,"bluemapRenderFrame",{delta:t}),this.renderer.clear(),this.skyboxCamera.rotation.copy(this.camera.rotation),this.renderer.render(this.skyboxScene,this.skyboxCamera),this.renderer.clearDepth(),this.map&&this.map.isLoaded){var e=1e4,i=Math.round(this.camera.position.x/e)*e,n=Math.round(this.camera.position.z/e)*e;this.camera.position.x-=i,this.camera.position.z-=n,this.data.uniforms.hiresTileMap.value.pos.copy(this.map.hiresTileManager.centerTile),this.data.uniforms.hiresTileMap.value.translate.set(this.map.data.hires.translate.x-i,this.map.data.hires.translate.z-n);var a=this.camera.far;this.controlsManager.distance<1e3&&(this.camera.far=1e6),this.camera.updateProjectionMatrix();for(var s=this.map.lowresTileManager.length-1,r=this.map.lowresTileManager.length-1;r>=0;r--)if(r===s||this.controlsManager.distance<1e3*Math.pow(this.map.data.lowres.lodFactor,r+1)){var o=this.map.lowresTileManager[r].scene.position;o.x=-i,o.z=-n,this.renderer.render(this.map.lowresTileManager[r].sceneParent,this.camera),this.renderer.clearDepth()}if(this.camera.far=a,this.controlsManager.distance<1e3){this.camera.updateProjectionMatrix();var l=this.map.hiresTileManager.scene.position;l.x=-i,l.z=-n,this.renderer.render(this.map.hiresTileManager.sceneParent,this.camera)}this.camera.position.x+=i,this.camera.position.z+=n}this.renderer.render(this.markers,this.camera),this.css2dRenderer.render(this.markers,this.camera)}},{key:"switchMap",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.map&&this.map.isMap&&this.map.unload(),this.map=e,this.map&&this.map.isMap?e.load(Ai,Ui,Fi,Ri,this.data.uniforms,this.tileCacheHash).then((function(){var i,n=Object(l["a"])(t.map.loadedTextures);try{for(n.s();!(i=n.n()).done;){var a=i.value;t.renderer.initTexture(a)}}catch(s){n.e(s)}finally{n.f()}t.data.uniforms.skyColor.value=e.data.skyColor,t.data.uniforms.ambientLight.value=e.data.ambientLight,t.data.uniforms.hiresTileMap.value.map=e.hiresTileManager.tileMap.texture,t.data.uniforms.hiresTileMap.value.scale.set(e.data.hires.tileSize.x,e.data.hires.tileSize.z),t.data.uniforms.hiresTileMap.value.translate.set(e.data.hires.translate.x,e.data.hires.translate.z),setTimeout(t.updateLoadedMapArea),C(t.events,"bluemapMapChanged",{map:e})})).catch((function(e){_(t.events,e,"error")})):Promise.resolve()}},{key:"loadMapArea",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;this.data.loadedCenter.set(t,e),i>=0&&(this.data.loadedHiresViewDistance=i),n>=0&&(this.data.loadedLowresViewDistance=n),this.updateLoadedMapArea()}},{key:"clearTileCache",value:function(t){if(t||(t=E()),this.tileCacheHash=t,this.map){for(var e=0;e<this.map.lowresTileManager.length;e++)this.map.lowresTileManager[e].tileLoader.tileCacheHash=this.tileCacheHash;this.map.hiresTileManager.tileLoader.tileCacheHash=this.tileCacheHash}}},{key:"superSampling",get:function(){return this.data.superSampling},set:function(t){this.data.superSampling=t,this.handleContainerResize()}},{key:"camera",get:function(){return this._camera},set:function(t){this._camera=t,this.data.camera=t.data}},{key:"controlsManager",get:function(){return this._controlsManager},set:function(t){this._controlsManager=t,this.data.controlsManager=t.data}},{key:"map",get:function(){return this._map},set:function(t){this._map=t,t&&(this.data.map=t.data)}}]),t}(),pn=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t,n){var a;return Object(Oe["a"])(this,i),a=e.call(this,t),Object.defineProperty(Object(Ti["a"])(a),"isPlayerMarker",{value:!0}),a.data.type="player",a.data.playerUuid=n,a.data.name=n,a.elementObject=new Hi(z('\n<div id="bm-marker-'.concat(a.data.id,'" class="bm-marker-').concat(a.data.type,'">\n    <img src="assets/playerheads/').concat(a.data.playerUuid,'.png" alt="playerhead" draggable="false">\n    <div class="bm-player-name"></div>\n</div>\n        '))),a.elementObject.onBeforeRender=function(t,e,i){return a.onBeforeRender(t,e,i)},a.playerHeadElement=a.element.getElementsByTagName("img")[0],a.playerNameElement=a.element.getElementsByTagName("div")[0],a.addEventListener("removed",(function(){a.element.parentNode&&a.element.parentNode.removeChild(a.element)})),a.playerHeadElement.addEventListener("error",(function(){a.playerHeadElement.src="assets/steve.png"}),{once:!0}),a.add(a.elementObject),a}return Object(Te["a"])(i,[{key:"element",get:function(){return this.elementObject.element.getElementsByTagName("div")[0]}},{key:"onBeforeRender",value:function(t,e,i){var n=qi.calculateDistanceToCameraPlane(this.position,i),a="near";n>1e3&&(a="med"),n>5e3&&(a="far"),this.element.setAttribute("distance-data",a)}},{key:"updateFromData",value:function(t){var e=this,i=t.position||{};if(this.position.x||this.position.y||this.position.z){var n={x:this.position.x,y:this.position.y,z:this.position.z},a={x:(i.x||0)-n.x,y:(i.y||0)+1.8-n.y,z:(i.z||0)-n.z};(a.x||a.y||a.z)&&A((function(t){var i=U.easeInOutCubic(t);e.position.set(n.x+a.x*i||0,n.y+a.y*i||0,n.z+a.z*i||0)}),500)}else this.position.set(i.x||0,i.y||0,i.z||0);var s=t.name||this.data.playerUuid;this.data.name=s,this.playerNameElement.innerHTML!==s&&(this.playerNameElement.innerHTML=s),this.data.foreign=t.foreign}},{key:"dispose",value:function(){Object($i["a"])(Object(Ni["a"])(i.prototype),"dispose",this).call(this);var t=this.elementObject.element;t.parentNode&&t.parentNode.removeChild(t)}}]),i}(qi),mn=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t){var n;return Object(Oe["a"])(this,i),n=e.call(this,t),n.data.label="Player",n.data.toggleable=!0,n.data.defaultHide=!1,n}return Object(Te["a"])(i,[{key:"updateFromPlayerData",value:function(t){var e=this;if(!Array.isArray(t.players))return this.clear(),!1;var i=new Set;return t.players.forEach((function(t){try{var n=e.updatePlayerMarkerFromData(t);i.add(n)}catch(a){_(e.events,a,"fine")}})),this.markers.forEach((function(t){i.has(t)||e.remove(t)})),!0}},{key:"updatePlayerMarkerFromData",value:function(t){var e=t.uuid;if(!e)throw new Error("player-data has no uuid!");var i=this.getPlayerMarkerId(e),n=this.markers.get(i);return n&&n.isPlayerMarker||(n&&this.remove(n),n=new pn(i,e),this.add(n)),n.updateFromData(t),n.visible=!t.foreign,n}},{key:"getPlayerMarker",value:function(t){return this.markers.get(this.getPlayerMarkerId(t))}},{key:"getPlayerMarkerId",value:function(t){return"bm-player-"+t}}]),i}(hn),fn={NORMAL:1,PLAYER:2},vn="bm-players",gn=function(){function t(e,i,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Object(Oe["a"])(this,t),Object.defineProperty(this,"isMarkerManager",{value:!0}),this.root=e,this.fileUrl=i,this.fileType=n,this.events=a,this.disposed=!1,this._updateInterval=null}return Object(Te["a"])(t,[{key:"setAutoUpdateInterval",value:function(t){var e=this;if(this._updateInterval&&clearTimeout(this._updateInterval),t>0){var i=function i(){e.disposed||e.update().then((function(n){e._updateInterval=n?setTimeout(i,t):setTimeout(i,Math.max(t,15e3))})).catch((function(n){_(e.events,n,"warning"),e._updateInterval=setTimeout(i,Math.max(t,15e3))}))};this._updateInterval=setTimeout(i,t)}}},{key:"update",value:function(){var t=this;return this.loadMarkerFile().then((function(e){return t.updateFromData(e)}))}},{key:"updateFromData",value:function(t){switch(this.fileType){case fn.NORMAL:return this.updateFromDataNormal(t);case fn.PLAYER:return this.updateFromDataPlayer(t)}}},{key:"updateFromDataNormal",value:function(t){return this.root.updateMarkerSetsFromData(t,[vn,"bm-popup-set"]),!0}},{key:"updateFromDataPlayer",value:function(t){var e=this.getPlayerMarkerSet();return e.updateFromPlayerData(t)}},{key:"getPlayerMarkerSet",value:function(){var t=this.root.markerSets.get(vn);return t||(t=new mn(vn),this.root.add(t)),t}},{key:"getPlayerMarker",value:function(t){return this.getPlayerMarkerSet().getPlayerMarker(t)}},{key:"dispose",value:function(){this.disposed=!0,this.setAutoUpdateInterval(0),this.clear()}},{key:"clear",value:function(){this.root.clear()}},{key:"loadMarkerFile",value:function(){var t=this;return new Promise((function(e,i){var n=new O["i"];n.setResponseType("json"),n.load(t.fileUrl+"?"+E(),(function(n){n?e(n):i("Failed to parse '".concat(t.fileUrl,"'!"))}),(function(){}),(function(){return i("Failed to load '".concat(t.fileUrl,"'!"))}))}))}}]),t}(),yn=function(){function t(e,i,n){var a=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onMouseDown",(function(t){(void 0!==t.buttons?1!==t.buttons:0!==t.button)||t.altKey||(a.moving=!0,a.deltaPosition.set(0,0),a.lastPosition.set(t.x,t.y))})),Object(je["a"])(this,"onMouseMove",(function(e){var i=t.tempVec2_1.set(e.x,e.y);a.moving&&a.deltaPosition.sub(i).add(a.lastPosition),a.lastPosition.copy(i)})),Object(je["a"])(this,"onMouseUp",(function(t){0===t.button&&(a.moving=!1)})),Object(je["a"])(this,"updatePixelToSpeedMultiplier",(function(){a.pixelToSpeedMultiplierX=1/a.target.clientWidth*(a.target.clientWidth/a.target.clientHeight),a.pixelToSpeedMultiplierY=1/a.target.clientHeight})),this.target=e,this.manager=null,this.moving=!1,this.lastPosition=new O["N"],this.deltaPosition=new O["N"],this.speed=i,this.stiffness=n,this.pixelToSpeedMultiplierX=0,this.pixelToSpeedMultiplierY=0,this.updatePixelToSpeedMultiplier()}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,this.target.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"stop",value:function(){this.target.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"update",value:function(e,i){if(0!==this.deltaPosition.x||0!==this.deltaPosition.y){var n=this.stiffness/(16.666/e);n=O["r"].clamp(n,0,1);var a=t.tempVec2_1.copy(this.deltaPosition);a.rotateAround(T,this.manager.rotation),this.manager.position.x+=a.x*n*this.manager.distance*this.speed*this.pixelToSpeedMultiplierX,this.manager.position.z+=a.y*n*this.manager.distance*this.speed*this.pixelToSpeedMultiplierY,this.deltaPosition.multiplyScalar(1-n),this.deltaPosition.lengthSq()<1e-4&&this.deltaPosition.set(0,0)}}},{key:"reset",value:function(){this.deltaPosition.set(0,0)}}]),t}();Object(je["a"])(yn,"tempVec2_1",new O["N"]);var bn=function(){function t(e,i,n){var a=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onMouseWheel",(function(t){var e=t.deltaY;t.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(e*=.01),t.deltaMode===WheelEvent.DOM_DELTA_LINE&&(e*=.33),a.deltaZoom+=e})),this.target=e,this.manager=null,this.stiffness=n,this.speed=i,this.deltaZoom=0}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,this.target.addEventListener("wheel",this.onMouseWheel,{passive:!0})}},{key:"stop",value:function(){this.target.removeEventListener("wheel",this.onMouseWheel)}},{key:"update",value:function(t,e){if(0!==this.deltaZoom){var i=this.stiffness/(16.666/t);i=O["r"].clamp(i,0,1),this.manager.distance*=Math.pow(1.5,this.deltaZoom*i*this.speed),this.deltaZoom*=1-i,Math.abs(this.deltaZoom)<1e-4&&(this.deltaZoom=0)}}},{key:"reset",value:function(){this.deltaZoom=0}}]),t}(),wn=function(){function t(e,i,n){var a=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onMouseDown",(function(t){((void 0!==t.buttons?2===t.buttons:2===t.button)||(t.altKey||t.ctrlKey)&&(void 0!==t.buttons?1===t.buttons:0===t.button))&&(a.moving=!0,a.deltaRotation=0,a.lastX=t.x)})),Object(je["a"])(this,"onMouseMove",(function(t){a.moving&&(a.deltaRotation+=t.x-a.lastX),a.lastX=t.x})),Object(je["a"])(this,"onMouseUp",(function(t){a.moving=!1})),Object(je["a"])(this,"updatePixelToSpeedMultiplier",(function(){a.pixelToSpeedMultiplierX=1/a.target.clientWidth})),this.target=e,this.manager=null,this.moving=!1,this.lastX=0,this.deltaRotation=0,this.speed=i,this.stiffness=n,this.pixelToSpeedMultiplierX=0,this.updatePixelToSpeedMultiplier()}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,this.target.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"stop",value:function(){this.target.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"update",value:function(t,e){if(0!==this.deltaRotation){var i=this.stiffness/(16.666/t);i=O["r"].clamp(i,0,1),this.manager.rotation+=this.deltaRotation*i*this.speed*this.pixelToSpeedMultiplierX,this.deltaRotation*=1-i,Math.abs(this.deltaRotation)<1e-4&&(this.deltaRotation=0)}}},{key:"reset",value:function(){this.deltaRotation=0}}]),t}(),Mn=function(){function t(e,i,n){var a=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onMouseDown",(function(t){((void 0!==t.buttons?2===t.buttons:2===t.button)||(t.altKey||t.ctrlKey)&&(void 0!==t.buttons?1===t.buttons:0===t.button))&&(a.moving=!0,a.deltaAngle=0,a.lastY=t.y)})),Object(je["a"])(this,"onMouseMove",(function(t){a.moving&&(a.deltaAngle-=t.y-a.lastY),a.lastY=t.y})),Object(je["a"])(this,"onMouseUp",(function(t){a.moving=!1})),Object(je["a"])(this,"updatePixelToSpeedMultiplier",(function(){a.pixelToSpeedMultiplierY=1/a.target.clientHeight})),this.target=e,this.manager=null,this.moving=!1,this.lastY=0,this.deltaAngle=0,this.speed=i,this.stiffness=n,this.pixelToSpeedMultiplierY=0,this.updatePixelToSpeedMultiplier()}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,this.target.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"stop",value:function(){this.target.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"update",value:function(t,e){if(0!==this.deltaAngle){var i=this.stiffness/(16.666/t);i=O["r"].clamp(i,0,1),this.manager.angle+=this.deltaAngle*i*this.speed*this.pixelToSpeedMultiplierY,this.deltaAngle*=1-i,Math.abs(this.deltaAngle)<1e-4&&(this.deltaAngle=0)}}},{key:"reset",value:function(){this.deltaAngle=0}}]),t}(),kn=i("c8b5"),Sn=function(){function t(e,i){Object(Oe["a"])(this,t),this.manager=null,this.cameraHeightStiffness=e,this.targetHeightStiffness=i,this.maxAngle=Math.PI/2,this.targetHeight=0,this.cameraHeight=0,this.minCameraHeight=0,this.distanceTagretHeight=0}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t}},{key:"stop",value:function(){}},{key:"update",value:function(t,e){this.updateHeights(t,e),this.manager.position.y=Math.max(this.manager.position.y,this.getSuggestedHeight())}},{key:"updateHeights",value:function(t,e){var i=this.targetHeightStiffness/(16.666/t);i=O["r"].clamp(i,0,1);var n=e.terrainHeightAt(this.manager.position.x,this.manager.position.z)+3||0,a=n-this.targetHeight;if(this.targetHeight+=a*i,Math.abs(a)<.001&&(this.targetHeight=n),this.minCameraHeight=0,this.maxAngle>=.1){var s=this.cameraHeightStiffness/(16.666/t);s=O["r"].clamp(s,0,1);var r=e.terrainHeightAt(this.manager.camera.position.x,this.manager.camera.position.z)||0,o=r-this.cameraHeight;this.cameraHeight+=o*s,Math.abs(o)<.001&&(this.cameraHeight=r);var l=Math.cos(this.maxAngle)*this.manager.distance;this.minCameraHeight=this.cameraHeight-l+1}this.distanceTagretHeight=Math.max(O["r"].lerp(this.targetHeight,0,this.manager.distance/500),0)}},{key:"getSuggestedHeight",value:function(){return Math.max(this.distanceTagretHeight,this.minCameraHeight)}}]),t}(),xn=function(){function t(e){Object(Oe["a"])(this,t),this.code=e;for(var i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];this.ctrl=n.includes(t.CTRL)||"CtrlLeft"===this.code||"CtrlRight"===this.code,this.shift=n.includes(t.SHIFT)||"ShiftLeft"===this.code||"ShiftRight"===this.code,this.alt=n.includes(t.ALT)||"AltLeft"===this.code||"AltRight"===this.code}return Object(Te["a"])(t,[{key:"testDown",value:function(t){return this.code===t.code&&this.ctrl===t.ctrlKey&&this.shift===t.shiftKey&&this.alt===t.altKey}},{key:"testUp",value:function(t){return this.code===t.code}}],[{key:"oneDown",value:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(var a=0,s=i;a<s.length;a++){var r=s[a];if(r.testDown(t))return!0}return!1}},{key:"oneUp",value:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(var a=0,s=i;a<s.length;a++){var r=s[a];if(r.testUp(t))return!0}return!1}}]),t}();Object(je["a"])(xn,"CTRL",0),Object(je["a"])(xn,"SHIFT",1),Object(je["a"])(xn,"ALT",2);var On=function(){function t(e,i,n){var a=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onKeyDown",(function(e){xn.oneDown.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.UP)))&&(a.up=!0,e.preventDefault()),xn.oneDown.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.DOWN)))&&(a.down=!0,e.preventDefault()),xn.oneDown.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.LEFT)))&&(a.left=!0,e.preventDefault()),xn.oneDown.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.RIGHT)))&&(a.right=!0,e.preventDefault())})),Object(je["a"])(this,"onKeyUp",(function(e){xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.UP)))&&(a.up=!1),xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.DOWN)))&&(a.down=!1),xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.LEFT)))&&(a.left=!1),xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.RIGHT)))&&(a.right=!1)})),this.target=e,this.manager=null,this.deltaPosition=new O["N"],this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.speed=i,this.stiffness=n}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}},{key:"stop",value:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"update",value:function(e,i){if(this.up&&(this.deltaPosition.y-=1),this.down&&(this.deltaPosition.y+=1),this.left&&(this.deltaPosition.x-=1),this.right&&(this.deltaPosition.x+=1),0!==this.deltaPosition.x||0!==this.deltaPosition.y){var n=this.stiffness/(16.666/e);n=O["r"].clamp(n,0,1);var a=t.temp_v2.copy(this.deltaPosition);a.rotateAround(T,this.manager.rotation),this.manager.position.x+=a.x*n*this.manager.distance*this.speed*e*.06,this.manager.position.z+=a.y*n*this.manager.distance*this.speed*e*.06,this.deltaPosition.multiplyScalar(1-n),this.deltaPosition.lengthSq()<1e-4&&this.deltaPosition.set(0,0)}}}]),t}();Object(je["a"])(On,"KEYS",{LEFT:[new xn("ArrowLeft"),new xn("KeyA")],UP:[new xn("ArrowUp"),new xn("KeyW")],RIGHT:[new xn("ArrowRight"),new xn("KeyD")],DOWN:[new xn("ArrowDown"),new xn("KeyS")]}),Object(je["a"])(On,"temp_v2",new O["N"]);var Tn=function(){function t(e,i,n){var a=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onKeyDown",(function(e){xn.oneDown.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.UP)))&&(a.up=!0,e.preventDefault()),xn.oneDown.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.DOWN)))&&(a.down=!0,e.preventDefault())})),Object(je["a"])(this,"onKeyUp",(function(e){xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.UP)))&&(a.up=!1),xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.DOWN)))&&(a.down=!1)})),this.target=e,this.manager=null,this.deltaAngle=0,this.up=!1,this.down=!1,this.speed=i,this.stiffness=n}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}},{key:"stop",value:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"update",value:function(t,e){if(this.up&&(this.deltaAngle-=1),this.down&&(this.deltaAngle+=1),0!==this.deltaAngle){var i=this.stiffness/(16.666/t);i=O["r"].clamp(i,0,1),this.manager.angle+=this.deltaAngle*i*this.speed*t*.06,this.deltaAngle*=1-i,Math.abs(this.deltaAngle)<1e-4&&(this.deltaAngle=0)}}}]),t}();Object(je["a"])(Tn,"KEYS",{UP:[new xn("ArrowUp",xn.ALT),new xn("KeyW",xn.ALT),new xn("PageUp")],DOWN:[new xn("ArrowDown",xn.ALT),new xn("KeyS",xn.ALT),new xn("PageDown")]});var jn=function(){function t(e,i,n){var a=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onKeyDown",(function(e){xn.oneDown.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.LEFT)))&&(a.left=!0,e.preventDefault()),xn.oneDown.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.RIGHT)))&&(a.right=!0,e.preventDefault())})),Object(je["a"])(this,"onKeyUp",(function(e){xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.LEFT)))&&(a.left=!1),xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.RIGHT)))&&(a.right=!1)})),this.target=e,this.manager=null,this.deltaRotation=0,this.left=!1,this.right=!1,this.speed=i,this.stiffness=n}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}},{key:"stop",value:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"update",value:function(t,e){if(this.left&&(this.deltaRotation+=1),this.right&&(this.deltaRotation-=1),0!==this.deltaRotation){var i=this.stiffness/(16.666/t);i=O["r"].clamp(i,0,1),this.manager.rotation+=this.deltaRotation*i*this.speed*t*.06,this.deltaRotation*=1-i,Math.abs(this.deltaRotation)<1e-4&&(this.deltaRotation=0)}}}]),t}();Object(je["a"])(jn,"KEYS",{LEFT:[new xn("ArrowLeft",xn.ALT),new xn("KeyA",xn.ALT),new xn("Delete")],RIGHT:[new xn("ArrowRight",xn.ALT),new xn("KeyD",xn.ALT),new xn("End")]});var Pn=function(){function t(e,i,n){var a=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onKeyDown",(function(e){xn.oneDown.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.IN)))&&(a.in=!0,e.preventDefault()),xn.oneDown.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.OUT)))&&(a.out=!0,e.preventDefault())})),Object(je["a"])(this,"onKeyUp",(function(e){xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.IN)))&&(a.in=!1),xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.OUT)))&&(a.out=!1)})),this.target=e,this.manager=null,this.deltaZoom=0,this.in=!1,this.out=!1,this.speed=i,this.stiffness=n}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}},{key:"stop",value:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"update",value:function(t,e){if(this.in&&(this.deltaZoom-=1),this.out&&(this.deltaZoom+=1),0!==this.deltaZoom){var i=this.stiffness/(16.666/t);i=O["r"].clamp(i,0,1),this.manager.distance*=Math.pow(1.5,this.deltaZoom*i*this.speed*t*.06),this.deltaZoom*=1-i,Math.abs(this.deltaZoom)<1e-4&&(this.deltaZoom=0)}}}]),t}();Object(je["a"])(Pn,"KEYS",{IN:[new xn("NumpadAdd"),new xn("Insert")],OUT:[new xn("NumpadSubtract"),new xn("Home")]});var Dn=function(){function t(e,i,n,a){var s=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onTouchDown",(function(t){"mouse"!==t.pointerType&&(s.moving=!0,s.deltaPosition.set(0,0),s.lastPosition.set(t.center.x,t.center.y))})),Object(je["a"])(this,"onTouchMove",(function(e){if("mouse"!==e.pointerType){var i=t.tempVec2_1.set(e.center.x,e.center.y);s.moving&&s.deltaPosition.sub(i).add(s.lastPosition),s.lastPosition.copy(i)}})),Object(je["a"])(this,"onTouchUp",(function(t){"mouse"!==t.pointerType&&(s.moving=!1)})),Object(je["a"])(this,"updatePixelToSpeedMultiplier",(function(){s.pixelToSpeedMultiplierX=1/s.target.clientWidth*(s.target.clientWidth/s.target.clientHeight),s.pixelToSpeedMultiplierY=1/s.target.clientHeight})),this.target=e,this.hammer=i,this.manager=null,this.moving=!1,this.lastPosition=new O["N"],this.deltaPosition=new O["N"],this.speed=n,this.stiffness=a,this.pixelToSpeedMultiplierX=0,this.pixelToSpeedMultiplierY=0,this.updatePixelToSpeedMultiplier()}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,this.hammer.on("movestart",this.onTouchDown),this.hammer.on("movemove",this.onTouchMove),this.hammer.on("moveend",this.onTouchUp),this.hammer.on("movecancel",this.onTouchUp),window.addEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"stop",value:function(){this.hammer.off("movestart",this.onTouchDown),this.hammer.off("movemove",this.onTouchMove),this.hammer.off("moveend",this.onTouchUp),this.hammer.off("movecancel",this.onTouchUp),window.removeEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"update",value:function(e,i){if(0!==this.deltaPosition.x||0!==this.deltaPosition.y){var n=this.stiffness/(16.666/e);n=O["r"].clamp(n,0,1);var a=t.tempVec2_1.copy(this.deltaPosition);a.rotateAround(T,this.manager.rotation),this.manager.position.x+=a.x*n*this.manager.distance*this.speed*this.pixelToSpeedMultiplierX,this.manager.position.z+=a.y*n*this.manager.distance*this.speed*this.pixelToSpeedMultiplierY,this.deltaPosition.multiplyScalar(1-n),this.deltaPosition.lengthSq()<1e-4&&this.deltaPosition.set(0,0)}}},{key:"reset",value:function(){this.deltaPosition.set(0,0)}}]),t}();Object(je["a"])(Dn,"tempVec2_1",new O["N"]);var Ln=function(){function t(e,i,n){var a=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onTouchDown",(function(t){a.moving=!0,a.deltaRotation=0,a.lastRotation=t.rotation})),Object(je["a"])(this,"onTouchMove",(function(t){if(a.moving){var e=t.rotation-a.lastRotation;e>180&&(e-=360),e<-180&&(e+=360),a.deltaRotation-=e}a.lastRotation=t.rotation})),Object(je["a"])(this,"onTouchUp",(function(t){a.moving=!1})),this.hammer=e,this.manager=null,this.moving=!1,this.lastRotation=0,this.deltaRotation=0,this.speed=i,this.stiffness=n}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,this.hammer.on("rotatestart",this.onTouchDown),this.hammer.on("rotatemove",this.onTouchMove),this.hammer.on("rotateend",this.onTouchUp),this.hammer.on("rotatecancel",this.onTouchUp)}},{key:"stop",value:function(){this.hammer.off("rotatestart",this.onTouchDown),this.hammer.off("rotatemove",this.onTouchMove),this.hammer.off("rotateend",this.onTouchUp),this.hammer.off("rotatecancel",this.onTouchUp)}},{key:"update",value:function(t,e){if(0!==this.deltaRotation){var i=this.stiffness/(16.666/t);i=O["r"].clamp(i,0,1),this.manager.rotation+=this.deltaRotation*i*this.speed,this.deltaRotation*=1-i,Math.abs(this.deltaRotation)<1e-4&&(this.deltaRotation=0)}}},{key:"reset",value:function(){this.deltaRotation=0}}]),t}(),En=function(){function t(e,i,n,a){var s=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onTouchDown",(function(t){s.moving=!0,s.deltaAngle=0,s.lastY=t.center.y})),Object(je["a"])(this,"onTouchMove",(function(t){s.moving&&(s.deltaAngle-=t.center.y-s.lastY),s.lastY=t.center.y})),Object(je["a"])(this,"onTouchUp",(function(t){s.moving=!1})),Object(je["a"])(this,"updatePixelToSpeedMultiplier",(function(){s.pixelToSpeedMultiplierY=1/s.target.clientHeight})),this.target=e,this.hammer=i,this.manager=null,this.moving=!1,this.lastY=0,this.deltaAngle=0,this.speed=n,this.stiffness=a,this.pixelToSpeedMultiplierY=0,this.updatePixelToSpeedMultiplier()}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,this.hammer.on("tiltstart",this.onTouchDown),this.hammer.on("tiltmove",this.onTouchMove),this.hammer.on("tiltend",this.onTouchUp),this.hammer.on("tiltcancel",this.onTouchUp),window.addEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"stop",value:function(){this.hammer.off("tiltstart",this.onTouchDown),this.hammer.off("tiltmove",this.onTouchMove),this.hammer.off("tiltend",this.onTouchUp),this.hammer.off("tiltcancel",this.onTouchUp),window.removeEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"update",value:function(t,e){if(0!==this.deltaAngle){var i=this.stiffness/(16.666/t);i=O["r"].clamp(i,0,1),this.manager.angle+=this.deltaAngle*i*this.speed*this.pixelToSpeedMultiplierY,this.deltaAngle*=1-i,Math.abs(this.deltaAngle)<1e-4&&(this.deltaAngle=0)}}},{key:"reset",value:function(){this.deltaAngle=0}}]),t}(),Cn=function(){function t(e){var i=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onTouchDown",(function(t){i.moving=!0,i.lastZoom=1})),Object(je["a"])(this,"onTouchMove",(function(t){i.moving&&(i.deltaZoom*=t.scale/i.lastZoom),i.lastZoom=t.scale})),Object(je["a"])(this,"onTouchUp",(function(t){i.moving=!1})),this.hammer=e,this.manager=null,this.moving=!1,this.deltaZoom=1,this.lastZoom=1}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,this.hammer.on("zoomstart",this.onTouchDown),this.hammer.on("zoommove",this.onTouchMove),this.hammer.on("zoomend",this.onTouchUp),this.hammer.on("zoomcancel",this.onTouchUp)}},{key:"stop",value:function(){this.hammer.off("zoomstart",this.onTouchDown),this.hammer.off("zoommove",this.onTouchMove),this.hammer.off("zoomend",this.onTouchUp),this.hammer.off("zoomcancel",this.onTouchUp)}},{key:"update",value:function(t,e){1!==this.deltaZoom&&(this.manager.distance/=this.deltaZoom,this.deltaZoom=1)}},{key:"reset",value:function(){this.deltaZoom=1}}]),t}(),_n=.5*Math.PI,zn=function(){function t(e){var i=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onContextMenu",(function(t){t.preventDefault()})),Object(je["a"])(this,"onTap",(function(t){var e=!1,n=new O["N"](t.center.x,t.center.y),a=Date.now();i.lastTap>0&&i.lastTapCenter&&a-i.lastTap<500&&i.lastTapCenter.distanceTo(n)<5?(e=!0,i.lastTap=-1):(i.lastTap=a,i.lastTapCenter=n),i.manager.handleMapInteraction(new O["N"](t.center.x,t.center.y),{doubleTap:e})})),this.rootElement=e,this.data={followingPlayer:null},this.manager=null,this.hammer=new kn["Manager"](this.rootElement),this.initializeHammer(),this.mouseMove=new yn(this.rootElement,1.5,.3),this.mouseRotate=new wn(this.rootElement,6,.3),this.mouseAngle=new Mn(this.rootElement,3,.3),this.mouseZoom=new bn(this.rootElement,1,.2),this.keyMove=new On(this.rootElement,.025,.2),this.keyRotate=new jn(this.rootElement,.06,.15),this.keyAngle=new Tn(this.rootElement,.04,.15),this.keyZoom=new Pn(this.rootElement,.2,.15),this.touchMove=new Dn(this.rootElement,this.hammer,1.5,.3),this.touchRotate=new Ln(this.hammer,.0174533,.3),this.touchAngle=new En(this.rootElement,this.hammer,3,.3),this.touchZoom=new Cn(this.hammer),this.mapHeight=new Sn(.2,.1),this.lastTap=-1,this.lastTapCenter=null,this.minDistance=5,this.maxDistance=1e5}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,this.rootElement.addEventListener("contextmenu",this.onContextMenu),this.hammer.on("tap",this.onTap),this.mouseMove.start(t),this.mouseRotate.start(t),this.mouseAngle.start(t),this.mouseZoom.start(t),this.keyMove.start(t),this.keyRotate.start(t),this.keyAngle.start(t),this.keyZoom.start(t),this.touchMove.start(t),this.touchRotate.start(t),this.touchAngle.start(t),this.touchZoom.start(t),this.mapHeight.start(t)}},{key:"stop",value:function(){this.stopFollowingPlayerMarker(),this.rootElement.removeEventListener("contextmenu",this.onContextMenu),this.hammer.off("tap",this.onTap),this.mouseMove.stop(),this.mouseRotate.stop(),this.mouseAngle.stop(),this.mouseZoom.stop(),this.keyMove.stop(),this.keyRotate.stop(),this.keyAngle.stop(),this.keyZoom.stop(),this.touchMove.stop(),this.touchRotate.stop(),this.touchAngle.stop(),this.touchZoom.stop(),this.mapHeight.stop()}},{key:"update",value:function(e,i){this.manager.position.y=0,t._beforeMoveTemp.copy(this.manager.position),this.mouseMove.update(e,i),this.keyMove.update(e,i),this.touchMove.update(e,i),this.data.followingPlayer&&!t._beforeMoveTemp.equals(this.manager.position)&&this.stopFollowingPlayerMarker(),this.data.followingPlayer&&this.manager.position.copy(this.data.followingPlayer.position),this.mouseZoom.update(e,i),this.keyZoom.update(e,i),this.touchZoom.update(e,i),this.manager.distance=B(this.manager.distance,this.minDistance,this.maxDistance,.8);var n=this.getMaxPerspectiveAngleForDistance(this.manager.distance);0===this.manager.ortho&&(this.mouseRotate.update(e,i),this.keyRotate.update(e,i),this.touchRotate.update(e,i)),0===this.manager.ortho&&(this.mouseAngle.update(e,i),this.keyAngle.update(e,i),this.touchAngle.update(e,i),this.manager.angle=B(this.manager.angle,0,n,.8)),0!==this.manager.ortho&&0!==this.manager.angle||(this.mapHeight.maxAngle=n,this.mapHeight.update(e,i))}},{key:"reset",value:function(){this.mouseMove.reset(),this.mouseRotate.reset(),this.mouseAngle.reset(),this.mouseZoom.reset(),this.touchMove.reset(),this.touchRotate.reset(),this.touchAngle.reset(),this.touchZoom.reset()}},{key:"getMaxPerspectiveAngleForDistance",value:function(t){return O["r"].clamp((1-Math.pow(Math.max(t-5,.001)/500,.5))*_n,0,_n)}},{key:"initializeHammer",value:function(){var t=new kn["Tap"]({event:"tap",pointers:1,taps:1,threshold:5}),e=new kn["Pan"]({event:"move",pointers:1,direction:kn["DIRECTION_ALL"],threshold:0}),i=new kn["Pan"]({event:"tilt",pointers:2,direction:kn["DIRECTION_VERTICAL"],threshold:0}),n=new kn["Rotate"]({event:"rotate",pointers:2,threshold:0}),a=new kn["Pinch"]({event:"zoom",pointers:2,threshold:0});e.recognizeWith(n),e.recognizeWith(i),e.recognizeWith(a),i.recognizeWith(n),i.recognizeWith(a),n.recognizeWith(a),this.hammer.add(t),this.hammer.add(i),this.hammer.add(e),this.hammer.add(n),this.hammer.add(a)}},{key:"followPlayerMarker",value:function(t){t.isPlayerMarker&&(t=t.data),this.data.followingPlayer=t}},{key:"stopFollowingPlayerMarker",value:function(){this.data.followingPlayer=null}}]),t}();Object(je["a"])(zn,"_beforeMoveTemp",new O["O"]);var An=function(){function t(e,i,n){var a=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onKeyDown",(function(e){xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.UP)))&&(a.up=!0,e.preventDefault()),xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.DOWN)))&&(a.down=!0,e.preventDefault()),xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.LEFT)))&&(a.left=!0,e.preventDefault()),xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.RIGHT)))&&(a.right=!0,e.preventDefault())})),Object(je["a"])(this,"onKeyUp",(function(e){xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.UP)))&&(a.up=!1),xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.DOWN)))&&(a.down=!1),xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.LEFT)))&&(a.left=!1),xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.RIGHT)))&&(a.right=!1)})),this.target=e,this.manager=null,this.deltaPosition=new O["N"],this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.speed=i,this.stiffness=n}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}},{key:"stop",value:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"update",value:function(e,i){if(this.up&&(this.deltaPosition.y-=1),this.down&&(this.deltaPosition.y+=1),this.left&&(this.deltaPosition.x-=1),this.right&&(this.deltaPosition.x+=1),0!==this.deltaPosition.x||0!==this.deltaPosition.y){var n=this.stiffness/(16.666/e);n=O["r"].clamp(n,0,1);var a=t.temp_v2.copy(this.deltaPosition);a.rotateAround(T,this.manager.rotation),this.manager.position.x+=a.x*n*this.speed*e*.06,this.manager.position.z+=a.y*n*this.speed*e*.06,this.deltaPosition.multiplyScalar(1-n),this.deltaPosition.lengthSq()<1e-4&&this.deltaPosition.set(0,0)}}}]),t}();Object(je["a"])(An,"KEYS",{LEFT:[new xn("ArrowLeft"),new xn("KeyA")],UP:[new xn("ArrowUp"),new xn("KeyW")],RIGHT:[new xn("ArrowRight"),new xn("KeyD")],DOWN:[new xn("ArrowDown"),new xn("KeyS")]}),Object(je["a"])(An,"temp_v2",new O["N"]);var Un=function(){function t(e,i,n,a,s){var r=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onMouseDown",(function(t){r.moving=!0,r.deltaRotation=0,r.lastX=t.x})),Object(je["a"])(this,"onMouseMove",(function(t){document.pointerLockElement?r.deltaRotation-=t.movementX*r.speedCapture*r.pixelToSpeedMultiplier:r.moving&&(1===t.buttons?r.deltaRotation-=(t.x-r.lastX)*r.speedLeft*r.pixelToSpeedMultiplier:r.deltaRotation-=(t.x-r.lastX)*r.speedRight*r.pixelToSpeedMultiplier),r.lastX=t.x})),Object(je["a"])(this,"onMouseUp",(function(t){r.moving=!1})),Object(je["a"])(this,"updatePixelToSpeedMultiplier",(function(){r.pixelToSpeedMultiplier=1/r.target.clientWidth*(r.target.clientWidth/r.target.clientHeight)})),this.target=e,this.manager=null,this.moving=!1,this.lastX=0,this.deltaRotation=0,this.speedLeft=i,this.speedRight=n,this.speedCapture=a,this.stiffness=s,this.pixelToSpeedMultiplier=0,this.updatePixelToSpeedMultiplier()}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,this.target.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"stop",value:function(){this.target.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"update",value:function(t,e){if(0!==this.deltaRotation){var i=this.stiffness/(16.666/t);i=O["r"].clamp(i,0,1),this.manager.rotation+=this.deltaRotation*i,this.deltaRotation*=1-i,Math.abs(this.deltaRotation)<1e-4&&(this.deltaRotation=0)}}},{key:"reset",value:function(){this.deltaRotation=0}}]),t}(),Fn=function(){function t(e,i,n,a,s){var r=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onMouseDown",(function(t){r.moving=!0,r.deltaAngle=0,r.lastY=t.y})),Object(je["a"])(this,"onMouseMove",(function(t){document.pointerLockElement?r.deltaAngle+=t.movementY*r.speedCapture*r.pixelToSpeedMultiplier:r.moving&&(1===t.buttons?r.deltaAngle+=(t.y-r.lastY)*r.speedLeft*r.pixelToSpeedMultiplier:r.deltaAngle+=(t.y-r.lastY)*r.speedRight*r.pixelToSpeedMultiplier),r.lastY=t.y})),Object(je["a"])(this,"onMouseUp",(function(t){r.moving=!1})),Object(je["a"])(this,"updatePixelToSpeedMultiplier",(function(){r.pixelToSpeedMultiplier=1/r.target.clientHeight})),this.target=e,this.manager=null,this.moving=!1,this.lastY=0,this.deltaAngle=0,this.speedLeft=i,this.speedRight=n,this.speedCapture=a,this.stiffness=s,this.pixelToSpeedMultiplier=0,this.updatePixelToSpeedMultiplier()}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,this.target.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"stop",value:function(){this.target.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"update",value:function(t,e){if(0!==this.deltaAngle){var i=this.stiffness/(16.666/t);i=O["r"].clamp(i,0,1),this.manager.angle+=this.deltaAngle*i,this.deltaAngle*=1-i,Math.abs(this.deltaAngle)<1e-4&&(this.deltaAngle=0)}}},{key:"reset",value:function(){this.deltaAngle=0}}]),t}(),Rn=function(){function t(e,i,n){var a=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onKeyDown",(function(e){xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.UP)))?(a.up=!0,e.preventDefault()):xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.DOWN)))&&(a.down=!0,e.preventDefault())})),Object(je["a"])(this,"onKeyUp",(function(e){xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.UP)))&&(a.up=!1),xn.oneUp.apply(xn,[e].concat(Object(Ee["a"])(t.KEYS.DOWN)))&&(a.down=!1)})),this.target=e,this.manager=null,this.deltaY=0,this.up=!1,this.down=!1,this.speed=i,this.stiffness=n}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}},{key:"stop",value:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"update",value:function(t,e){if(this.up&&(this.deltaY+=1),this.down&&(this.deltaY-=1),0!==this.deltaY){var i=this.stiffness/(16.666/t);i=O["r"].clamp(i,0,1),this.manager.position.y+=this.deltaY*i*this.speed*t*.06,this.deltaY*=1-i,Math.abs(this.deltaY)<1e-4&&(this.deltaY=0)}}}]),t}();Object(je["a"])(Rn,"KEYS",{UP:[new xn("Space"),new xn("PageUp")],DOWN:[new xn("ShiftLeft"),new xn("ShiftRight"),new xn("PageDown")]});var Vn=function(){function t(e,i,n,a){var s=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onTouchDown",(function(t){"mouse"!==t.pointerType&&(s.moving=!0,s.deltaPosition.set(0,0),s.lastPosition.set(t.center.x,t.center.y))})),Object(je["a"])(this,"onTouchMove",(function(e){if("mouse"!==e.pointerType){var i=t.tempVec2_1.set(e.center.x,e.center.y);s.moving&&s.deltaPosition.sub(i).add(s.lastPosition),s.lastPosition.copy(i)}})),Object(je["a"])(this,"onTouchUp",(function(t){"mouse"!==t.pointerType&&(s.moving=!1)})),Object(je["a"])(this,"updatePixelToSpeedMultiplier",(function(){s.pixelToSpeedMultiplierX=1/s.target.clientWidth*(s.target.clientWidth/s.target.clientHeight),s.pixelToSpeedMultiplierY=1/s.target.clientHeight})),this.target=e,this.hammer=i,this.manager=null,this.moving=!1,this.lastPosition=new O["N"],this.deltaPosition=new O["N"],this.speed=n,this.stiffness=a,this.pixelToSpeedMultiplierX=0,this.pixelToSpeedMultiplierY=0,this.updatePixelToSpeedMultiplier()}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,this.hammer.on("movestart",this.onTouchDown),this.hammer.on("movemove",this.onTouchMove),this.hammer.on("moveend",this.onTouchUp),this.hammer.on("movecancel",this.onTouchUp),window.addEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"stop",value:function(){this.hammer.off("movestart",this.onTouchDown),this.hammer.off("movemove",this.onTouchMove),this.hammer.off("moveend",this.onTouchUp),this.hammer.off("movecancel",this.onTouchUp),window.removeEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"update",value:function(t,e){if(0!==this.deltaPosition.x||0!==this.deltaPosition.y){var i=this.stiffness/(16.666/t);i=O["r"].clamp(i,0,1),this.manager.rotation+=this.deltaPosition.x*this.speed*this.pixelToSpeedMultiplierX*this.stiffness,this.manager.angle-=this.deltaPosition.y*this.speed*this.pixelToSpeedMultiplierY*this.stiffness,this.deltaPosition.multiplyScalar(1-i),this.deltaPosition.lengthSq()<1e-4&&this.deltaPosition.set(0,0)}}},{key:"reset",value:function(){this.deltaPosition.set(0,0)}}]),t}();Object(je["a"])(Vn,"tempVec2_1",new O["N"]);var Hn=function(){function t(e){var i=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"onContextMenu",(function(t){t.preventDefault()})),Object(je["a"])(this,"onMouseDown",(function(t){i.clickStart.set(t.x,t.y)})),Object(je["a"])(this,"onMouseUp",(function(t){Math.abs(i.clickStart.x-t.x)>5||Math.abs(i.clickStart.y-t.y)>5||document.body.requestFullscreen().finally((function(){i.target.requestPointerLock()}))})),Object(je["a"])(this,"onWheel",(function(t){var e=t.deltaY;t.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(e*=.01),t.deltaMode===WheelEvent.DOM_DELTA_LINE&&(e*=.33),i.moveSpeed*=Math.pow(1.5,.25*-e),i.moveSpeed=O["r"].clamp(i.moveSpeed,.05,5),i.keyMove.speed=i.moveSpeed,i.keyHeight.speed=i.moveSpeed})),this.target=e,this.manager=null,this.data={},this.hammer=new kn["Manager"](this.target),this.initializeHammer(),this.keyMove=new An(this.target,.5,.1),this.keyHeight=new Rn(this.target,.5,.2),this.mouseRotate=new Un(this.target,1.5,-2,-1.5,.5),this.mouseAngle=new Fn(this.target,1.5,-2,-1.5,.5),this.touchPan=new Vn(this.target,this.hammer,5,.15),this.started=!1,this.clickStart=new O["N"],this.moveSpeed=.5,this.animationTargetHeight=0}return Object(Te["a"])(t,[{key:"start",value:function(t){this.manager=t,this.keyMove.start(t),this.keyHeight.start(t),this.mouseRotate.start(t),this.mouseAngle.start(t),this.touchPan.start(t),this.target.addEventListener("contextmenu",this.onContextMenu),this.target.addEventListener("mousedown",this.onMouseDown),this.target.addEventListener("mouseup",this.onMouseUp),window.addEventListener("wheel",this.onWheel,{passive:!0})}},{key:"stop",value:function(){this.keyMove.stop(),this.keyHeight.stop(),this.mouseRotate.stop(),this.mouseAngle.stop(),this.touchPan.stop(),this.target.removeEventListener("contextmenu",this.onContextMenu),this.target.removeEventListener("mousedown",this.onMouseDown),this.target.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("wheel",this.onWheel)}},{key:"update",value:function(t,e){this.keyMove.update(t,e),this.keyHeight.update(t,e),this.mouseRotate.update(t,e),this.mouseAngle.update(t,e),this.touchPan.update(t,e),this.manager.angle=O["r"].clamp(this.manager.angle,0,Math.PI),this.manager.distance=0,this.manager.ortho=0}},{key:"initializeHammer",value:function(){var t=new kn["Pan"]({event:"move",pointers:1,direction:kn["DIRECTION_ALL"],threshold:0});this.hammer.add(t)}}]),t}();O["x"].prototype.onClick=function(t){return!!this.parent&&(Array.isArray(t.eventStack)||(t.eventStack=[]),t.eventStack.push(this),this.parent.onClick(t))};var Bn=function(t){Object(ji["a"])(i,t);var e=Object(Pi["a"])(i);function i(t,n,a){var s;Object(Oe["a"])(this,i),s=e.call(this,t),Object(je["a"])(Object(Ti["a"])(s),"onMapInteraction",(function(t){var e=!0,i=t.detail.hiresHit;if(t.detail.lowresHits)for(var n=0;n<t.detail.lowresHits.length;n++){if(i)break;e=!1,i=t.detail.lowresHits[n]}if(i){if(s.position.copy(i.pointOnLine||i.point).add(t.detail.ray.direction.clone().multiplyScalar(.05)).floor(),s.element.innerHTML=e?'\n                <div class="group">\n                    <div class="label">'.concat(ye.t("blockTooltip.block"),':</div>\n                    <div class="content">\n                        <div class="entry"><span class="label">x: </span><span class="value">').concat(s.position.x,'</span></div>\n                        <div class="entry"><span class="label">y: </span><span class="value">').concat(s.position.y,'</span></div>\n                        <div class="entry"><span class="label">z: </span><span class="value">').concat(s.position.z,"</span></div>\n                    </div>\n                </div>\n            "):'\n                <div class="group">\n                    <div class="label">'.concat(ye.t("blockTooltip.position"),':</div>\n                    <div class="content">\n                        <div class="entry"><span class="label">x: </span><span class="value">').concat(s.position.x,'</span></div>\n                        <div class="entry"><span class="label">z: </span><span class="value">').concat(s.position.z,"</span></div>\n                    </div>\n                </div>\n            "),s.appState.debug){var a=s.position.clone().divideScalar(16).floor(),r=new O["N"](s.position.x,s.position.z).divideScalar(512).floor(),o="r.".concat(r.x,".").concat(r.y,".mca");s.element.innerHTML+='\n                <hr>\n                <div class="group">\n                    <div class="label">'.concat(ye.t("blockTooltip.chunk"),':</div>\n                    <div class="content">\n                        <div class="entry"><span class="label">x: </span><span class="value">').concat(a.x,'</span></div>\n                        <div class="entry"><span class="label">y: </span><span class="value">').concat(a.y,'</span></div>\n                        <div class="entry"><span class="label">z: </span><span class="value">').concat(a.z,'</span></div>\n                    </div>\n                </div>\n                <hr>\n                <div class="group">\n                    <div class="label">').concat(ye.t("blockTooltip.region.region"),':</div>\n                    <div class="content">\n                        <div class="entry"><span class="label">x: </span><span class="value">').concat(r.x,'</span></div>\n                        <div class="entry"><span class="label">z: </span><span class="value">').concat(r.y,'</span></div>\n                    </div>\n                    <div class="content">\n                        <div class="entry"><span class="label">').concat(ye.t("blockTooltip.region.file"),': </span><span class="value">').concat(o,"</span></div>\n                    </div>\n                </div>\n            ")}if(s.appState.debug){var l=i.faceIndex,c=i.object.geometry.attributes;if(c.sunlight&&c.blocklight){var u=c.sunlight.array[3*l],h=c.blocklight.array[3*l];s.element.innerHTML+='\n                    <hr>\n                    <div class="group">\n                        <div class="label">'.concat(ye.t("blockTooltip.light.light"),':</div>\n                        <div class="content">\n                            <div class="entry"><span class="label">').concat(ye.t("blockTooltip.light.sun"),': </span><span class="value">').concat(u,'</span></div>\n                            <div class="entry"><span class="label">').concat(ye.t("blockTooltip.light.block"),': </span><span class="value">').concat(h,"</span></div>\n                        </div>\n                    </div>\n                ")}}if(s.appState.debug){var d="";if(e){var p,m,f,v=null===(p=t.detail.hiresHit)||void 0===p||null===(m=p.object)||void 0===m||null===(f=m.userData)||void 0===f?void 0:f.tileUrl;d+="<div>".concat(v,"</div>")}if(t.detail.lowresHits)for(var g=0;g<t.detail.lowresHits.length;g++){var y,b,w,M=null===(y=t.detail.lowresHits[g])||void 0===y||null===(b=y.object)||void 0===b||null===(w=b.userData)||void 0===w?void 0:w.tileUrl;M&&(d+="<div>".concat(M,"</div>"))}s.element.innerHTML+='\n                <hr>\n                <div class="files">\n                    '.concat(d,"\n                </div>\n            ")}s.appState.debug&&console.debug("Clicked Position Data:",t.detail),s.open()}})),Object(je["a"])(Object(Ti["a"])(s),"removeHandler",(function(t){t.composedPath().includes(s.element)||s.close()})),s.data.type="popup",s.data.label="Last Map Interaction",s.appState=n,s.events=a,s.visible=!1,s.elementObject=new Hi(z('<div id="bm-marker-'.concat(s.data.id,'" class="bm-marker-').concat(s.data.type,'">Test</div>'))),s.elementObject.position.set(.5,1,.5),s.addEventListener("removed",(function(){s.element.parentNode&&s.element.parentNode.removeChild(s.element)}));var r=new O["c"](1.01,1.01,1.01).translate(.5,.5,.5),o=new O["u"]({color:16777215,opacity:.5,transparent:!0});return s.cube=new O["t"](r,o),s.cube.onClick=function(t){return s.onClick(t)},s.add(s.elementObject),s.add(s.cube),s.animation=null,s.events.addEventListener("bluemapMapInteraction",s.onMapInteraction),window.addEventListener("mousedown",s.removeHandler),window.addEventListener("touchstart",s.removeHandler),window.addEventListener("keydown",s.removeHandler),window.addEventListener("mousewheel",s.removeHandler),s}return Object(Te["a"])(i,[{key:"onClick",value:function(t){return!0}},{key:"open",value:function(){var t=this;this.animation&&this.animation.cancel(),this.visible=!0,this.cube.visible=!0;var e=1;this.element.style.opacity="0",this.animation=A((function(i){t.element.style.opacity=(i*e).toString()}),300)}},{key:"close",value:function(){var t=this;this.animation&&this.animation.cancel(),this.cube.visible=!1;var e=parseFloat(this.element.style.opacity);this.animation=A((function(i){t.element.style.opacity=(e-i*e).toString()}),300,(function(e){e&&(t.visible=!1)}))}},{key:"element",get:function(){return this.elementObject.element.getElementsByTagName("div")[0]}},{key:"dispose",value:function(){Object($i["a"])(Object(Ni["a"])(i.prototype),"dispose",this).call(this),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}]),i}(qi),$n=(i("e9c4"),function(t,e){localStorage.setItem(t,JSON.stringify(e))}),Nn=function(t){var e=localStorage.getItem(t);if(null!=e)try{return JSON.parse(e)}catch(i){return e}},In=function(t,e){var i=Math.pow(10,e);return Math.round(t*i)/i},Yn=function(){function t(e){var i=this;Object(Oe["a"])(this,t),Object(je["a"])(this,"update",Object(Lt["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,i.followPlayerMarkerWorld();case 2:i.updateLoop=setTimeout(i.update,1e3);case 3:case"end":return t.stop()}}),t)})))),Object(je["a"])(this,"cameraMoved",(function(){i.hashUpdateTimeout&&clearTimeout(i.hashUpdateTimeout),i.hashUpdateTimeout=setTimeout(i.updatePageAddress,1500),i.lastCameraMove=Date.now()})),Object(je["a"])(this,"loadBlocker",Object(Lt["a"])(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i.appState.controls.pauseTileLoading){t.next=2;break}return t.abrupt("return");case 2:if(n=Date.now()-i.lastCameraMove,e=250-n,!(e>0)){t.next=7;break}return t.next=7,i.sleep(e);case 7:if(e>0){t.next=2;break}case 8:case"end":return t.stop()}}),t)})))),Object(je["a"])(this,"updatePageAddress",(function(){var t="#";if(i.mapViewer.map){t+=i.mapViewer.map.data.id;var e=i.mapViewer.controlsManager;t+=":"+In(e.position.x,0),t+=":"+In(e.position.y,0),t+=":"+In(e.position.z,0),t+=":"+In(e.distance,0),t+=":"+In(e.rotation,2),t+=":"+In(e.angle,2),t+=":"+In(e.tilt,2),t+=":"+In(e.ortho,0),t+=":"+i.appState.controls.state}history.replaceState(void 0,void 0,t),document.title=ye.t("pageTitle",{map:i.mapViewer.map?i.mapViewer.map.data.name:"?",version:i.settings.version})})),Object(je["a"])(this,"loadPageAddress",Object(Lt["a"])(regeneratorRuntime.mark((function t(){var e,n,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=(null===(e=window.location.hash)||void 0===e?void 0:e.substring(1))||i.settings.startLocation||"",a=n.split(":"),10===a.length){t.next=4;break}return t.abrupt("return",!1);case 4:if(s=i.mapViewer.controlsManager,s.controls=null,i.mapViewer.map&&i.mapViewer.map.data.id===a[0]){t.next=15;break}return t.prev=7,t.next=10,i.switchMap(a[0]);case 10:t.next=15;break;case 12:return t.prev=12,t.t0=t["catch"](7),t.abrupt("return",!1);case 15:s.position.x=parseFloat(a[1]),s.position.y=parseFloat(a[2]),s.position.z=parseFloat(a[3]),s.distance=parseFloat(a[4]),s.rotation=parseFloat(a[5]),s.angle=parseFloat(a[6]),s.tilt=parseFloat(a[7]),s.ortho=parseFloat(a[8]),t.t1=a[9],t.next="flat"===t.t1?26:"free"===t.t1?28:30;break;case 26:return i.setFlatView(0),t.abrupt("break",32);case 28:return i.setFreeFlight(0,s.position.y),t.abrupt("break",32);case 30:return i.setPerspectiveView(0),t.abrupt("break",32);case 32:return t.abrupt("return",!0);case 33:case"end":return t.stop()}}),t,null,[[7,12]])})))),Object(je["a"])(this,"mapInteraction",(function(t){if(t.detail.data.doubleTap){var e,n,a=i.mapViewer.controlsManager,s=(null===(e=t.detail.hit)||void 0===e?void 0:e.point)||(null===(n=t.detail.object)||void 0===n?void 0:n.getWorldPosition(new O["O"]));if(!s)return;var r=a.distance,o=Math.max(.25*r,5),l=a.position.x,c=s.x,u=a.position.z,h=s.z;i.viewAnimation=A((function(t){var e=U.easeInOutQuad(t);a.distance=O["r"].lerp(r,o,e),a.position.x=O["r"].lerp(l,c,e),a.position.z=O["r"].lerp(u,h,e)}),500)}})),Object(je["a"])(this,"takeScreenshot",(function(){var t=document.createElement("a");t.download="bluemap-screenshot.png",t.href=i.mapViewer.renderer.domElement.toDataURL("image/png"),t.click(),i.appState.screenshot.clipboard&&i.mapViewer.renderer.domElement.toBlob((function(t){navigator.clipboard.write([new ClipboardItem(Object(je["a"])({},"image/png",t))]).catch((function(t){_(i.events,"Failed to copy screenshot to clipboard: "+t,"error")}))}))})),this.events=e,this.mapViewer=new dn(e,this.events),this.mapControls=new zn(this.mapViewer.renderer.domElement),this.freeFlightControls=new Hn(this.mapViewer.renderer.domElement),this.playerMarkerManager=null,this.markerFileManager=null,this.settings=null,this.savedUserSettings=new Map,this.maps=[],this.mapsMap=new Map,this.lastCameraMove=0,this.dataUrl="maps/",this.mainMenu=new Pe,this.appState={controls:{state:"perspective",mouseSensitivity:1,invertMouse:!1,enableFreeFlight:!1,pauseTileLoading:!1},menu:this.mainMenu,maps:[],theme:null,screenshot:{clipboard:!0},debug:!1},this.updateControlsSettings(),this.initGeneralEvents(),this.popupMarkerSet=new hn("bm-popup-set"),this.popupMarker=new Bn("bm-popup",this.appState,this.events),this.popupMarkerSet.add(this.popupMarker),this.mapViewer.markers.add(this.popupMarkerSet),this.updateLoop=null,this.hashUpdateTimeout=null,this.viewAnimation=null}return Object(Te["a"])(t,[{key:"load",value:function(){var t=Object(Lt["a"])(regeneratorRuntime.mark((function t(){var e,i,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.maps,this.maps=[],this.appState.maps.splice(0,this.appState.maps.length),this.mapsMap.clear(),t.next=6,this.getSettings();case 6:return this.mapControls.minDistance=this.settings.minZoomDistance,this.mapControls.maxDistance=this.settings.maxZoomDistance,this.appState.controls.enableFreeFlight=this.settings.enableFreeFlight,t.next=11,this.mapViewer.switchMap(null);case 11:return e.forEach((function(t){return t.dispose()})),t.next=14,this.loadMaps();case 14:this.maps=t.sent,i=Object(l["a"])(this.maps);try{for(i.s();!(n=i.n()).done;)a=n.value,this.mapsMap.set(a.data.id,a),this.appState.maps.push(a.data)}catch(s){i.e(s)}finally{i.f()}return t.next=19,this.loadPageAddress();case 19:if(t.sent){t.next=24;break}if(!(this.maps.length>0)){t.next=23;break}return t.next=23,this.switchMap(this.maps[0].data.id);case 23:this.resetCamera();case 24:return window.addEventListener("hashchange",this.loadPageAddress),this.events.addEventListener("bluemapCameraMoved",this.cameraMoved),this.events.addEventListener("bluemapMapInteraction",this.mapInteraction),this.updateLoop&&clearTimeout(this.updateLoop),this.updateLoop=setTimeout(this.update,1e3),t.next=31,this.loadUserSettings();case 31:this.saveUserSettings();case 32:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"followPlayerMarkerWorld",value:function(){var t=Object(Lt["a"])(regeneratorRuntime.mark((function t(){var e,i,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=null===(e=this.mapViewer.controlsManager.controls)||void 0===e?void 0:e.data.followingPlayer,!this.mapViewer.map||!i){t.next=15;break}if(!i.foreign){t.next=15;break}return t.next=5,this.findPlayerMap(i.playerUuid);case 5:if(n=t.sent,!n){t.next=14;break}return this.mainMenu.closeAll(),t.next=10,this.switchMap(n.data.id,!1);case 10:a=this.playerMarkerManager.getPlayerMarker(i.playerUuid),a&&this.mapViewer.controlsManager.controls.followPlayerMarker&&this.mapViewer.controlsManager.controls.followPlayerMarker(a),t.next=15;break;case 14:this.mapViewer.controlsManager.controls.stopFollowingPlayerMarker&&this.mapViewer.controlsManager.controls.stopFollowingPlayerMarker();case 15:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"findPlayerMap",value:function(){var t=Object(Lt["a"])(regeneratorRuntime.mark((function t(e){var i,n,a,s,r,o,c,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=null,!(this.maps.length<20)){t.next=42;break}n=Object(l["a"])(this.maps),t.prev=3,n.s();case 5:if((a=n.n()).done){t.next=34;break}return s=a.value,t.next=9,this.loadPlayerData(s);case 9:if(r=t.sent,Array.isArray(r.players)){t.next=12;break}return t.abrupt("continue",32);case 12:o=Object(l["a"])(r.players),t.prev=13,o.s();case 15:if((c=o.n()).done){t.next=22;break}if(u=c.value,u.uuid!==e||u.foreign){t.next=20;break}return i=s,t.abrupt("break",22);case 20:t.next=15;break;case 22:t.next=27;break;case 24:t.prev=24,t.t0=t["catch"](13),o.e(t.t0);case 27:return t.prev=27,o.f(),t.finish(27);case 30:if(!i){t.next=32;break}return t.abrupt("break",34);case 32:t.next=5;break;case 34:t.next=39;break;case 36:t.prev=36,t.t1=t["catch"](3),n.e(t.t1);case 39:return t.prev=39,n.f(),t.finish(39);case 42:return t.abrupt("return",i);case 43:case"end":return t.stop()}}),t,this,[[3,36,39,42],[13,24,27,30]])})));function e(e){return t.apply(this,arguments)}return e}()},{key:"switchMap",value:function(){var t=Object(Lt["a"])(regeneratorRuntime.mark((function t(e){var i,n,a=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=!(a.length>1&&void 0!==a[1])||a[1],n=this.mapsMap.get(e),n){t.next=4;break}return t.abrupt("return",Promise.reject('There is no map with the id "'.concat(e,'" loaded!')));case 4:return t.next=6,this.mapViewer.switchMap(n);case 6:return i&&this.resetCamera(),this.updatePageAddress(),t.next=10,Promise.all([this.initPlayerMarkerManager(),this.initMarkerFileManager()]);case 10:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"resetCamera",value:function(){var t=this.mapViewer.map,e=this.mapViewer.controlsManager;t&&(e.position.set(t.data.startPos.x,0,t.data.startPos.z),e.distance=1500,e.angle=0,e.rotation=0,e.tilt=0,e.ortho=0),e.controls=this.mapControls,this.appState.controls.state="perspective",this.updatePageAddress()}},{key:"loadMaps",value:function(){var t=Object(Lt["a"])(regeneratorRuntime.mark((function t(){var e,i,n,a,s,r=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.settings,i=[],void 0===e.maps){t.next=19;break}n=Object(l["a"])(e.maps),t.prev=4,s=regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=a.value,n=new Oi(e,r.dataUrl+e+"/",r.loadBlocker,r.mapViewer.events),i.push(n),t.next=5,n.loadSettings().catch((function(t){_(r.events,"Failed to load settings for map '".concat(n.data.id,"':")+t,"warning")}));case 5:case"end":return t.stop()}}),t)})),n.s();case 7:if((a=n.n()).done){t.next=11;break}return t.delegateYield(s(),"t0",9);case 9:t.next=7;break;case 11:t.next=16;break;case 13:t.prev=13,t.t1=t["catch"](4),n.e(t.t1);case 16:return t.prev=16,n.f(),t.finish(16);case 19:return i.sort((function(t,e){var i=t.data.sorting-e.data.sorting;return isNaN(i)?0:i})),t.abrupt("return",i);case 21:case"end":return t.stop()}}),t,this,[[4,13,16,19]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"getSettings",value:function(){var t=Object(Lt["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.settings){t.next=4;break}return t.next=3,this.loadSettings();case 3:this.settings=t.sent;case 4:return t.abrupt("return",this.settings);case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"loadSettings",value:function(){return new Promise((function(t,e){var i=new O["i"];i.setResponseType("json"),i.load("settings.json?"+E(),t,(function(){}),(function(){return e("Failed to load the settings.json!")}))}))}},{key:"loadPlayerData",value:function(t){var e=this;return new Promise((function(i,n){var a=new O["i"];a.setResponseType("json"),a.load(t.data.dataUrl+"live/players?"+E(),(function(t){t?i(t):n("Failed to parse '".concat(e.fileUrl,"'!"))}),(function(){}),(function(){return n("Failed to load '".concat(e.fileUrl,"'!"))}))}))}},{key:"initPlayerMarkerManager",value:function(){var t=this;this.playerMarkerManager&&(this.playerMarkerManager.clear(),this.playerMarkerManager.dispose());var e=this.mapViewer.map;if(e)return this.playerMarkerManager=new gn(this.mapViewer.markers,e.data.dataUrl+"live/players",fn.PLAYER,this.events),this.playerMarkerManager.setAutoUpdateInterval(0),this.playerMarkerManager.update().then((function(){t.playerMarkerManager.setAutoUpdateInterval(1e3)})).catch((function(e){_(t.events,e,"warning"),t.playerMarkerManager.clear(),t.playerMarkerManager.dispose()}))}},{key:"initMarkerFileManager",value:function(){var t=this;this.markerFileManager&&(this.markerFileManager.clear(),this.markerFileManager.dispose());var e=this.mapViewer.map;if(e)return this.markerFileManager=new gn(this.mapViewer.markers,e.data.dataUrl+"live/markers",fn.NORMAL,this.events),this.markerFileManager.update().then((function(){t.markerFileManager.setAutoUpdateInterval(1e4)})).catch((function(e){_(t.events,e,"warning"),t.markerFileManager.clear(),t.markerFileManager.dispose()}))}},{key:"updateControlsSettings",value:function(){var t=this.appState.controls.invertMouse?-1:1;this.freeFlightControls.mouseRotate.speedCapture=-1.5*this.appState.controls.mouseSensitivity,this.freeFlightControls.mouseAngle.speedCapture=-1.5*this.appState.controls.mouseSensitivity*t,this.freeFlightControls.mouseRotate.speedRight=-2*this.appState.controls.mouseSensitivity,this.freeFlightControls.mouseAngle.speedRight=-2*this.appState.controls.mouseSensitivity*t}},{key:"initGeneralEvents",value:function(){var t=this;document.addEventListener("fullscreenchange",(function(e){document.fullscreen&&t.mainMenu.closeAll()}))}},{key:"setPerspectiveView",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if(this.mapViewer.map){this.viewAnimation&&this.viewAnimation.cancel();var n=this.mapViewer.controlsManager;n.controls=null;var a=n.distance,s=Math.max(5,i,a),r=n.position.y,o=O["r"].lerp(this.mapViewer.map.terrainHeightAt(n.position.x,n.position.z)+3,0,s/500),l=n.angle,c=Math.min(Math.PI/2,l,this.mapControls.getMaxPerspectiveAngleForDistance(s)),u=n.ortho,h=n.tilt;this.viewAnimation=A((function(t){var e=U.easeInOutQuad(t);n.position.y=O["r"].lerp(r,o,e),n.distance=O["r"].lerp(a,s,e),n.angle=O["r"].lerp(l,c,e),n.ortho=O["r"].lerp(u,0,t),n.tilt=O["r"].lerp(h,0,e)}),e,(function(e){t.mapControls.reset(),e&&(n.controls=t.mapControls,t.updatePageAddress())})),this.appState.controls.state="perspective"}}},{key:"setFlatView",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if(this.mapViewer.map){this.viewAnimation&&this.viewAnimation.cancel();var n=this.mapViewer.controlsManager;n.controls=null;var a=n.distance,s=Math.max(5,i,a),r=n.rotation,o=n.angle,l=n.ortho,c=n.tilt;this.viewAnimation=A((function(t){var e=U.easeInOutQuad(t);n.distance=O["r"].lerp(a,s,e),n.rotation=O["r"].lerp(r,0,e),n.angle=O["r"].lerp(o,0,e),n.ortho=O["r"].lerp(l,1,t),n.tilt=O["r"].lerp(c,0,e)}),e,(function(e){t.mapControls.reset(),e&&(n.controls=t.mapControls,t.updatePageAddress())})),this.appState.controls.state="flat"}}},{key:"setFreeFlight",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(this.mapViewer.map){if(!this.settings.enableFreeFlight)return this.setPerspectiveView(e);this.viewAnimation&&this.viewAnimation.cancel();var n=this.mapViewer.controlsManager;n.controls=null;var a=n.distance,s=n.position.y;i||(i=this.mapViewer.map.terrainHeightAt(n.position.x,n.position.z)+3||s);var r=n.angle,o=Math.PI/2,l=n.ortho,c=n.tilt;this.viewAnimation=A((function(t){var e=U.easeInOutQuad(t);n.position.y=O["r"].lerp(s,i,e),n.distance=O["r"].lerp(a,0,e),n.angle=O["r"].lerp(r,o,e),n.ortho=O["r"].lerp(l,0,Math.min(2*t,1)),n.tilt=O["r"].lerp(c,0,e)}),e,(function(e){e&&(n.controls=t.freeFlightControls,t.updatePageAddress())})),this.appState.controls.state="free"}}},{key:"setDebug",value:function(t){this.appState.debug=t,t?this.mapViewer.stats.showPanel(0):this.mapViewer.stats.showPanel(-1)}},{key:"setTheme",value:function(t){this.appState.theme=t,"light"===t?(this.mapViewer.rootElement.classList.remove("theme-dark"),this.mapViewer.rootElement.classList.remove("theme-contrast"),this.mapViewer.rootElement.classList.add("theme-light")):"dark"===t?(this.mapViewer.rootElement.classList.remove("theme-light"),this.mapViewer.rootElement.classList.remove("theme-contrast"),this.mapViewer.rootElement.classList.add("theme-dark")):"contrast"===t?(this.mapViewer.rootElement.classList.remove("theme-light"),this.mapViewer.rootElement.classList.remove("theme-dark"),this.mapViewer.rootElement.classList.add("theme-contrast")):(this.mapViewer.rootElement.classList.remove("theme-light"),this.mapViewer.rootElement.classList.remove("theme-dark"),this.mapViewer.rootElement.classList.remove("theme-contrast"))}},{key:"setScreenshotClipboard",value:function(t){this.appState.screenshot.clipboard=t}},{key:"updateMap",value:function(){var t=Object(Lt["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,this.mapViewer.clearTileCache(),!this.mapViewer.map){t.next=5;break}return t.next=5,this.switchMap(this.mapViewer.map.data.id);case 5:this.saveUserSettings(),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),_(this.events,t.t0,"error");case 11:case"end":return t.stop()}}),t,this,[[0,8]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"resetSettings",value:function(){this.saveUserSetting("resetSettings",!0),location.reload()}},{key:"loadUserSettings",value:function(){var t=Object(Lt["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(isNaN(this.settings.resolutionDefault)||(this.mapViewer.data.superSampling=this.settings.resolutionDefault),isNaN(this.settings.hiresSliderDefault)||(this.mapViewer.data.loadedHiresViewDistance=this.settings.hiresSliderDefault),isNaN(this.settings.lowresSliderDefault)||(this.mapViewer.data.loadedLowresViewDistance=this.settings.lowresSliderDefault),this.settings.useCookies){t.next=5;break}return t.abrupt("return");case 5:if(!this.loadUserSetting("resetSettings",!1)){t.next=9;break}return _(this.events,"Settings reset!","info"),this.saveUserSettings(),t.abrupt("return");case 9:return this.mapViewer.clearTileCache(this.loadUserSetting("tileCacheHash",this.mapViewer.tileCacheHash)),this.mapViewer.superSampling=this.loadUserSetting("superSampling",this.mapViewer.data.superSampling),this.mapViewer.data.loadedHiresViewDistance=this.loadUserSetting("hiresViewDistance",this.mapViewer.data.loadedHiresViewDistance),this.mapViewer.data.loadedLowresViewDistance=this.loadUserSetting("lowresViewDistance",this.mapViewer.data.loadedLowresViewDistance),this.mapViewer.updateLoadedMapArea(),this.appState.controls.mouseSensitivity=this.loadUserSetting("mouseSensitivity",this.appState.controls.mouseSensitivity),this.appState.controls.invertMouse=this.loadUserSetting("invertMouse",this.appState.controls.invertMouse),this.appState.controls.pauseTileLoading=this.loadUserSetting("pauseTileLoading",this.appState.controls.pauseTileLoading),this.updateControlsSettings(),this.setTheme(this.loadUserSetting("theme",this.appState.theme)),this.setScreenshotClipboard(this.loadUserSetting("screenshotClipboard",this.appState.screenshot.clipboard)),t.next=22,ye.setLanguage(this.loadUserSetting("lang",ye.locale));case 22:this.setDebug(this.loadUserSetting("debug",this.appState.debug)),_(this.events,"Settings loaded!","info");case 24:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"saveUserSettings",value:function(){this.settings.useCookies&&(this.saveUserSetting("resetSettings",!1),this.saveUserSetting("tileCacheHash",this.mapViewer.tileCacheHash),this.saveUserSetting("superSampling",this.mapViewer.data.superSampling),this.saveUserSetting("hiresViewDistance",this.mapViewer.data.loadedHiresViewDistance),this.saveUserSetting("lowresViewDistance",this.mapViewer.data.loadedLowresViewDistance),this.saveUserSetting("mouseSensitivity",this.appState.controls.mouseSensitivity),this.saveUserSetting("invertMouse",this.appState.controls.invertMouse),this.saveUserSetting("pauseTileLoading",this.appState.controls.pauseTileLoading),this.saveUserSetting("theme",this.appState.theme),this.saveUserSetting("screenshotClipboard",this.appState.screenshot.clipboard),this.saveUserSetting("lang",ye.locale),this.saveUserSetting("debug",this.appState.debug),_(this.events,"Settings saved!","info"))}},{key:"loadUserSetting",value:function(t,e){var i=Nn("bluemap-"+t);return void 0===i?e:i}},{key:"saveUserSetting",value:function(t,e){this.savedUserSettings.get(t)!==e&&(this.savedUserSettings.set(t,e),$n("bluemap-"+t,e))}},{key:"sleep",value:function(t){return new Promise((function(e){return setTimeout(e,t)}))}}]),t}();String.prototype.includesCI=function(t){return this.toLowerCase().includes(t.toLowerCase())};try{var Kn=new Yn(document.getElementById("map-container"));window.bluemap=Kn,n["a"].config.productionTip=!1,Object.defineProperty(n["a"].prototype,"$bluemap",{get:function(){return Kn}});var Wn=new n["a"]({i18n:ye,render:function(t){return t(bi)}}).$mount("#app");ye.loadLanguageSettings().catch((function(t){return console.error(t)})),Wn.$nextTick((function(){Kn.load().catch((function(t){return console.error(t)}))}))}catch(Gn){console.error("Failed to load BlueMap webapp!",Gn),document.body.innerHTML='\n    <div id="bm-app-err">\n      <div>\n        <img src="assets/logo.png" alt="bluemap logo">\n        <div class="bm-app-err-main">Failed to load BlueMap webapp!</div>\n        <div class="bm-app-err-hint">Make sure you have <a href="https://get.webgl.org/">WebGL</a> enabled on your browser.</div>\n      </div>\n    </div>\n  '}},"5c0b":function(t,e,i){"use strict";i("9c0c")},"5dd6":function(t,e,i){},6274:function(t,e,i){},"627e":function(t,e,i){},"635d":function(t,e,i){"use strict";i("cf6e")},6865:function(t,e,i){"use strict";i("6274")},"76c6":function(t,e,i){},"7b65":function(t,e,i){},"7c75":function(t,e,i){},8568:function(t,e,i){},"89de":function(t,e,i){},"8dd3":function(t,e,i){},"982f":function(t,e,i){"use strict";i("3452")},"9c0c":function(t,e,i){},"9eb8":function(t,e,i){"use strict";i("04be")},a126:function(t,e,i){},a5f7:function(t,e,i){},bd0a:function(t,e,i){},bfc9:function(t,e,i){"use strict";i("bd0a")},c2cb:function(t,e,i){},c70c:function(t,e,i){"use strict";i("89de")},ce79:function(t,e,i){"use strict";i("627e")},cf6e:function(t,e,i){},e998:function(t,e,i){},ef8f:function(t,e,i){"use strict";i("a5f7")},fd67:function(t,e,i){"use strict";i("5dd6")},fdfd:function(t,e,i){}});
//# sourceMappingURL=app.d1a062f7.js.map